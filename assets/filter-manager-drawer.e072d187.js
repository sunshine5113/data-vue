import{b as P,I as A,H as p,z as d,a1 as B}from"./App.469555df.js";import{I as z}from"./warning.7c48cee5.js";import{I as H}from"./document.ed5b6cc5.js";import{F as L}from"./filter-collapse-panel.397c805c.js";import{a4 as O,b1 as U,bf as W,a9 as M,aC as I,aH as N,bj as v,a5 as l,a6 as F,a7 as j,b2 as f,a_ as m,ad as h,ah as T,aa as V,af as q,ae as x,b9 as G,b3 as $}from"./vendor.5472ebc5.js";import"./arrow-left.970b90a9.js";import"./edit.dbee3cf6.js";import"./delete.5380830a.js";import"./release.38c1db62.js";const J=O({name:"FilterManagerDrawer",components:{IconDocument:H,FilterCollapsePanel:L},setup(){const n=U(),u=W(),_=M(!1),c=M(null);I(()=>A.filter.show,e=>{_.value=e}),I(_,e=>{e||(A.filter.show=!1)});const y=N(()=>p.dataFilters),b=N(()=>{const e=[...d.coms,...d.subComs],t=Object.create(null);return e.forEach(a=>{for(const s in a.apiData)a.apiData[s].pageFilters.forEach(o=>{t[o.id]?(t[o.id].ids.push(a.id),t[o.id].names.push(a.alias)):t[o.id]={ids:[a.id],names:[a.alias]}})}),t}),D=()=>{c.value||(c.value={id:0,name:"\u65B0\u5EFA\u8FC7\u6EE4\u5668",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})},C=(e,t)=>{const a=e.trim();a&&t.name!==a&&(t.name=a,t.id>0&&p.updateFilterName(t))},E=e=>{if(e>0){const t=u.create({content:"\u662F\u5426\u5220\u9664\u6570\u636E\u8FC7\u6EE4\u5668\uFF0C\u53EF\u80FD\u5BFC\u81F4\u76F8\u5173\u7EC4\u4EF6\u4E0D\u53EF\u7528\u3002",negativeText:"\u53D6\u6D88",positiveText:"\u786E\u5B9A",iconPlacement:"top",icon:()=>G(z),onPositiveClick:async()=>{t.loading=!0;try{await p.deleteFilter(e);const a=b.value[e];a&&[...d.coms,...d.subComs].filter(r=>a.ids.includes(r.id)).forEach(r=>{for(const o in r.apiData){const i=r.apiData[o],g=i.pageFilters.find(k=>k.id===e);i.pageFilters=i.pageFilters.filter(k=>k.id!==e),g&&g.enabled&&B(r.id,o,r.apis[o],i)}})}catch(a){n.error(a.message)}}})}else c.value=null},w=async e=>{if(e.id>0){await p.updateFilter(e);const t=b.value[e.id];t&&[...d.coms,...d.subComs].filter(s=>t.ids.includes(s.id)).forEach(s=>{for(const r in s.apiData){const o=s.apiData[r],i=o.pageFilters.find(g=>g.id===e.id);i&&i.enabled&&B(s.id,r,s.apis[r],o)}})}else await p.createFilter(e),c.value=null};return v("usedFilters",b),v("editFilterName",C),v("removeFilter",E),v("saveFilter",w),{visible:_,dataFilters:y,newDataFilter:c,addFilter:D,removeFilter:E}}}),K={class:"filter-manager-title"},Q=$(" \u6570\u636E\u8FC7\u6EE4\u5668"),R=h("span",null,"\u5E2E\u52A9\u6587\u6863",-1),S={key:1,class:"panel-info"},X=h("p",{class:"info-text"},"\u8FC7\u6EE4\u5668\u5217\u8868\u4E3A\u7A7A\uFF0C\u8BF7\u521B\u5EFA\u540E\u4F7F\u7528",-1),Y=$(" \u65B0\u5EFA ");function Z(n,u,_,c,y,b){const D=l("IconDocument"),C=l("n-icon"),E=l("router-link"),w=l("filter-collapse-panel"),e=l("n-button"),t=l("n-drawer-content"),a=l("n-drawer");return F(),j(a,{show:n.visible,"onUpdate:show":u[1]||(u[1]=s=>n.visible=s),width:"500px",placement:"left",class:"filter-manager-drawer",to:"#edit-main-wp"},{default:f(()=>[m(t,{closable:""},{header:f(()=>[h("p",K,[Q,h("span",{class:"create-filter",onClick:u[0]||(u[0]=(...s)=>n.addFilter&&n.addFilter(...s))},"\u65B0\u5EFA"),m(E,{to:{name:"MyCase"},target:"_blank",rel:"noopener noreferrer",class:"filter-doc"},{default:f(()=>[m(C,{size:12},{default:f(()=>[m(D)]),_:1}),R]),_:1})])]),default:f(()=>[n.newDataFilter?(F(),j(w,{key:0,"data-filter":n.newDataFilter,"is-new":!0,draggable:!1,"has-feedback":!1,removable:!0},null,8,["data-filter"])):T("",!0),(F(!0),V(x,null,q(n.dataFilters,s=>(F(),j(w,{key:s.id,"data-filter":s,draggable:!1,"has-feedback":!1,publish:!0,removable:!0,"show-time":!0},null,8,["data-filter"]))),128)),n.dataFilters.length===0&&!n.newDataFilter?(F(),V("div",S,[X,m(e,{focusable:!1,onClick:n.addFilter},{default:f(()=>[Y]),_:1},8,["onClick"])])):T("",!0)]),_:1})]),_:1},8,["show"])}var ue=P(J,[["render",Z]]);export{ue as default};
