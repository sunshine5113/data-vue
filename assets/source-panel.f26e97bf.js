var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,i=(e,i)=>{for(var o in i||(i={}))t.call(i,o)&&s(e,o,i[o]);if(a)for(var o of a(i))l.call(i,o)&&s(e,o,i[o]);return e};import{d as o,b1 as n,e as d,y as r,z as c,l as u,m as p,F as f,p as v,v as m,A as g,r as b,ae as y,aG as h,aD as C,aj as D,k as F,s as w,am as S,q as k,aL as x,au as _,b2 as T,b3 as j,b4 as N,b5 as O,a_ as V,t as I,b6 as P,ag as E,a$ as A}from"./index.96b29a26.js";import{_ as U}from"./filter-collapse-panel.dbc9b371.js";var R=o({name:"DisplayApiStatus",props:{status:{type:String,default:n.incomplete},loadingText:{type:String,default:"匹配中"},successText:{type:String,default:"匹配成功"},failedText:{type:String,default:"未找到字段"},completedText:{type:String,default:"配置完成"},incompleteText:{type:String,default:"配置未完成"},optional:{type:Boolean,default:!1}},setup(e){const a=d((()=>e.status===n.loading?e.loadingText:e.status===n.success?e.successText:e.status===n.completed?e.completedText:e.optional?"可选":e.status===n.failed?e.failedText:e.status===n.incomplete?e.incompleteText:e.status));return{apiStatus:n,statusText:a}}});const z=g();r("data-v-44e10de6");const M=v("i",{class:"status-icon validating"},null,-1),G=v("i",{class:"status-icon validating"},null,-1),L=v("i",{class:"status-icon validating"},null,-1),$={key:2,class:"status-icon --success"},q={class:"status-text"};c();const B=z(((e,a,t,l,s,i)=>(u(),p("div",null,[e.status===e.apiStatus.loading?(u(),p(f,{key:0},[M,G,L],64)):e.status===e.apiStatus.success||e.status===e.apiStatus.completed?(u(),p("i",{key:1,class:["status-icon",`--${e.status}`]},null,2)):e.optional?(u(),p("i",$)):(u(),p("i",{key:3,class:["status-icon",`--${e.status}`]},null,2)),v("span",q,m(e.statusText),1)]))));R.render=B,R.__scopeId="data-v-44e10de6";var H=o({name:"FilterConfig",components:{FilterCollapsePanel:U},setup(){const e=b(void 0),a=b(null),t=b(null),l=b({visible:!1,top:"4px",from:0,to:0}),s=y("apiDataConfig"),i=y("refreshData"),o=d((()=>{const e=s.value.pageFilters.map((e=>e.id));return h.dataFilters.filter((a=>!e.includes(a.id)))})),n=d((()=>s.value.pageFilters.reduce(((e,a)=>{const t=h.dataFilters.find((e=>e.id==a.id));return t&&e.push(t),e}),[]))),r=d((()=>{const e=[...C.coms,...C.subComs],a=Object.create(null);return e.forEach((e=>{for(const t in e.apiData){e.apiData[t].pageFilters.forEach((t=>{a[t.id]?(a[t.id].ids.push(e.id),a[t.id].names.push(e.alias)):a[t.id]={ids:[e.id],names:[e.alias]}}))}})),a})),c=d((()=>s.value.pageFilters.reduce(((e,a)=>(e[a.id]=a.enabled,e)),{}))),u=(e,a,t)=>{l.value.visible=e,l.value.top=t.offsetTop-6+"px",e?l.value.to=a:(l.value.from=a,(()=>{const{from:e,to:a}=l.value;if(e!==a){const t=s.value.pageFilters;t.splice(a,0,...t.splice(e,1)),i()}})())};return D("usedFilters",r),D("enabledFilters",c),D("onUsedChange",((e,a)=>{s.value.pageFilters.find((a=>a.id===e)).enabled=a,i()})),D("editFilterName",((e,a)=>{const t=e.trim();t&&a.name!==t&&(a.name=t,a.id>0&&h.updateFilterName(a))})),D("removeFilter",(e=>{e>0?(s.value.pageFilters=s.value.pageFilters.filter((a=>a.id!==e)),i()):a.value=null})),D("saveFilter",(async e=>{if(e.id>0)await h.updateFilter(e),c.value[e.id]&&i();else{const t=await h.createFilter(e);s.value.pageFilters.push({id:t,enabled:!0}),a.value=null,i()}})),D("updateIndicator",u),{filterId:e,apiDataConfig:s,dataFilters:o,selectedFilters:n,newDataFilter:a,addPanelRef:t,dragInfo:l,selectFilter:e=>{s.value.pageFilters.push({id:e,enabled:!0}),i()},addFilter:()=>{a.value||(a.value={id:0,name:"新建过滤器",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})},dragEnter:()=>{u(!0,n.value.length,t.value)}}}});const J={class:"filter-list"},K=v("i",{class:"el-icon-plus icon-add"},null,-1),Q=v("div",{class:"filter-dragging-wp"},null,-1);H.render=function(e,a,t,l,s,i){const o=F("filter-collapse-panel"),n=F("el-option"),d=F("el-select");return u(),p("div",{class:["filter-wp",{"--disabled":!e.apiDataConfig.config.useFilter}]},[v("div",J,[(u(!0),p(f,null,w(e.selectedFilters,((e,a)=>(u(),p(o,{key:e.id,index:a,"data-filter":e},null,8,["index","data-filter"])))),128)),e.newDataFilter?(u(),p(o,{key:0,"data-filter":e.newDataFilter,index:e.selectedFilters.length,"is-new":"",draggable:!1,"has-feedback":!1,removable:""},null,8,["data-filter","index"])):S("",!0),v("div",{ref:"addPanelRef",class:"add-filter",onDragenter:a[2]||(a[2]=(...a)=>e.dragEnter&&e.dragEnter(...a))},[v(d,{"model-value":e.filterId,size:"mini",filterable:"",placeholder:"添加过滤器",class:"datav-new-select filter-select","popper-class":"datav-new-select-option",onChange:e.selectFilter},{default:k((()=>[(u(!0),p(f,null,w(e.dataFilters,(e=>(u(),p(n,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["model-value","onChange"]),v("div",{class:"new-filter-btn",onClick:a[1]||(a[1]=(...a)=>e.addFilter&&e.addFilter(...a))},[K])],544)]),Q,v("div",{class:"drag-indicator",style:{display:e.dragInfo.visible?"block":"none",top:e.dragInfo.top}},null,4)],2)};var W=o({name:"FieldGrid",props:{fields:{type:Object}}});const X=g();r("data-v-3cb2a0e7");const Y={key:0,class:"field-wp"},Z=v("div",{class:"field-info"},"数据相应结果应为列表，列表元素包含如下字段",-1),ee={class:"field-grid"},ae=v("div",{class:"field-item field-title"},"字段",-1),te=v("div",{class:"field-item field-title"},"映射",-1),le=v("div",{class:"field-item field-title"},"说明",-1),se={class:"field-item"},ie={class:"field-item"},oe={class:"field-item"};c();const ne=X(((e,a,t,l,s,i)=>e.fields?(u(),p("div",Y,[Z,v("div",ee,[ae,te,le,(u(!0),p(f,null,w(e.fields,((e,a)=>(u(),p(f,{key:a},[v("div",se,m(a),1),v("div",ie,m(e.map||"-"),1),v("div",oe,m(e.description||"-"),1)],64)))),128))])])):S("",!0)));W.render=ne,W.__scopeId="data-v-3cb2a0e7";var de=o({name:"SourceDrawer",components:{FilterConfig:H,FieldGrid:W,DsStaticEditor:x((()=>_((()=>import("./ds-static-editor.e881b65f.js")),["/assets/ds-static-editor.e881b65f.js","/assets/index.96b29a26.js","/assets/index.1114ac54.css"]))),DsApiEditor:x((()=>_((()=>import("./ds-api-editor.81e482ce.js")),["/assets/ds-api-editor.81e482ce.js","/assets/ds-api-editor.e4cdc83e.css","/assets/index.96b29a26.js","/assets/index.1114ac54.css"])))},setup(){const e=b(!1),a=b(!1),t=N,l=T(),s=y("com"),o=y("apiConfig"),n=y("apiDataConfig"),r=y("apiName"),c=d((()=>{const e=j.dataStatusMap[s.value.id];return e?e[r]:{}})),u=d((()=>{const e=j.originMap[s.value.id];return e?e[r]:""})),p=d((()=>{const e=j.dataMap[s.value.id];return e?e[r]:""})),f=async()=>{await V(s.value.id,r,o.value,n.value)};return D("refreshData",f),D("dataStatus",c),{visible:e,visiblePreview:a,apiType:t,datasources:l,com:s,apiConfig:o,apiDataConfig:n,dataStatus:c,dataOrign:u,resData:p,open:()=>{e.value=!0},changeSource:e=>{switch(e){case N.api:void 0===n.value.config.api&&(n.value.config=i(i({},n.value.config),O()))}},refreshData:f}}});const re=v("p",{class:"source-drawer-title"},"设置数据源",-1),ce={class:"datasource-selector"},ue=v("label",{class:"datasource-selector-title"},"数据源类型",-1),pe={class:"datasource-select"},fe={class:"datav-new-select-wp"},ve={class:"ds-preview-content"},me=v("div",{class:"ds-response-btn"},[v("i",{class:"v-icon-search"}),I(" 预览数据源返回结果 ")],-1),ge=v("span",{class:"use-filter-text"},"数据过滤器",-1),be=v("span",{class:"tutorial-popup"},"教程",-1),ye=v("span",null,"数据响应结果",-1),he={class:"data-response"};de.render=function(e,a,t,l,s,i){const o=F("el-option"),n=F("el-select"),d=F("ds-static-editor"),r=F("ds-api-editor"),c=F("g-monaco-editor"),m=F("el-popover"),g=F("el-checkbox"),b=F("filter-config"),y=F("field-grid"),h=F("el-drawer");return u(),p(h,{modelValue:e.visible,"onUpdate:modelValue":a[5]||(a[5]=a=>e.visible=a),"custom-class":"source-drawer",size:"500px"},{title:k((()=>[re])),default:k((()=>[e.visible?(u(),p(f,{key:0},[v("div",{class:["step-title",{"--error":!!e.dataStatus.errSource}]}," 数据源 ",2),v("div",ce,[ue,v("div",pe,[v("div",fe,[v(n,{modelValue:e.apiDataConfig.type,"onUpdate:modelValue":a[1]||(a[1]=a=>e.apiDataConfig.type=a),size:"mini",filterable:"",class:"datav-new-select","popper-class":"datav-new-select-option",onChange:e.changeSource},{default:k((()=>[(u(!0),p(f,null,w(e.datasources,((e,a)=>(u(),p(o,{key:a,label:e,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])])]),e.apiDataConfig.type===e.apiType.static?(u(),p(d,{key:0})):e.apiDataConfig.type===e.apiType.api?(u(),p(r,{key:1})):S("",!0),v(m,{visible:e.visiblePreview,"onUpdate:visible":a[2]||(a[2]=a=>e.visiblePreview=a),placement:"left",width:400,"popper-class":"editor-popover"},{reference:k((()=>[me])),default:k((()=>[v("div",ve,[v(c,{language:"json","read-only":!0,"auto-format":!0,height:180,code:e.dataOrign},null,8,["code"])])])),_:1},8,["visible"]),v("div",{class:["step-title",{"--error":!!e.dataStatus.errFilter}]},[v(g,{modelValue:e.apiDataConfig.config.useFilter,"onUpdate:modelValue":a[3]||(a[3]=a=>e.apiDataConfig.config.useFilter=a),class:"use-filter-btn"},null,8,["modelValue"]),ge,be],2),v(b),v(y,{fields:e.apiConfig.fields},null,8,["fields"]),v("div",{class:["step-title",{"--error":!!e.dataStatus.errSource||!!e.dataStatus.errFilter}]},[ye,v("i",{class:"el-icon-refresh refresh-btn",onClick:a[4]||(a[4]=(...a)=>e.refreshData&&e.refreshData(...a))})],2),v("div",he,[v(c,{language:"json","read-only":!0,"auto-format":!0,code:e.resData},null,8,["code"])])],64)):S("",!0)])),_:1},8,["modelValue"])};var Ce=o({name:"SourcePanel",components:{DisplayApiStatus:R,SourceDrawer:de},props:{apiName:{type:String,required:!0},activeName:String,collapse:Boolean},setup(e){const a=d((()=>e.apiName===e.activeName)),t=b(null),l=T(),s=y("com"),i=d((()=>s.value.apis[e.apiName])),o=d((()=>s.value.apiData[e.apiName]));D("apiConfig",i),D("apiDataConfig",o),D("apiName",e.apiName);const r=d((()=>{const a=j.dataMap[s.value.id];return a?a[e.apiName]:""})),c=d((()=>{const a=j.fieldStatusMap[s.value.id];return a?a[e.apiName]:{}})),u=d((()=>{const e=Object.values(c.value);return e.includes(P.loading)?n.loading:e.includes(P.failed)?n.incomplete:n.completed})),p=y("changePanel");return{visible:a,sourceDrawerRef:t,datasources:l,com:s,apiConfig:i,apiDataConfig:o,fieldsStatus:c,totalStatus:u,datav_data:r,toggle:()=>{e.collapse&&p(e.apiName)},openSourceDrawer:()=>{var e;null==(e=t.value)||e.open()},refreshData:()=>{V(s.value.id,e.apiName,i.value,o.value)}}}});const De=g();r("data-v-3f4797aa");const Fe={class:"api-editor-title"},we={key:0,class:"el-icon-arrow-right api-fold-icon"},Se={class:"api-status success"},ke={class:"attr-source-wp"},xe={class:"data-attr-table-container"},_e={class:"data-attr-table"},Te=v("thead",{class:"table-head"},[v("tr",{class:"table-head-row"},[v("th",{class:"th-item column-item attr-name"}," 字段 "),v("th",{class:"th-item column-item attr-value"}," 映射 "),v("th",{class:"th-item column-item attr-status"}," 状态 ")])],-1),je={class:"table-body"},Ne={class:"column-item attr-name"},Oe={class:"ellipsis2"},Ve={class:"column-item attr-value"},Ie={class:"column-item attr-status"},Pe={key:1,class:"table-body-row"},Ee=v("td",{class:"column-item attr-name"},[v("span",null,"任意")],-1),Ae=v("td",{class:"column-item attr-value"},null,-1),Ue={class:"column-item attr-status"},Re={class:"data-source"},ze=v("div",{class:"data-result-title"}," 数据响应结果 ",-1),Me={class:"auto-update-config"},Ge=I(" 自动更新选项 "),Le=I(" 秒一次 "),$e={class:"data-flow-wp"},qe={class:"ds-line"},Be={class:"ds-title"},He={class:"ds-type-text"},Je=I(" 配置数据源 "),Ke={class:"ds-line mt5"},Qe=v("span",null,"数据响应结果 ( 只读 ) ",-1),We={class:"ds-dots"},Xe=v("span",{class:"ds-dot"},null,-1),Ye=v("span",{class:"ds-dot"},null,-1),Ze={class:"data-response"};c();const ea=De(((e,a,t,l,s,i)=>{const o=F("display-api-status"),n=F("el-tooltip"),d=F("g-input"),r=F("el-checkbox"),c=F("el-button"),g=F("g-monaco-editor"),b=F("source-drawer");return u(),p("div",{class:["api-editor",{"--disable-fold":!e.collapse,"--fold":e.collapse&&e.visible}]},[v("div",Fe,[v("div",{class:"api-desc ellipsis2",onClick:a[1]||(a[1]=(...a)=>e.toggle&&e.toggle(...a))},[e.collapse?(u(),p("i",we)):S("",!0),I(" "+m(e.apiConfig.description||"数据接口"),1)]),v("div",Se,[v(o,{status:e.totalStatus,"success-text":"配置完成"},null,8,["status"])])]),E(v("div",ke,[v("div",xe,[v("table",_e,[Te,v("tbody",je,[Object.keys(e.apiConfig.fields).length>0?(u(!0),p(f,{key:0},w(e.apiConfig.fields,((a,t)=>(u(),p("tr",{key:t,class:"table-body-row"},[v("td",Ne,[v(n,{content:a.description,placement:"left",effect:"blue"},{default:De((()=>[v("span",Oe,m(t),1)])),_:2},1032,["content"])]),v("td",Ve,[v(d,{"model-value":a.map,placeholder:"可自定义",class:"attr-input",onChange:e=>a.map=e},null,8,["model-value","onChange"])]),v("td",Ie,[v(o,{status:e.fieldsStatus[t],optional:a.optional},null,8,["status","optional"])])])))),128)):(u(),p("tr",Pe,[Ee,Ae,v("td",Ue,[v(o,{status:"completed"})])]))])])]),v("div",Re,[ze,v("div",Me,[v(r,{modelValue:e.apiConfig.useAutoUpdate,"onUpdate:modelValue":a[2]||(a[2]=a=>e.apiConfig.useAutoUpdate=a),class:"auto-update-checkbox"},{default:De((()=>[Ge])),_:1},8,["modelValue"]),v(d,{"model-value":e.apiConfig.autoUpdate,type:"number",disabled:!e.apiConfig.useAutoUpdate,class:"update-interval-input",onChange:a[3]||(a[3]=a=>e.apiConfig.autoUpdate=a)},null,8,["model-value","disabled"]),Le]),v("div",$e,[v("div",qe,[v("div",Be,[v("span",He,m(e.datasources[e.apiDataConfig.type]),1)]),v(c,{size:"mini",class:"ds-action-btn",onClick:e.openSourceDrawer},{default:De((()=>[Je])),_:1},8,["onClick"])]),v("div",Ke,[Qe,v(n,{content:"刷新数据",placement:"left",effect:"blue"},{default:De((()=>[v("i",{class:"el-icon-refresh refresh-btn",onClick:a[4]||(a[4]=(...a)=>e.refreshData&&e.refreshData(...a))})])),_:1})]),v("div",We,[v("span",{class:["ds-dot",["completed"===e.totalStatus?"active":"error"]]},null,2),Xe,Ye])]),v("div",Ze,[v(g,{language:"json","read-only":!0,"auto-format":!0,code:e.datav_data,height:250,"full-screen-title":"数据响应结果"},null,8,["code"])])])],512),[[A,e.visible]]),v(b,{ref:"sourceDrawerRef"},null,512)],2)}));Ce.render=ea,Ce.__scopeId="data-v-3f4797aa";export default Ce;
