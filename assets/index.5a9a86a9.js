import{d as e,U as a,e as l,j as o,k as n,M as r,f as t,l as i,o as s,c as u,a as d,n as p,w as c,t as m,b as g}from"./index.1975b1b8.js";import{u as f,p as v,v as y,g as b}from"./qiniu.ecb66714.js";var k=e({name:"GUploadImage",props:{modelValue:{type:String,required:!0},allowType:{type:String,default:"gif|jpeg|jpg|png"},size:{type:Number,default:2},action:{type:String,default:f},previewHost:{type:String,default:v},label:{type:String,default:""},isInline:Boolean},emits:[a],setup(e,t){const i=l(!1),s=l({key:"",token:""}),u=l(!1);return o((()=>e.modelValue),(()=>{const a=new Image;a.src=e.modelValue,a.onload=()=>{u.value=!1},a.onerror=()=>{u.value=!0,e.modelValue&&r.error("图片加载失败")}})),{loading:i,form:s,iserr:u,beforeUpload:async a=>{if(!y(a,{allowType:e.allowType,allowSize:e.size}))return!1;try{return i.value=!0,s.value.token=await b(),s.value.key=`upload/${n()}_${a.name}`,!0}catch(l){i.value=!1,r.error(l.toString())}return!1},onSuccess:l=>{i.value=!1,t.emit(a,`${e.previewHost}/${l.key}`)},onError:e=>{i.value=!1,r.error(e.toString())},handleInput:e=>{t.emit(a,e)}}}});const w={key:1,class:"g-upload-tip"},S=d("i",{class:"v-icon-img"},null,-1),V=d("div",null,"点击或拖拽文件到这里更换",-1),I={key:0,class:"g-input__caption"};k.render=function(e,a,l,o,n,r){const f=t("el-input"),v=t("el-upload"),y=i("loading");return s(),u("div",{class:["datav-gui g-upload",[{"--inline --single":e.isInline}]]},[d(f,{"model-value":e.modelValue,placeholder:"请输入图片地址","prefix-icon":"v-icon-link",size:"mini",clearable:"","onUpdate:modelValue":e.handleInput},null,8,["model-value","onUpdate:modelValue"]),p(d(v,{"element-loading-text":"正在上传...","element-loading-spinner":"v-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.7)",drag:"",accept:"image/*",action:e.action,multiple:!1,"show-file-list":!1,"before-upload":e.beforeUpload,"on-success":e.onSuccess,"on-error":e.onError,data:e.form},{default:c((()=>[e.modelValue&&!e.iserr?(s(),u("img",{key:0,src:e.modelValue},null,8,["src"])):(s(),u("div",w,[S,V]))])),_:1},8,["action","before-upload","on-success","on-error","data"]),[[y,e.loading]]),e.label?(s(),u("span",I,m(e.label),1)):g("",!0)],2)},k.install=e=>{e.component(k.name,k)};export default k;
