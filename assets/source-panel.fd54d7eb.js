var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,i=(e,i)=>{for(var o in i||(i={}))t.call(i,o)&&s(e,o,i[o]);if(a)for(var o of a(i))l.call(i,o)&&s(e,o,i[o]);return e};import{d as o,a_ as n,a4 as d,p as c,k as r,o as u,c as p,F as f,a as v,t as g,l as m,g as b,a5 as h,aC as y,au as C,r as w,b as D,al as S,aD as k,a$ as F,b0 as _,b1 as x,b2 as j,b3 as T,w as N,e as O,aj as V,b4 as U,a8 as P,b5 as E}from"./index.22eaa455.js";import{l as I}from"./index.a490d289.js";import"./editor.worker.3eb73e22.js";import"./dom.1228cadc.js";var A=o({name:"DisplayApiStatus",props:{status:{type:String,default:n.incomplete},loadingText:{type:String,default:"匹配中"},successText:{type:String,default:"匹配成功"},failedText:{type:String,default:"未找到字段"},completedText:{type:String,default:"配置完成"},incompleteText:{type:String,default:"配置未完成"},optional:{type:Boolean,default:!1}},setup(e){const a=d((()=>e.status===n.loading?e.loadingText:e.status===n.success?e.successText:e.status===n.completed?e.completedText:e.optional?"可选":e.status===n.failed?e.failedText:e.status===n.incomplete?e.incompleteText:e.status));return{apiStatus:n,statusText:a}}});const M=m();c("data-v-7213c838");const z=v("i",{class:"status-icon validating"},null,-1),R=v("i",{class:"status-icon validating"},null,-1),$=v("i",{class:"status-icon validating"},null,-1),B={key:2,class:"status-icon --success"},G={class:"status-text"};r();const L=M(((e,a,t,l,s,i)=>(u(),p("div",null,[e.status===e.apiStatus.loading?(u(),p(f,{key:0},[z,R,$],64)):e.status===e.apiStatus.success||e.status===e.apiStatus.completed?(u(),p("i",{key:1,class:["status-icon",`--${e.status}`]},null,2)):e.optional?(u(),p("i",B)):(u(),p("i",{key:3,class:["status-icon",`--${e.status}`]},null,2)),v("span",G,g(e.statusText),1)]))));A.render=L,A.__scopeId="data-v-7213c838";var q=o({name:"FilterConfig",setup(){const e=b(void 0),a=h("apiDataConfig"),t=d((()=>{const e=a.value.config.pageFilters.map((e=>e.id));return y.dataFilters.filter((a=>!e.includes(a.id)))})),l=d((()=>{const e=[...C.coms,...C.subComs],a=Object.create(null);return e.forEach((e=>{for(const t in e.apiData){e.apiData[t].config.pageFilters.forEach((t=>{a[t.id]?a[t.id].push(e.alias):a[t.id]=[e.alias]}))}})),a})),s=d((()=>{const e=a.value.config.pageFilters.map((e=>e.id));return y.dataFilters.filter((a=>e.includes(a.id)))})),i=d((()=>a.value.config.pageFilters.reduce(((e,a)=>(e[a.id]=a.enabled,e)),{})));return{filterId:e,apiDataConfig:a,dataFilters:t,usedFilters:l,selectedFilters:s,enabledFilters:i,selectFilter:e=>{a.value.config.pageFilters.push({id:e,enabled:!0})},onUsedChange:(e,t)=>{a.value.config.pageFilters.find((a=>a.id===e)).enabled=t},editFilterName:(e,a)=>{const t=e.trim();t&&(a.name=t),delete a.editing},delFilter:e=>{a.value.config.pageFilters=a.value.config.pageFilters.filter((a=>a.id!==e))}}}});const H=m();c("data-v-1016599e");const J={class:"filter-list"},K={class:"panel-header"},Q={class:"panel-title"},W={class:"filter-title"},X=v("i",{class:"v-icon-drag drag-btn",draggable:""},null,-1),Y={class:"filter-name"},Z={class:"action-wp --edit"},ee={class:"filter-count"},ae={class:"action-wp"},te=v("div",{class:"filter-dot"},null,-1),le=v("div",{class:"toggle-btn"},[v("i",{class:"el-icon-arrow-right toggle-icon"})],-1),se={class:"add-filter"},ie=v("div",{class:"new-filter-btn"},[v("i",{class:"el-icon-plus icon-add"})],-1),oe=v("div",{class:"filter-dragging-wp"},null,-1),ne=v("div",{class:"drag-indicator"},null,-1);r();const de=H(((e,a,t,l,s,i)=>{const o=w("el-checkbox"),n=w("g-input"),d=w("g-tooltip-popover"),c=w("el-tooltip"),r=w("el-option"),m=w("el-select");return u(),p("div",{class:["filter-wp",{"--disabled":e.apiDataConfig.config.useFilter}]},[v("div",J,[(u(!0),p(f,null,D(e.selectedFilters,(a=>(u(),p("div",{key:a.id,class:"collapse-panel-wp filter-item --draggable ds-panel-filter"},[v("div",K,[v("div",Q,[v("div",W,[X,v(o,{"model-value":e.enabledFilters[a.id],class:"enable-checkbox",onChange:t=>e.onUsedChange(a.id,t)},null,8,["model-value","onChange"]),v("div",Y,[a.editing?(u(),p(n,{key:0,"model-value":a.name,autofocus:!0,class:"filter-name-input",onChange:t=>e.editFilterName(t,a)},null,8,["model-value","onChange"])):(u(),p("div",{key:1,class:"filter-name-text",title:a.name},g(a.name),9,["title"]))]),v("div",Z,[v(d,{content:"重命名"},{default:H((()=>[v("i",{class:"v-icon-edit edit-btn",onClick:e=>a.editing=!0},null,8,["onClick"])])),_:2},1024)]),v("div",ee,[v(c,{content:e.usedFilters[a.id].join(", "),effect:"blue",enterable:!1,placement:"top","popper-class":"filter-dep-info"},{default:H((()=>[v("span",null,g(e.usedFilters[a.id].length)+" 个组件正在调用",1)])),_:2},1032,["content"])]),v("div",ae,[v(d,{content:"删除"},{default:H((()=>[v("i",{class:"v-icon-close del-btn",onClick:t=>e.delFilter(a.id)},null,8,["onClick"])])),_:2},1024)]),te])]),le])])))),128)),v("div",se,[v(m,{"model-value":e.filterId,size:"mini",filterable:"",placeholder:"添加过滤器",class:"datav-new-select filter-select","popper-class":"datav-new-select-option",onChange:e.selectFilter},{default:H((()=>[(u(!0),p(f,null,D(e.dataFilters,(e=>(u(),p(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["model-value","onChange"]),ie])]),oe,ne],2)}));q.render=de,q.__scopeId="data-v-1016599e";var ce=o({name:"FieldGrid",props:{fields:{type:Object}}});const re=m();c("data-v-c0253736");const ue={key:0,class:"field-wp"},pe=v("div",{class:"field-info"},"数据相应结果应为列表，列表元素包含如下字段",-1),fe={class:"field-grid"},ve=v("div",{class:"field-item field-title"},"字段",-1),ge=v("div",{class:"field-item field-title"},"映射",-1),me=v("div",{class:"field-item field-title"},"说明",-1),be={class:"field-item"},he={class:"field-item"},ye={class:"field-item"};r();const Ce=re(((e,a,t,l,s,i)=>e.fields?(u(),p("div",ue,[pe,v("div",fe,[ve,ge,me,(u(!0),p(f,null,D(e.fields,((e,a)=>(u(),p(f,{key:a},[v("div",be,g(a),1),v("div",he,g(e.map||"-"),1),v("div",ye,g(e.description||"-"),1)],64)))),128))])])):S("",!0)));ce.render=Ce,ce.__scopeId="data-v-c0253736";var we=o({name:"SourceDrawer",components:{FilterConfig:q,FieldGrid:ce,DsStaticEditor:I((()=>k((()=>import("./ds-static-editor.02ff9f5e.js")),["/assets/ds-static-editor.02ff9f5e.js","/assets/index.22eaa455.js","/assets/index.079790e4.css","/assets/editor.worker.3eb73e22.js"]))),DsApiEditor:I((()=>k((()=>import("./ds-api-editor.b7b60049.js")),["/assets/ds-api-editor.b7b60049.js","/assets/ds-api-editor.e4cdc83e.css","/assets/index.22eaa455.js","/assets/index.079790e4.css","/assets/editor.worker.3eb73e22.js"])))},setup(){const e=b(!1),a=b(!1),t=x,l=F(),s=h("com"),o=h("apiConfig"),n=h("apiDataConfig"),c=h("apiName"),r=d((()=>_.dataStatusMap[s.value.id]||{})),u=d((()=>{const e=_.originMap[s.value.id];return e?e[c]:""})),p=d((()=>{const e=_.dataMap[s.value.id];return e?e[c]:""}));return{visible:e,visiblePreview:a,apiType:t,datasources:l,com:s,apiConfig:o,apiDataConfig:n,dataStatus:r,dataOrign:u,resData:p,open:()=>{e.value=!0},changeSource:e=>{switch(e){case x.api:void 0===n.value.config.api&&(n.value.config=i(i({},n.value.config),j()))}},refreshData:()=>{T(s.value.id,c,o.value,n.value)}}}});const De=v("p",{class:"source-drawer-title"},"设置数据源",-1),Se={class:"datasource-selector"},ke=v("label",{class:"datasource-selector-title"},"数据源类型",-1),Fe={class:"datasource-select"},_e={class:"datav-new-select-wp"},xe={class:"ds-preview-content"},je=v("div",{class:"ds-response-btn"},[v("i",{class:"v-icon-search"}),O(" 预览数据源返回结果 ")],-1),Te=v("span",{class:"use-filter-text"},"数据过滤器",-1),Ne=v("span",{class:"tutorial-popup"},"教程",-1),Oe=v("span",null,"数据响应结果",-1),Ve={class:"data-response"};we.render=function(e,a,t,l,s,i){const o=w("el-option"),n=w("el-select"),d=w("ds-static-editor"),c=w("ds-api-editor"),r=w("g-monaco-editor"),g=w("el-popover"),m=w("el-checkbox"),b=w("filter-config"),h=w("field-grid"),y=w("el-drawer");return u(),p(y,{modelValue:e.visible,"onUpdate:modelValue":a[5]||(a[5]=a=>e.visible=a),"custom-class":"source-drawer",size:"500px"},{title:N((()=>[De])),default:N((()=>[e.visible?(u(),p(f,{key:0},[v("div",{class:["step-title",{"--error":e.dataStatus.errSource}]}," 数据源 ",2),v("div",Se,[ke,v("div",Fe,[v("div",_e,[v(n,{modelValue:e.apiDataConfig.type,"onUpdate:modelValue":a[1]||(a[1]=a=>e.apiDataConfig.type=a),size:"mini",filterable:"",class:"datav-new-select","popper-class":"datav-new-select-option",onChange:e.changeSource},{default:N((()=>[(u(!0),p(f,null,D(e.datasources,((e,a)=>(u(),p(o,{key:a,label:e,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])])]),e.apiDataConfig.type===e.apiType.static?(u(),p(d,{key:0})):e.apiDataConfig.type===e.apiType.api?(u(),p(c,{key:1})):S("",!0),v(g,{visible:e.visiblePreview,"onUpdate:visible":a[2]||(a[2]=a=>e.visiblePreview=a),placement:"left",width:400,"popper-class":"editor-popover"},{reference:N((()=>[je])),default:N((()=>[v("div",xe,[v(r,{language:"json","read-only":!0,"auto-format":!0,height:180,code:e.dataOrign},null,8,["code"])])])),_:1},8,["visible"]),v("div",{class:["step-title",{"--error":e.dataStatus.errFilter}]},[v(m,{modelValue:e.apiDataConfig.config.useFilter,"onUpdate:modelValue":a[3]||(a[3]=a=>e.apiDataConfig.config.useFilter=a),class:"use-filter-btn"},null,8,["modelValue"]),Te,Ne],2),v(b),v(h,{fields:e.apiConfig.fields},null,8,["fields"]),v("div",{class:["step-title",{"--error":e.dataStatus.errSource||e.dataStatus.errFilter}]},[Oe,v("i",{class:"el-icon-refresh refresh-btn",onClick:a[4]||(a[4]=(...a)=>e.refreshData&&e.refreshData(...a))})],2),v("div",Ve,[v(r,{language:"json","read-only":!0,"auto-format":!0,code:e.resData},null,8,["code"])])],64)):S("",!0)])),_:1},8,["modelValue"])};var Ue=o({name:"SourcePanel",components:{DisplayApiStatus:A,SourceDrawer:we},props:{apiName:{type:String,required:!0},activeName:String,collapse:Boolean},setup(e){const a=d((()=>e.apiName===e.activeName)),t=b(null),l=F(),s=h("com"),i=d((()=>s.value.apis[e.apiName])),o=d((()=>s.value.apiData[e.apiName]));V("apiConfig",i),V("apiDataConfig",o),V("apiName",e.apiName);const c=d((()=>{const a=_.dataMap[s.value.id];return a?a[e.apiName]:""})),r=d((()=>{const a=_.fieldStatusMap[s.value.id];return a?a[e.apiName]:{}})),u=d((()=>{const e=Object.values(r.value);return e.includes(U.loading)?n.loading:e.includes(U.failed)?n.incomplete:n.completed})),p=h("changePanel");return{visible:a,sourceDrawerRef:t,datasources:l,com:s,apiConfig:i,apiDataConfig:o,fieldsStatus:r,totalStatus:u,datav_data:c,toggle:()=>{e.collapse&&p(e.apiName)},openSourceDrawer:()=>{var e;null==(e=t.value)||e.open()},refreshData:()=>{T(s.value.id,e.apiName,i.value,o.value)}}}});const Pe=m();c("data-v-4b60f1c2");const Ee={class:"api-editor-title"},Ie={key:0,class:"el-icon-arrow-right api-fold-icon"},Ae={class:"api-status success"},Me={class:"attr-source-wp"},ze={class:"data-attr-table-container"},Re={class:"data-attr-table"},$e=v("thead",{class:"table-head"},[v("tr",{class:"table-head-row"},[v("th",{class:"th-item column-item attr-name"}," 字段 "),v("th",{class:"th-item column-item attr-value"}," 映射 "),v("th",{class:"th-item column-item attr-status"}," 状态 ")])],-1),Be={class:"table-body"},Ge={class:"column-item attr-name"},Le={class:"ellipsis2"},qe={class:"column-item attr-value"},He={class:"column-item attr-status"},Je={key:1,class:"table-body-row"},Ke=v("td",{class:"column-item attr-name"},[v("span",null,"任意")],-1),Qe=v("td",{class:"column-item attr-value"},null,-1),We={class:"column-item attr-status"},Xe={class:"data-source"},Ye=v("div",{class:"data-result-title"}," 数据响应结果 ",-1),Ze={class:"auto-update-config"},ea=O(" 自动更新选项 "),aa=O(" 秒一次 "),ta={class:"data-flow-wp"},la={class:"ds-line"},sa={class:"ds-title"},ia=v("span",{class:"ds-title-text"},"数据源",-1),oa={class:"ds-type-text"},na=O(" 配置数据源 "),da={class:"ds-line mt5"},ca=v("span",null,"数据响应结果 ( 只读 ) ",-1),ra={class:"ds-dots"},ua=v("span",{class:"ds-dot"},null,-1),pa=v("span",{class:"ds-dot"},null,-1),fa={class:"data-response"};r();const va=Pe(((e,a,t,l,s,i)=>{const o=w("display-api-status"),n=w("el-tooltip"),d=w("g-input"),c=w("el-checkbox"),r=w("el-button"),m=w("g-monaco-editor"),b=w("source-drawer");return u(),p("div",{class:["api-editor",{"--disable-fold":!e.collapse,"--fold":e.collapse&&e.visible}]},[v("div",Ee,[v("div",{class:"api-desc ellipsis2",onClick:a[1]||(a[1]=(...a)=>e.toggle&&e.toggle(...a))},[e.collapse?(u(),p("i",Ie)):S("",!0),O(" "+g(e.apiConfig.description||"数据接口"),1)]),v("div",Ae,[v(o,{status:e.totalStatus,"success-text":"配置完成"},null,8,["status"])])]),P(v("div",Me,[v("div",ze,[v("table",Re,[$e,v("tbody",Be,[Object.keys(e.apiConfig.fields).length>0?(u(!0),p(f,{key:0},D(e.apiConfig.fields,((a,t)=>(u(),p("tr",{key:t,class:"table-body-row"},[v("td",Ge,[v(n,{content:a.description,placement:"left",effect:"blue"},{default:Pe((()=>[v("span",Le,g(t),1)])),_:2},1032,["content"])]),v("td",qe,[v(d,{"model-value":a.map,placeholder:"可自定义",class:"attr-input",onChange:e=>a.map=e},null,8,["model-value","onChange"])]),v("td",He,[v(o,{status:e.fieldsStatus[t],optional:a.optional},null,8,["status","optional"])])])))),128)):(u(),p("tr",Je,[Ke,Qe,v("td",We,[v(o,{status:"completed"})])]))])])]),v("div",Xe,[Ye,v("div",Ze,[v(c,{modelValue:e.apiConfig.useAutoUpdate,"onUpdate:modelValue":a[2]||(a[2]=a=>e.apiConfig.useAutoUpdate=a),class:"auto-update-checkbox"},{default:Pe((()=>[ea])),_:1},8,["modelValue"]),v(d,{"model-value":e.apiConfig.autoUpdate,type:"number",disabled:!e.apiConfig.useAutoUpdate,class:"update-interval-input",onChange:a[3]||(a[3]=a=>e.apiConfig.autoUpdate=a)},null,8,["model-value","disabled"]),aa]),v("div",ta,[v("div",la,[v("div",sa,[ia,v("span",oa,g(e.datasources[e.apiDataConfig.type]),1)]),v(r,{size:"mini",class:"ds-action-btn",onClick:e.openSourceDrawer},{default:Pe((()=>[na])),_:1},8,["onClick"])]),v("div",da,[ca,v(n,{content:"刷新数据",placement:"left",effect:"blue"},{default:Pe((()=>[v("i",{class:"el-icon-refresh refresh-btn",onClick:a[4]||(a[4]=(...a)=>e.refreshData&&e.refreshData(...a))})])),_:1})]),v("div",ra,[v("span",{class:["ds-dot",["completed"===e.totalStatus?"active":"error"]]},null,2),ua,pa])]),v("div",fa,[v(m,{language:"json","read-only":!0,"auto-format":!0,code:e.datav_data,height:250,"full-screen-title":"数据响应结果"},null,8,["code"])])])],512),[[E,e.visible]]),v(b,{ref:"sourceDrawerRef"},null,512)],2)}));Ue.render=va,Ue.__scopeId="data-v-4b60f1c2";export default Ue;
