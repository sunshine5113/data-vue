import{M as e,g as a,V as t,f as r,d as o,A as s,h as l,m as n,t as c,r as i,p as d,L as u,y as p,B as g,C as v,u as m,v as h,D as f,U as y,ad as j,x as b,G as P,X as w,j as E,n as C,S as _,q as D,ae as T,O as k,F as G,E as I,a4 as O,P as R,N as S,a5 as U}from"./editor.worker.0b81cf4b.js";import{s as V,g as J,d as N,u as A,m as x,c as L,a as M,b as B,e as $,M as q,f as K,U as Y,h as z,i as F,j as X,p as H}from"./index.1ace366a.js";import{P as Q,a as W}from"./project.ec6ffcb1.js";import{a as Z,r as ee}from"./dom.1228cadc.js";import{c as ae,d as te}from"./images.a8ceee1d.js";var re=Object.defineProperty,oe=Object.getOwnPropertyDescriptor,se=(e,a,t,r)=>{for(var o,s=r>1?void 0:r?oe(a,t):a,l=e.length-1;l>=0;l--)(o=e[l])&&(s=(r?o(a,t,s):o(s))||s);return r&&s&&re(a,t,s),s};l.rawError=!0;let le=class extends t{constructor(){super(...arguments),this.allGroups=[]}get group(){const e=this.allGroups.flatMap((e=>e.children));return new Q(-1,"全部应用",e)}get ungroup(){const e=this.allGroups.find((e=>e.type===W.ungroup));return e||new Q(0,"未分组",[])}get groups(){return this.allGroups.filter((e=>e.type===W.group))}SET_PROJECTS(e){this.allGroups=e}DELETE_PROJECT(e){const a=this.allGroups.find((a=>a.id===e.gid));a&&(a.children=a.children.filter((a=>a.id!==e.pid)))}UPDATE_PROJECT_NAME(e){const a=this.allGroups.find((a=>a.id===e.id));a&&(a.name=e.newName)}MOVE_PROJECT(e){const{pid:a,fromId:t,toId:r}=e,o=this.allGroups.find((e=>e.id===t)),s=this.allGroups.find((e=>e.id===r));if(o&&s){const e=o.children.findIndex((e=>e.id===a)),t=o.children.splice(e,1)[0];t.groupId=r,s.children.push(t)}}COPY_PROJECT(e){const a=this.allGroups.find((a=>a.id===e.gid));if(a){const t=a.children.find((a=>a.id===e.pid)),o=r(t);o.id=Math.round(1e3*Math.random()),o.name+="_copy",a.children.push(o)}}CREATE_PROJECT_GROUP(e){const a=new Q(e.id,e.name,[]);a.type=W.group,this.allGroups.unshift(a)}DELETE_PROJECT_GROUP(e){const a=this.allGroups.findIndex((a=>a.id===e)),t=this.allGroups.find((e=>e.type===W.ungroup));if(a>-1&&t){const[e]=this.allGroups.splice(a,1);e.children.forEach((e=>{e.groupId=t.id,t.children.push(e)}))}}async getProjects(){try{const e=await J();if(0!==e.data.code)throw Error(e.data.message);{const a=e.data.data||[],t=new Q(0,"未分组",[]);a.forEach((e=>{e.children.forEach((a=>{e.type===W.ungroup?(a.groupId=0,t.children.push(a)):a.groupId=e.id}))})),this.SET_PROJECTS([t,...a.filter((e=>e.type===W.group))])}}catch(e){throw e}}async deleteProject(e){try{const a=await N(e.pid);if(0!==a.data.code)throw Error(a.data.message);this.DELETE_PROJECT(e)}catch(a){throw a}}async updateProjectName(e){try{const a=await A(e.id,e.newName);if(0!==a.data.code)throw Error(a.data.message)}catch(a){throw a}}async moveProject(e){try{const{pid:a,fromId:t,toId:r}=e,o=await x(a,t,r);if(0!==o.data.code)throw Error(o.data.message);this.MOVE_PROJECT(e)}catch(a){throw a}}async copyProject(e){try{const a=await L(e.pid);if(0!==a.data.code)throw Error(a.data.message);this.COPY_PROJECT(e)}catch(a){throw a}}async createProjectGroup(e){try{const{data:a}=await M({name:e});if(0!==a.code)throw Error(a.message);this.CREATE_PROJECT_GROUP({id:a.data,name:e})}catch(a){throw a}}async deleteProjectGroup(e){try{const a=await B(e);if(0!==a.data.code)throw Error(a.data.message);this.DELETE_PROJECT_GROUP(e)}catch(a){throw a}}async updateProjectGroupName(e){try{const a=await $(e.id,e.newName);if(0!==a.data.code)throw Error(a.data.message)}catch(a){throw a}}};se([o],le.prototype,"SET_PROJECTS",1),se([o],le.prototype,"DELETE_PROJECT",1),se([o],le.prototype,"UPDATE_PROJECT_NAME",1),se([o],le.prototype,"MOVE_PROJECT",1),se([o],le.prototype,"COPY_PROJECT",1),se([o],le.prototype,"CREATE_PROJECT_GROUP",1),se([o],le.prototype,"DELETE_PROJECT_GROUP",1),se([s],le.prototype,"getProjects",1),se([s],le.prototype,"deleteProject",1),se([s],le.prototype,"updateProjectName",1),se([s],le.prototype,"moveProject",1),se([s],le.prototype,"copyProject",1),se([s],le.prototype,"createProjectGroup",1),se([s],le.prototype,"deleteProjectGroup",1),se([s],le.prototype,"updateProjectGroupName",1),le=se([e({dynamic:!0,store:V,name:"project"})],le);const ne=a(le);var ce=n({name:"MyScreen",props:{screen:{type:Object,required:!0}},setup(e){const{deleteProject:a,copyProject:t,updateProjectName:r}=ne,{id:o,name:s,groupId:l,share:n,config:p}=c(e.screen),g=i(s.value),v=i(s.value),m=d((()=>p.value.screenshot?{"background-image":`url(${p.value.screenshot})`}:{"background-image":`url(${ae})`,"background-size":"50%","background-position":"center center","background-repeat":"no-repeat",filter:"grayscale(1)",opacity:.07})),h=d((()=>{const e=!!n.value;return{published:e,text:e?"已发布":"未发布"}})),f=u("dragStart"),y=u("dragEnd"),j=u("publish"),b=new Image;b.src=te;return{name:s,thumbnail:m,publishState:h,screenName:g,oldScreenName:v,onInputBlur:async()=>{if(g.value)try{await r({id:o.value,newName:g.value}),s.value=g.value}catch(e){q.error(q.format(e))}else g.value=v.value},confirmCopyProject:()=>{t({pid:o.value,gid:l.value})},confirmDeleteProject:()=>{K.confirmAsync(`<b>${g.value}</b> 删除后无法恢复，确认删除？`,(()=>a({pid:o.value,gid:l.value})))},onDragStart:e=>{f();const a=e.dataTransfer;a&&(a.effectAllowed="move",a.setDragImage(b,30,30),a.setData("text",`${o.value},${l.value}`))},onDragEnd:()=>{y()},doPublish:()=>{j(o.value)}}}});const ie=P();p("data-v-496332e7");const de={class:"my-screen"},ue={class:"screen"},pe={class:"screen-info"},ge={class:"screen-edit"},ve={class:"screen-button"},me=w(" 编辑 "),he={class:"main-button"},fe=f("i",{class:"v-icon-move"},null,-1),ye=f("i",{class:"v-icon-copy"},null,-1),je=f("i",{class:"v-icon-delete"},null,-1),be=f("i",{class:"v-icon-preview"},null,-1),Pe=f("i",{class:"v-icon-release"},null,-1),we={class:"screen-main"},Ee={class:"main-name"},Ce={class:"screen-name-input"},_e=f("i",{class:"v-icon-edit"},null,-1),De={class:"publish-info"};g();const Te=ie(((e,a,t,r,o,s)=>{const l=v("el-button"),n=v("router-link"),c=v("g-tooltip-popover");return m(),h("div",de,[f("div",ue,[f("div",pe,[f("div",{class:"screen-img",style:e.thumbnail},null,4),f("div",ge,[f("div",ve,[f(n,{to:{name:"Screen",params:{projectId:e.screen.id}},target:"_blank",class:"edit-wrap"},{default:ie((()=>[f(l,{type:"primary",size:"small",class:"edit"},{default:ie((()=>[me])),_:1})])),_:1},8,["to"]),f("div",he,[f(c,{content:"移动"},{default:ie((()=>[f("span",{class:"button-span",draggable:"true",onDragstart:a[1]||(a[1]=(...a)=>e.onDragStart&&e.onDragStart(...a)),onDragend:a[2]||(a[2]=(...a)=>e.onDragEnd&&e.onDragEnd(...a))},[fe],32)])),_:1}),f(c,{content:"复制"},{default:ie((()=>[f("span",{class:"button-span",onClick:a[3]||(a[3]=(...a)=>e.confirmCopyProject&&e.confirmCopyProject(...a))},[ye])])),_:1}),f(c,{content:"删除"},{default:ie((()=>[f("span",{class:"button-span",onClick:a[4]||(a[4]=(...a)=>e.confirmDeleteProject&&e.confirmDeleteProject(...a))},[je])])),_:1})])]),f(n,{to:{name:"Screen",params:{projectId:e.screen.id}},target:"_blank",class:"preview"},{default:ie((()=>[f(c,{content:"预览"},{default:ie((()=>[be])),_:1})])),_:1},8,["to"]),f("div",{class:"public",onClick:a[5]||(a[5]=(...a)=>e.doPublish&&e.doPublish(...a))},[f(c,{content:"发布"},{default:ie((()=>[Pe])),_:1})])])]),f("div",we,[f("div",Ee,[f(c,{placement:"top-start","show-after":1e3,content:e.screen.name},{default:ie((()=>[f("div",Ce,[_e,y(f("input",{"onUpdate:modelValue":a[6]||(a[6]=a=>e.screenName=a),class:"input",onBlur:a[7]||(a[7]=(...a)=>e.onInputBlur&&e.onInputBlur(...a))},null,544),[[j,e.screenName,void 0,{trim:!0}]])])])),_:1},8,["content"]),f("div",De,[f("span",{class:["dot",{published:e.publishState.published}]},null,2),f("span",null,b(e.publishState.text),1)])])])])])}));ce.render=Te,ce.__scopeId="data-v-496332e7";var ke=n({name:"PublishScreen",props:{projectId:{type:Number,required:!0},modelValue:{type:Boolean,required:!0}},emits:[Y],setup(e,a){const t=i(!1),r=i(!1),o=i(!1),s=i(""),l=i("password"),n=i(!0),c=d((()=>r.value?z(e.projectId):"")),u=()=>{t.value=!1,a.emit(Y,!1)};E((()=>e.modelValue),(e=>{t.value=!!e})),E((()=>e.projectId),(async()=>{try{const a=await F(e.projectId);if(0===a.data.code){const{data:e}=a.data;n.value=!1,r.value=!!e.share,s.value=e.password}}catch(a){console.log(a)}}));return{visible:t,isPublish:r,shareUrl:c,showTooltip:o,password:s,copyUrl:()=>{r.value&&C((()=>{X(c.value)&&q.success("复制成功")}))},closeDialog:u,loading:n,passwordType:l,publish:async()=>{try{n.value=!0;const a={share:c.value,password:s.value};0===(await H(e.projectId,a)).data.code&&(n.value=!1,u(),q.success(r.value?"发布成功":"保存成功"))}catch(a){q.error("发布失败")}finally{n.value=!1}}}}});const Ge=P();p("data-v-634690e2");const Ie={class:"share-setting","element-loading-background":"rgba(48, 54, 64, 0.8)"},Oe={class:"share-header"},Re={class:"header-wp"},Se=f("label",{class:"label-color"},"发布分享：",-1),Ue={class:"share-switch"},Ve={class:"share-tutorial"},Je=w(" 查看教程 "),Ne={class:"share-verify"},Ae=f("div",{class:"label-color"},"分享链接",-1),xe={class:"link-content"},Le=f("div",{class:"label-color"},"访问密码",-1),Me={class:"share-pwd"},Be={class:"initial-dialog"};g();const $e=Ge(((e,a,t,r,o,s)=>{const l=v("el-switch"),n=v("router-link"),c=v("el-tooltip"),i=v("g-input"),d=v("el-button"),u=v("el-dialog"),p=_("loading");return m(),h(u,{modelValue:e.visible,"onUpdate:modelValue":a[10]||(a[10]=a=>e.visible=a),title:"发布",width:"435px",onClose:e.closeDialog},{default:Ge((()=>[y(f("div",Ie,[f("div",Oe,[f("div",Re,[Se,f("div",Ue,[f(l,{modelValue:e.isPublish,"onUpdate:modelValue":a[1]||(a[1]=a=>e.isPublish=a)},null,8,["modelValue"])])]),f("div",Ve,[f(n,{to:{name:"MyCase"},class:"share-tutorial-url",target:"_blank"},{default:Ge((()=>[Je])),_:1})])]),f("div",Ne,[Ae,f("div",xe,[f(c,{modelValue:e.showTooltip,"onUpdate:modelValue":a[5]||(a[5]=a=>e.showTooltip=a),effect:"blue",placement:"top",content:"点击复制",manual:!0,disabled:!e.isPublish},{default:Ge((()=>[f("textarea",{value:e.shareUrl,class:"g-input share-input",readonly:"",placeholder:"开启发布分享后可获取访问链接",onClick:a[2]||(a[2]=(...a)=>e.copyUrl&&e.copyUrl(...a)),onMouseenter:a[3]||(a[3]=a=>e.showTooltip=!0),onMouseleave:a[4]||(a[4]=a=>e.showTooltip=!1)},null,40,["value"])])),_:1},8,["modelValue","disabled"]),f("div",{class:"func-btn",onClick:a[6]||(a[6]=(...a)=>e.copyUrl&&e.copyUrl(...a))},"复制")]),Le,f("div",Me,[f(i,{modelValue:e.password,"onUpdate:modelValue":a[7]||(a[7]=a=>e.password=a),type:e.passwordType,placeholder:"设置访问密码",class:"pwd-input"},null,8,["modelValue","type"]),f("div",{class:"func-btn",onClick:a[8]||(a[8]=a=>e.passwordType?e.passwordType="":e.passwordType="password")},b(e.passwordType?"查看":"隐藏"),1),f("div",{class:"func-btn",onClick:a[9]||(a[9]=a=>e.password="")}," 清空 ")])]),f("div",Be,[f(d,{type:"primary",class:"publish-btn",onClick:e.publish},{default:Ge((()=>[w(b(e.isPublish?"发布大屏":"保存"),1)])),_:1},8,["onClick"])])],512),[[p,e.loading]])])),_:1},8,["modelValue","onClose"])}));ke.render=$e,ke.__scopeId="data-v-634690e2";var qe=n({name:"ProjectList",components:{MyScreen:ce,PublishScreen:ke},props:{group:Object},setup(e){const a=i(""),t=i("name"),r=i({name:"按名称排序",createAt:"按创建时间排序",updateAt:"按修改时间排序"}),o=i(!1),s=i(0),l=D(e,"group"),n=d((()=>{let e=l.value?l.value.children:[];if(a.value){const t=a.value.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(t)))}return T(e,t.value)}));return k("publish",(e=>{o.value=!0,s.value=e})),{searchText:a,sort:t,sorts:r,visiblePublish:o,publishAppId:s,onSortChange:e=>{t.value=e},screens:n}}});const Ke=P();p("data-v-7df90232");const Ye=f("div",{class:"new-projects-title"},"选择下面的方式进行创建",-1),ze={class:"new-projects"},Fe=f("img",{src:"/assets/new-project.b5c06121.png"},null,-1),Xe=f("span",{class:"project-type ellipsis"},"PC端创建",-1),He={class:"project-header"},Qe={class:"project-title"},We={class:"header-manager"},Ze={class:"search"},ea=f("i",{class:"v-icon-search"},null,-1),aa={class:"sort-type"},ta=f("i",{class:"el-icon-caret-bottom arrow-icon"},null,-1),ra={class:"main-screen"};g();const oa=Ke(((e,a,t,r,o,s)=>{const l=v("router-link"),n=v("g-drop-list-item"),c=v("g-drop-list"),i=v("g-drop-list-popover"),d=v("my-screen"),u=v("publish-screen");return m(),h("div",null,[Ye,f("div",ze,[f(l,{to:{name:"CreateScreen"},target:"_blank",class:"new-project"},{default:Ke((()=>[Fe,Xe])),_:1})]),f("div",He,[f("div",Qe,[f("h2",null,b(e.group?e.group.name:""),1)]),f("div",We,[f("div",Ze,[y(f("input",{"onUpdate:modelValue":a[1]||(a[1]=a=>e.searchText=a),class:"search-input",placeholder:"搜索"},null,512),[[j,e.searchText,void 0,{trim:!0}]])]),ea,f(i,null,{droplist:Ke((()=>[f(c,null,{default:Ke((()=>[(m(!0),h(G,null,I(e.sorts,((a,t)=>(m(),h(n,{key:t,onClick:a=>e.onSortChange(t)},{default:Ke((()=>[w(b(a),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),default:Ke((()=>[f("div",aa,[f("span",{class:"sort-text",title:e.sorts[e.sort]},b(e.sorts[e.sort]),9,["title"]),ta])])),_:1})])]),f("div",ra,[(m(!0),h(G,null,I(e.screens,(e=>(m(),h("div",{key:e.id},[f(d,{screen:e},null,8,["screen"])])))),128))]),f(u,{modelValue:e.visiblePublish,"onUpdate:modelValue":a[2]||(a[2]=a=>e.visiblePublish=a),"project-id":e.publishAppId},null,8,["modelValue","project-id"])])}));qe.render=oa,qe.__scopeId="data-v-7df90232";var sa=n({name:"MyProject",components:{ProjectList:qe},setup(){const{getProjects:e,moveProject:a,createProjectGroup:t,deleteProjectGroup:r,updateProjectGroupName:o}=ne,s=i(-1),l=i(!0),n=i(!1),c=i(!1),u=d((()=>ne.group)),p=d((()=>ne.ungroup)),g=d((()=>ne.groups)),v=d((()=>-1===s.value?u.value:0===s.value?p.value:g.value.find((e=>e.id===s.value)))),m=e=>{s.value=e};k("dragStart",(()=>{c.value=!0})),k("dragEnd",(()=>{c.value=!1}));return O((()=>{e().finally((()=>{l.value=!1}))})),{loading:l,group:u,ungroup:p,groups:g,selectedGroup:v,selectedGroupId:s,adding:n,toggleProject:m,onAddInputBlur:e=>{if(!n.value)return;(e.target.value||"").trim()||(n.value=!1)},addGroup:async e=>{if(!n.value)return;const a=(e.target.value||"").trim();if(a)try{await t(a),n.value=!1}catch(r){q.error(q.format(r))}else n.value=!1},onEditInputBlur:(e,a)=>{if(!a.editing)return;const t=(e.target.value||"").trim();t&&a.name!==t||(a.editing=!1)},editGroup:async(e,a)=>{if(!a.editing)return;const t=(e.target.value||"").trim();if(t&&a.name!==t)try{await o({id:a.id,newName:t}),a.name=t,a.editing=!1}catch(r){q.error(q.format(r))}else a.editing=!1},confirmDeleteGroup:e=>{K.confirmAsync(`<b>${e.name}</b> 删除后无法恢复，该分组中的可视化应用将全部移动到未分组，确认删除？`,(()=>r(e.id)),{success:()=>{m(p.value.id)}})},draging:c,onDragEnter:e=>{Z(e.target,"drag-enter")},onDragLeave:e=>{ee(e.target,"drag-enter")},onDrop:(e,t)=>{e.preventDefault(),ee(e.target,"drag-enter");const r=e.dataTransfer.getData("text");if(r){const[e,o]=r.split(",").map((e=>parseInt(e)));o!==t.id&&a({pid:e,fromId:o,toId:t.id})}}}}});const la=P();p("data-v-88a13b4e");const na={class:"my-project"},ca={class:"project-main"},ia={class:"project-manage"},da={class:"manage-title"},ua={class:"my-project project-group"},pa=f("span",{style:{"margin-left":"2px"}},"我的分组",-1),ga={class:"project-num"},va={key:0,class:"new-group"},ma={class:"project-name project-ungrouped"},ha={class:"project-num"},fa={class:"project-name"},ya={class:"project-num"},ja={class:"group-btns"},ba={class:"project-screen-list"};g();const Pa=la(((e,a,t,r,o,s)=>{const l=v("project-list"),n=v("g-loading"),c=_("focus");return m(),h(n,{spinning:e.loading},{default:la((()=>[f("div",na,[f("div",ca,[f("div",ia,[f("div",da,[f("div",ua,[pa,f("i",{class:"el-icon-plus btn-add-icon",onClick:a[1]||(a[1]=a=>e.adding=!0)})]),f("div",{class:["my-project project-all",{"project-checked-color":e.selectedGroupId===e.group.id}],onClick:a[2]||(a[2]=a=>e.toggleProject(e.group.id))},[f("span",null,b(e.group.name),1),f("span",ga,b(e.group.children.length),1)],2),e.adding?(m(),h("div",va,[y(f("input",{class:"edit-input",onBlur:a[3]||(a[3]=(...a)=>e.onAddInputBlur&&e.onAddInputBlur(...a)),onKeyup:a[4]||(a[4]=R(((...a)=>e.addGroup&&e.addGroup(...a)),["enter"]))},null,544),[[c]])])):S("",!0)]),f("div",{class:["manage-main",{draging:e.draging}]},[f("div",{class:["main-project",{"project-checked-color":e.selectedGroupId===e.ungroup.id}],onClick:a[5]||(a[5]=a=>e.toggleProject(e.ungroup.id)),onDragover:a[6]||(a[6]=U((()=>{}),["prevent"])),onDragenter:a[7]||(a[7]=(...a)=>e.onDragEnter&&e.onDragEnter(...a)),onDragleave:a[8]||(a[8]=(...a)=>e.onDragLeave&&e.onDragLeave(...a)),onDrop:a[9]||(a[9]=a=>e.onDrop(a,e.ungroup))},[f("span",ma,b(e.ungroup.name),1),f("span",ha,b(e.ungroup.children.length),1)],34),(m(!0),h(G,null,I(e.groups,(t=>(m(),h("div",{key:t.id,class:["main-project group-project",{"project-checked-color":e.selectedGroupId===t.id}],onClick:a=>e.toggleProject(t.id),onDragover:a[10]||(a[10]=U((()=>{}),["prevent"])),onDragenter:a[11]||(a[11]=(...a)=>e.onDragEnter&&e.onDragEnter(...a)),onDragleave:a[12]||(a[12]=(...a)=>e.onDragLeave&&e.onDragLeave(...a)),onDrop:a=>e.onDrop(a,t)},[t.editing?y((m(),h("input",{key:0,"default-value":t.name,class:"edit-input",onBlur:a=>e.onEditInputBlur(a,t),onKeyup:R((a=>e.editGroup(a,t)),["enter"])},null,40,["default-value","onBlur","onKeyup"])),[[c]]):(m(),h(G,{key:1},[f("span",fa,b(t.name),1),f("span",ya,b(t.children.length),1),f("span",ja,[f("i",{class:"v-icon-edit",onClick:e=>t.editing=!0},null,8,["onClick"]),f("i",{class:"v-icon-delete",onClick:a=>e.confirmDeleteGroup(t)},null,8,["onClick"])])],64))],42,["onClick","onDrop"])))),128))],2)]),f("div",ba,[f(l,{group:e.selectedGroup},null,8,["group"])])])])])),_:1},8,["spinning"])}));sa.render=Pa,sa.__scopeId="data-v-88a13b4e";export default sa;
