import{d as e,r as a,w as l,aE as t,e as i,aG as s,aD as r,aj as n,af as d,a_ as o,k as c,l as u,m as f,q as p,p as m,F,am as b,s as v,t as g}from"./index.96b29a26.js";import{_ as w}from"./filter-collapse-panel.dbc9b371.js";var h=e({name:"FilterManagerDrawer",components:{FilterCollapsePanel:w},setup(){const e=a(!1),c=a(null);l((()=>t.filter.show),(a=>{e.value=a}));const u=i((()=>s.dataFilters)),f=i((()=>{const e=[...r.coms,...r.subComs],a=Object.create(null);return e.forEach((e=>{for(const l in e.apiData){e.apiData[l].pageFilters.forEach((l=>{a[l.id]?(a[l.id].ids.push(e.id),a[l.id].names.push(e.alias)):a[l.id]={ids:[e.id],names:[e.alias]}}))}})),a})),p=e=>{e>0?d.confirmAsync("是否删除数据过滤器，可能导致相关组件不可用。",(()=>s.deleteFilter(e)),{success:()=>{const a=f.value[e];if(a){[...r.coms,...r.subComs].filter((e=>a.ids.includes(e.id))).forEach((a=>{for(const l in a.apiData){const t=a.apiData[l],i=t.pageFilters.find((a=>a.id===e));t.pageFilters=t.pageFilters.filter((a=>a.id!==e)),i&&i.enabled&&o(a.id,l,a.apis[l],t)}}))}}}):c.value=null};return n("usedFilters",f),n("editFilterName",((e,a)=>{const l=e.trim();l&&a.name!==l&&(a.name=l,a.id>0&&s.updateFilterName(a))})),n("removeFilter",p),n("saveFilter",(async e=>{if(e.id>0){await s.updateFilter(e);const a=f.value[e.id];if(a){[...r.coms,...r.subComs].filter((e=>a.ids.includes(e.id))).forEach((a=>{for(const l in a.apiData){const t=a.apiData[l],i=t.pageFilters.find((a=>a.id===e.id));i&&i.enabled&&o(a.id,l,a.apis[l],t)}}))}}else await s.createFilter(e),c.value=null})),{visible:e,dataFilters:u,newDataFilter:c,close:()=>{t.filter.show=!1},addFilter:()=>{c.value||(c.value={id:0,name:"新建过滤器",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})},removeFilter:p}}});const k={class:"filter-manager-title"},D=g(" 数据过滤器"),C=m("i",{class:"el-icon-document"},null,-1),y=m("span",null,"帮助文档",-1),_={key:1,class:"panel-info"},j=m("p",{class:"info-text"},"过滤器列表为空，请创建后使用",-1),E=g(" 新建 ");h.render=function(e,a,l,t,i,s){const r=c("router-link"),n=c("filter-collapse-panel"),d=c("el-button"),o=c("el-drawer");return u(),f(o,{modelValue:e.visible,"onUpdate:modelValue":a[2]||(a[2]=a=>e.visible=a),"custom-class":"filter-manager-drawer",size:"500px",direction:"ltr",onClose:e.close},{title:p((()=>[m("p",k,[D,m("span",{class:"create-filter",onClick:a[1]||(a[1]=(...a)=>e.addFilter&&e.addFilter(...a))},"新建"),m(r,{to:{name:"MyCase"},target:"_blank",rel:"noopener noreferrer",class:"filter-doc"},{default:p((()=>[C,y])),_:1})])])),default:p((()=>[e.visible?(u(),f(F,{key:0},[e.newDataFilter?(u(),f(n,{key:0,"data-filter":e.newDataFilter,"is-new":"",draggable:!1,"has-feedback":!1,removable:""},null,8,["data-filter"])):b("",!0),(u(!0),f(F,null,v(e.dataFilters,(e=>(u(),f(n,{key:e.id,"data-filter":e,draggable:!1,"has-feedback":!1,publish:"",removable:"","show-time":""},null,8,["data-filter"])))),128)),0!==e.dataFilters.length||e.newDataFilter?b("",!0):(u(),f("div",_,[j,m(d,{onClick:e.addFilter},{default:p((()=>[E])),_:1},8,["onClick"])]))],64)):b("",!0)])),_:1},8,["modelValue","onClose"])};export default h;
