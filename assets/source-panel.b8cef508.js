var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,i=(e,i)=>{for(var o in i||(i={}))t.call(i,o)&&s(e,o,i[o]);if(a)for(var o of a(i))l.call(i,o)&&s(e,o,i[o]);return e};import{d as o,b0 as n,j as d,C as r,D as c,o as u,c as p,F as f,a as v,t as m,G as g,e as b,i as y,aN as h,aK as C,p as w,f as D,A as F,b as S,w as k,aS as x,aB as _,b1 as T,b2 as j,b3 as N,aZ as O,b4 as V,B as I,b5 as P,q as E,a_ as A}from"./index.bdf38cb7.js";import{_ as U}from"./filter-collapse-panel.376047ba.js";var R=o({name:"DisplayApiStatus",props:{status:{type:String,default:n.incomplete},loadingText:{type:String,default:"匹配中"},successText:{type:String,default:"匹配成功"},failedText:{type:String,default:"未找到字段"},completedText:{type:String,default:"配置完成"},incompleteText:{type:String,default:"配置未完成"},optional:{type:Boolean,default:!1}},setup(e){const a=d((()=>e.status===n.loading?e.loadingText:e.status===n.success?e.successText:e.status===n.completed?e.completedText:e.optional?"可选":e.status===n.failed?e.failedText:e.status===n.incomplete?e.incompleteText:e.status));return{apiStatus:n,statusText:a}}});const M=g();r("data-v-44e10de6");const z=v("i",{class:"status-icon validating"},null,-1),B=v("i",{class:"status-icon validating"},null,-1),G=v("i",{class:"status-icon validating"},null,-1),q={key:2,class:"status-icon --success"},L={class:"status-text"};c();const $=M(((e,a,t,l,s,i)=>(u(),p("div",null,[e.status===e.apiStatus.loading?(u(),p(f,{key:0},[z,B,G],64)):e.status===e.apiStatus.success||e.status===e.apiStatus.completed?(u(),p("i",{key:1,class:["status-icon",`--${e.status}`]},null,2)):e.optional?(u(),p("i",q)):(u(),p("i",{key:3,class:["status-icon",`--${e.status}`]},null,2)),v("span",L,m(e.statusText),1)]))));R.render=$,R.__scopeId="data-v-44e10de6";var K=o({name:"FilterConfig",components:{FilterCollapsePanel:U},setup(){const e=b(void 0),a=b(null),t=b(null),l=b({visible:!1,top:"4px",from:0,to:0}),s=y("apiDataConfig"),i=y("refreshData"),o=d((()=>{const e=s.value.pageFilters.map((e=>e.id));return h.dataFilters.filter((a=>!e.includes(a.id)))})),n=d((()=>s.value.pageFilters.reduce(((e,a)=>{const t=h.dataFilters.find((e=>e.id==a.id));return t&&e.push(t),e}),[]))),r=d((()=>{const e=[...C.coms,...C.subComs],a=Object.create(null);return e.forEach((e=>{for(const t in e.apiData){e.apiData[t].pageFilters.forEach((t=>{a[t.id]?(a[t.id].ids.push(e.id),a[t.id].names.push(e.alias)):a[t.id]={ids:[e.id],names:[e.alias]}}))}})),a})),c=d((()=>s.value.pageFilters.reduce(((e,a)=>(e[a.id]=a.enabled,e)),{}))),u=(e,a,t)=>{l.value.visible=e,l.value.top=t.offsetTop-6+"px",e?l.value.to=a:(l.value.from=a,(()=>{const{from:e,to:a}=l.value;if(e!==a){const t=s.value.pageFilters;t.splice(a,0,...t.splice(e,1)),i()}})())};return w("usedFilters",r),w("enabledFilters",c),w("onUsedChange",((e,a)=>{s.value.pageFilters.find((a=>a.id===e)).enabled=a,i()})),w("editFilterName",((e,a)=>{const t=e.trim();t&&a.name!==t&&(a.name=t,a.id>0&&h.updateFilterName(a))})),w("removeFilter",(e=>{e>0?(s.value.pageFilters=s.value.pageFilters.filter((a=>a.id!==e)),i()):a.value=null})),w("saveFilter",(async e=>{if(e.id>0)await h.updateFilter(e),c.value[e.id]&&i();else{const t=await h.createFilter(e);s.value.pageFilters.push({id:t,enabled:!0}),a.value=null,i()}})),w("updateIndicator",u),{filterId:e,apiDataConfig:s,dataFilters:o,selectedFilters:n,newDataFilter:a,addPanelRef:t,dragInfo:l,selectFilter:e=>{s.value.pageFilters.push({id:e,enabled:!0}),i()},addFilter:()=>{a.value||(a.value={id:0,name:"新建过滤器",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})},dragEnter:()=>{u(!0,n.value.length,t.value)}}}});const Z={class:"filter-list"},H=v("i",{class:"v-icon-plus icon-add"},null,-1),J=v("div",{class:"filter-dragging-wp"},null,-1);K.render=function(e,a,t,l,s,i){const o=D("filter-collapse-panel"),n=D("el-option"),d=D("el-select");return u(),p("div",{class:["filter-wp",{"--disabled":!e.apiDataConfig.config.useFilter}]},[v("div",Z,[(u(!0),p(f,null,F(e.selectedFilters,((e,a)=>(u(),p(o,{key:e.id,index:a,"data-filter":e},null,8,["index","data-filter"])))),128)),e.newDataFilter?(u(),p(o,{key:0,"data-filter":e.newDataFilter,index:e.selectedFilters.length,"is-new":!0,draggable:!1,"has-feedback":!1,removable:!0},null,8,["data-filter","index"])):S("",!0),v("div",{ref:"addPanelRef",class:"add-filter",onDragenter:a[2]||(a[2]=(...a)=>e.dragEnter&&e.dragEnter(...a))},[v(d,{"model-value":e.filterId,size:"mini",filterable:"",placeholder:"添加过滤器",class:"datav-new-select filter-select","popper-class":"datav-new-select-option",onChange:e.selectFilter},{default:k((()=>[(u(!0),p(f,null,F(e.dataFilters,(e=>(u(),p(n,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["model-value","onChange"]),v("div",{class:"new-filter-btn",onClick:a[1]||(a[1]=(...a)=>e.addFilter&&e.addFilter(...a))},[H])],544)]),J,v("div",{class:"drag-indicator",style:{display:e.dragInfo.visible?"block":"none",top:e.dragInfo.top}},null,4)],2)};var Q=o({name:"FieldGrid",props:{fields:{type:Object}}});const W=g();r("data-v-3cb2a0e7");const X={key:0,class:"field-wp"},Y=v("div",{class:"field-info"},"数据相应结果应为列表，列表元素包含如下字段",-1),ee={class:"field-grid"},ae=v("div",{class:"field-item field-title"},"字段",-1),te=v("div",{class:"field-item field-title"},"映射",-1),le=v("div",{class:"field-item field-title"},"说明",-1),se={class:"field-item"},ie={class:"field-item"},oe={class:"field-item"};c();const ne=W(((e,a,t,l,s,i)=>e.fields?(u(),p("div",X,[Y,v("div",ee,[ae,te,le,(u(!0),p(f,null,F(e.fields,((e,a)=>(u(),p(f,{key:a},[v("div",se,m(a),1),v("div",ie,m(e.map||"-"),1),v("div",oe,m(e.description||"-"),1)],64)))),128))])])):S("",!0)));Q.render=ne,Q.__scopeId="data-v-3cb2a0e7";var de=o({name:"SourceDrawer",components:{FilterConfig:K,FieldGrid:Q,DsStaticEditor:x((()=>_((()=>import("./ds-static-editor.d3c24999.js")),["/assets/ds-static-editor.d3c24999.js","/assets/index.bdf38cb7.js","/assets/index.10cf27bd.css"]))),DsApiEditor:x((()=>_((()=>import("./ds-api-editor.0a54bd39.js")),["/assets/ds-api-editor.0a54bd39.js","/assets/ds-api-editor.e4cdc83e.css","/assets/index.bdf38cb7.js","/assets/index.10cf27bd.css"])))},setup(){const e=b(!1),a=b(!1),t=j,l=T(),s=y("com"),o=y("apiConfig"),n=y("apiDataConfig"),r=y("apiName"),c=d((()=>{const e=V.dataStatusMap[s.value.id];return e?e[r]:{}})),u=d((()=>{const e=V.originMap[s.value.id];return e?e[r]:""})),p=d((()=>{const e=V.dataMap[s.value.id];return e?e[r]:""})),f=async()=>{await O(s.value.id,r,o.value,n.value)};return w("refreshData",f),w("dataStatus",c),{visible:e,visiblePreview:a,apiType:t,datasources:l,com:s,apiConfig:o,apiDataConfig:n,dataStatus:c,dataOrign:u,resData:p,open:()=>{e.value=!0},changeSource:e=>{switch(e){case j.api:void 0===n.value.config.api&&(n.value.config=i(i({},n.value.config),N()))}},refreshData:f}}});const re=v("p",{class:"source-drawer-title"},"设置数据源",-1),ce={class:"datasource-selector"},ue=v("label",{class:"datasource-selector-title"},"数据源类型",-1),pe={class:"datasource-select"},fe={class:"datav-new-select-wp"},ve={class:"ds-preview-content"},me=v("div",{class:"ds-response-btn"},[v("i",{class:"v-icon-search"}),I(" 预览数据源返回结果 ")],-1),ge=v("span",{class:"use-filter-text"},"数据过滤器",-1),be=v("span",{class:"tutorial-popup"},"教程",-1),ye=v("span",null,"数据响应结果",-1),he={class:"data-response"};de.render=function(e,a,t,l,s,i){const o=D("el-option"),n=D("el-select"),d=D("ds-static-editor"),r=D("ds-api-editor"),c=D("g-monaco-editor"),m=D("el-popover"),g=D("el-checkbox"),b=D("filter-config"),y=D("field-grid"),h=D("el-drawer");return u(),p(h,{modelValue:e.visible,"onUpdate:modelValue":a[5]||(a[5]=a=>e.visible=a),"custom-class":"source-drawer",size:"500px"},{title:k((()=>[re])),default:k((()=>[e.visible?(u(),p(f,{key:0},[v("div",{class:["step-title",{"--error":!!e.dataStatus.errSource}]}," 数据源 ",2),v("div",ce,[ue,v("div",pe,[v("div",fe,[v(n,{modelValue:e.apiDataConfig.type,"onUpdate:modelValue":a[1]||(a[1]=a=>e.apiDataConfig.type=a),size:"mini",filterable:"",class:"datav-new-select","popper-class":"datav-new-select-option",onChange:e.changeSource},{default:k((()=>[(u(!0),p(f,null,F(e.datasources,((e,a)=>(u(),p(o,{key:a,label:e,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])])]),e.apiDataConfig.type===e.apiType.static?(u(),p(d,{key:0})):e.apiDataConfig.type===e.apiType.api?(u(),p(r,{key:1})):S("",!0),v(m,{visible:e.visiblePreview,"onUpdate:visible":a[2]||(a[2]=a=>e.visiblePreview=a),placement:"left",width:400,"popper-class":"editor-popover"},{reference:k((()=>[me])),default:k((()=>[v("div",ve,[v(c,{language:"json","read-only":!0,"auto-format":!0,height:180,code:e.dataOrign},null,8,["code"])])])),_:1},8,["visible"]),v("div",{class:["step-title",{"--error":!!e.dataStatus.errFilter}]},[v(g,{modelValue:e.apiDataConfig.config.useFilter,"onUpdate:modelValue":a[3]||(a[3]=a=>e.apiDataConfig.config.useFilter=a),class:"use-filter-btn"},null,8,["modelValue"]),ge,be],2),v(b),v(y,{fields:e.apiConfig.fields},null,8,["fields"]),v("div",{class:["step-title",{"--error":!!e.dataStatus.errSource||!!e.dataStatus.errFilter}]},[ye,v("i",{class:"v-icon-refresh refresh-btn",onClick:a[4]||(a[4]=(...a)=>e.refreshData&&e.refreshData(...a))})],2),v("div",he,[v(c,{language:"json","read-only":!0,"auto-format":!0,code:e.resData},null,8,["code"])])],64)):S("",!0)])),_:1},8,["modelValue"])};var Ce=o({name:"SourcePanel",components:{DisplayApiStatus:R,SourceDrawer:de},props:{apiName:{type:String,required:!0},activeName:String,collapse:Boolean},setup(e){const a=d((()=>e.apiName===e.activeName)),t=b(null),l=T(),s=y("com"),i=d((()=>s.value.apis[e.apiName])),o=d((()=>s.value.apiData[e.apiName]));w("apiConfig",i),w("apiDataConfig",o),w("apiName",e.apiName);const r=d((()=>{const a=V.dataMap[s.value.id];return a?a[e.apiName]:""})),c=d((()=>{const a=V.fieldStatusMap[s.value.id];return a?a[e.apiName]:{}})),u=d((()=>{const e=Object.values(c.value);return e.includes(P.loading)?n.loading:e.includes(P.failed)?n.incomplete:n.completed})),p=y("changePanel");return{visible:a,sourceDrawerRef:t,datasources:l,com:s,apiConfig:i,apiDataConfig:o,fieldsStatus:c,totalStatus:u,datav_data:r,toggle:()=>{e.collapse&&p(e.apiName)},openSourceDrawer:()=>{var e;null==(e=t.value)||e.open()},refreshData:()=>{O(s.value.id,e.apiName,i.value,o.value)}}}});const we=g();r("data-v-3486482e");const De={class:"api-editor-title"},Fe={key:0,class:"v-icon-arrow-right api-fold-icon"},Se={class:"api-status success"},ke={class:"attr-source-wp"},xe={class:"data-attr-table-container"},_e={class:"data-attr-table"},Te=v("thead",{class:"table-head"},[v("tr",{class:"table-head-row"},[v("th",{class:"th-item column-item attr-name"}," 字段 "),v("th",{class:"th-item column-item attr-value"}," 映射 "),v("th",{class:"th-item column-item attr-status"}," 状态 ")])],-1),je={class:"table-body"},Ne={class:"column-item attr-name"},Oe={class:"ellipsis2"},Ve={class:"column-item attr-value"},Ie={class:"column-item attr-status"},Pe={key:1,class:"table-body-row"},Ee=v("td",{class:"column-item attr-name"},[v("span",null,"任意")],-1),Ae=v("td",{class:"column-item attr-value"},null,-1),Ue={class:"column-item attr-status"},Re={class:"data-source"},Me=v("div",{class:"data-result-title"}," 数据响应结果 ",-1),ze={class:"auto-update-config"},Be=I(" 自动更新选项 "),Ge=I(" 秒一次 "),qe={class:"data-flow-wp"},Le={class:"ds-line"},$e={class:"ds-title"},Ke={class:"ds-type-text"},Ze=I(" 配置数据源 "),He={class:"ds-line mt5"},Je=v("span",null,"数据响应结果 ( 只读 ) ",-1),Qe={class:"ds-dots"},We=v("span",{class:"ds-dot"},null,-1),Xe=v("span",{class:"ds-dot"},null,-1),Ye={class:"data-response"};c();const ea=we(((e,a,t,l,s,i)=>{const o=D("display-api-status"),n=D("el-tooltip"),d=D("g-input"),r=D("el-checkbox"),c=D("el-button"),g=D("g-monaco-editor"),b=D("source-drawer");return u(),p("div",{class:["api-editor",{"--disable-fold":!e.collapse,"--fold":e.collapse&&e.visible}]},[v("div",De,[v("div",{class:"api-desc ellipsis2",onClick:a[1]||(a[1]=(...a)=>e.toggle&&e.toggle(...a))},[e.collapse?(u(),p("i",Fe)):S("",!0),I(" "+m(e.apiConfig.description||"数据接口"),1)]),v("div",Se,[v(o,{status:e.totalStatus,"success-text":"配置完成"},null,8,["status"])])]),E(v("div",ke,[v("div",xe,[v("table",_e,[Te,v("tbody",je,[Object.keys(e.apiConfig.fields).length>0?(u(!0),p(f,{key:0},F(e.apiConfig.fields,((a,t)=>(u(),p("tr",{key:t,class:"table-body-row"},[v("td",Ne,[v(n,{content:a.description,placement:"left",effect:"blue"},{default:we((()=>[v("span",Oe,m(t),1)])),_:2},1032,["content"])]),v("td",Ve,[v(d,{"model-value":a.map,placeholder:"可自定义",class:"attr-input",onChange:e=>a.map=e},null,8,["model-value","onChange"])]),v("td",Ie,[v(o,{status:e.fieldsStatus[t],optional:a.optional},null,8,["status","optional"])])])))),128)):(u(),p("tr",Pe,[Ee,Ae,v("td",Ue,[v(o,{status:"completed"})])]))])])]),v("div",Re,[Me,v("div",ze,[v(r,{modelValue:e.apiConfig.useAutoUpdate,"onUpdate:modelValue":a[2]||(a[2]=a=>e.apiConfig.useAutoUpdate=a),class:"auto-update-checkbox"},{default:we((()=>[Be])),_:1},8,["modelValue"]),v(d,{"model-value":e.apiConfig.autoUpdate,type:"number",disabled:!e.apiConfig.useAutoUpdate,class:"update-interval-input",onChange:a[3]||(a[3]=a=>e.apiConfig.autoUpdate=a)},null,8,["model-value","disabled"]),Ge]),v("div",qe,[v("div",Le,[v("div",$e,[v("span",Ke,m(e.datasources[e.apiDataConfig.type]),1)]),v(c,{size:"mini",class:"ds-action-btn",onClick:e.openSourceDrawer},{default:we((()=>[Ze])),_:1},8,["onClick"])]),v("div",He,[Je,v(n,{content:"刷新数据",placement:"left",effect:"blue"},{default:we((()=>[v("i",{class:"v-icon-refresh refresh-btn",onClick:a[4]||(a[4]=(...a)=>e.refreshData&&e.refreshData(...a))})])),_:1})]),v("div",Qe,[v("span",{class:["ds-dot",["completed"===e.totalStatus?"active":"error"]]},null,2),We,Xe])]),v("div",Ye,[v(g,{language:"json","read-only":!0,"auto-format":!0,code:e.datav_data,height:250,"full-screen-title":"数据响应结果"},null,8,["code"])])])],512),[[A,e.visible]]),v(b,{ref:"sourceDrawerRef"},null,512)],2)}));Ce.render=ea,Ce.__scopeId="data-v-3486482e";export default Ce;
