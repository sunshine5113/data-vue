import{a as V,C as j,E as K,w as P,$ as A}from"./AppRoot.9161bc33.js";import{I as z}from"./warning.ce42dfb2.js";import{I as L}from"./document.9d531123.js";import{F as O,f as U}from"./filter-collapse-item.f6ea839b.js";import{a4 as W,a_ as X,bc as q,a9 as I,aB as N,aC as M,bg as x,a5 as u,a7 as D,a$ as p,b6 as G,a6 as F,aX as _,ad as b,ah as S,aa as $,af as H,ae as J,b0 as T}from"./vendor.1c7e0fbb.js";import"./arrow-left.01caf5a2.js";import"./edit.7daf2506.js";import"./delete.97a5a659.js";import"./release.fe894ced.js";import"./config.3c16c364.js";const Q=W({name:"FilterManagerDrawer",components:{IconDocument:L,FilterCollapseItem:O},setup(){const a=X(),c=q(),h=j(),d=K(),r=P(),E=I(!1),i=I(null);N(()=>h.filter.show,e=>{E.value=e}),N(E,e=>{e||(h.filter.show=!1)});const v=M(()=>d.dataFilters),m=M(()=>{const e=Object.create(null);return[...r.coms,...r.subComs].forEach(t=>{for(const o in t.apiData)t.apiData[o].pageFilters.forEach(s=>{e[s.id]?(e[s.id].ids.push(t.id),e[s.id].names.push(t.alias)):e[s.id]={ids:[t.id],names:[t.alias]}})}),e}),g=()=>{i.value||(i.value={id:0,name:"\u65B0\u5EFA\u8FC7\u6EE4\u5668",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})};return x(U,{usedFilters:m,editFilterName:(e,n)=>{const t=e.trim();t&&n.name!==t&&(n.name=t,n.id>0&&d.updateFilterName(n))},removeFilter:e=>{if(e>0){const n=c.create({content:"\u662F\u5426\u5220\u9664\u6570\u636E\u8FC7\u6EE4\u5668\uFF0C\u53EF\u80FD\u5BFC\u81F4\u76F8\u5173\u7EC4\u4EF6\u4E0D\u53EF\u7528\u3002",negativeText:"\u53D6\u6D88",positiveText:"\u786E\u5B9A",iconPlacement:"top",icon:()=>G(z),onPositiveClick:async()=>{n.loading=!0;try{await d.deleteFilter(e);const t=m.value[e];t&&[...r.coms,...r.subComs].filter(o=>t.ids.includes(o.id)).forEach(o=>{for(const f in o.apiData){const s=f,l=o.apiData[s],w=l.pageFilters.find(C=>C.id===e);l.pageFilters=l.pageFilters.filter(C=>C.id!==e),w&&w.enabled&&A(o.id,s,o.apis[s],l)}})}catch(t){a.error(t.message)}}})}else i.value=null},saveFilter:async e=>{if(e.id>0){await d.updateFilter(e);const n=m.value[e.id];n&&[...r.coms,...r.subComs].filter(t=>n.ids.includes(t.id)).forEach(t=>{for(const o in t.apiData){const f=o,s=t.apiData[f],l=s.pageFilters.find(w=>w.id===e.id);l&&l.enabled&&A(t.id,f,t.apis[f],s)}})}else await d.createFilter(e),i.value=null}}),{visible:E,dataFilters:v,newDataFilter:i,addFilter:g}}}),R={class:"filter-manager-title"},Y=T(" \u6570\u636E\u8FC7\u6EE4\u5668"),Z=b("span",null,"\u5E2E\u52A9\u6587\u6863",-1),ee={key:1,class:"panel-info"},te=b("p",{class:"info-text"},"\u8FC7\u6EE4\u5668\u5217\u8868\u4E3A\u7A7A\uFF0C\u8BF7\u521B\u5EFA\u540E\u4F7F\u7528",-1),ae=T(" \u65B0\u5EFA ");function se(a,c,h,d,r,E){const i=u("IconDocument"),v=u("n-icon"),m=u("router-link"),g=u("filter-collapse-item"),k=u("n-button"),y=u("n-drawer-content"),B=u("n-drawer");return F(),D(B,{show:a.visible,"onUpdate:show":c[1]||(c[1]=e=>a.visible=e),width:"500px",placement:"left","trap-focus":!1,class:"filter-manager-drawer",to:"#edit-main-wp"},{default:p(()=>[_(y,{closable:""},{header:p(()=>[b("p",R,[Y,b("span",{class:"create-filter",onClick:c[0]||(c[0]=(...e)=>a.addFilter&&a.addFilter(...e))},"\u65B0\u5EFA"),_(m,{to:{name:"MyCase"},target:"_blank",rel:"noopener noreferrer",class:"filter-doc"},{default:p(()=>[_(v,{size:12},{default:p(()=>[_(i)]),_:1}),Z]),_:1})])]),default:p(()=>[a.newDataFilter?(F(),D(g,{key:0,"data-filter":a.newDataFilter,"is-new":!0,draggable:!1,"has-feedback":!1,removable:!0},null,8,["data-filter"])):S("",!0),(F(!0),$(J,null,H(a.dataFilters,e=>(F(),D(g,{key:e.id,"data-filter":e,draggable:!1,"has-feedback":!1,publish:!0,removable:!0,"show-time":!0},null,8,["data-filter"]))),128)),a.dataFilters.length===0&&!a.newDataFilter?(F(),$("div",ee,[te,_(k,{focusable:!1,onClick:a.addFilter},{default:p(()=>[ae]),_:1},8,["onClick"])])):S("",!0)]),_:1})]),_:1},8,["show"])}var me=V(Q,[["render",se]]);export{me as default};
