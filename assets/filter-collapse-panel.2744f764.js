import{b as T}from"./App.7d9600e2.js";import{I as J}from"./arrow-left.723de3f7.js";import{I as K}from"./edit.3ff5df3e.js";import{I as Q}from"./delete.dfde7a3e.js";import{I as X}from"./release.9cf26f04.js";import{a4 as n,a8 as d,ab as t,a2 as x,a$ as ee,a7 as u,be as p,aF as Z,a3 as l,ac as z,aY as o,b0 as s,af as k,a5 as m,ae as h,b1 as C,aa as R,a9 as U}from"./vendor.577170a9.js";const te={},ae={t:"1632575311693",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3931",width:"64",height:"64"},ne=t("path",{d:"M362.666667 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3932"},null,-1),oe=t("path",{d:"M661.333333 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3933"},null,-1),se=t("path",{d:"M362.666667 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3934"},null,-1),le=t("path",{d:"M661.333333 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3935"},null,-1),ie=t("path",{d:"M362.666667 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3936"},null,-1),de=t("path",{d:"M661.333333 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"3937"},null,-1),re=[ne,oe,se,le,ie,de];function ce(e,i){return n(),d("svg",ae,re)}var ue=T(te,[["render",ce]]);const pe={},fe={t:"1632575562808",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4082",width:"64",height:"64"},ge=t("path",{d:"M854.39 493.07","p-id":"4083"},null,-1),me=t("path",{d:"M571.37 510.59L919.61 163.88c16.47-16.41 16.56-42.96 0.18-59.46-16.41-16.53-42.93-16.56-59.4-0.18L512.03 451.01 166.73 104.39C150.41 87.98 123.8 87.92 107.36 104.3 90.92 120.71 90.89 147.32 107.27 163.79l345.21 346.53L104.39 856.82c-16.47 16.41-16.56 42.96-0.18 59.46 8.19 8.25 18.99 12.39 29.79 12.39 10.71 0 21.42-4.08 29.61-12.24l348.15-346.59 348.45 349.77C868.43 927.89 879.2 932 889.97 932c10.74 0 21.48-4.11 29.67-12.27 16.41-16.41 16.47-42.96 0.09-59.43L571.37 510.59 571.37 510.59zM571.37 510.59","p-id":"4084"},null,-1),he=[ge,me];function ve(e,i){return n(),d("svg",fe,he)}var _e=T(pe,[["render",ve]]);const Fe=x({name:"FilterCollapsePanel",components:{IconArrowLeft:J,IconEdit:K,IconRelease:X,IconDelete:Q,IconDrag:ue,IconClose:_e},props:{dataFilter:{type:Object,required:!0},draggable:{type:Boolean,default:!0},hasFeedback:{type:Boolean,default:!0},removable:Boolean,publish:Boolean,isNew:Boolean,index:Number,showTime:Boolean},setup(e){const i=ee(),y=u(null),I=u(e.isNew),v=u(e.isNew),$=u(e.isNew),c=u(e.isNew),r=u(!1),f=u(e.dataFilter.origin),F=p("dataStatus",null),N=Z(()=>{let a="";const b=F==null?void 0:F.value.filter;return b&&b[e.dataFilter.id]&&(a=b[e.dataFilter.id]),a}),w=p("usedFilters"),_=p("enabledFilters",null),M=p("onUsedChange",null),j=p("editFilterName"),E=p("removeFilter"),A=p("saveFilter"),D=p("updateIndicator",null),B=Z(()=>{var a;return(a=_==null?void 0:_.value[e.dataFilter.id])!=null?a:!1}),L=a=>{M(e.dataFilter.id,a)},g=a=>{I.value=!1,j(a,e.dataFilter)},V=a=>{a.value!=e.dataFilter.origin&&(c.value=!0)},q=a=>{f.value=a.value},O=()=>{e.isNew?E(0):(f.value=e.dataFilter.origin,c.value?c.value=!1:v.value=!1)},H=async()=>{if(!c.value){v.value=!1;return}try{r.value=!0,e.dataFilter.origin=f.value,e.dataFilter.code=`
          if (!data) {  return data; }
          return filter(...arguments);
          function filter(data) {
            ${f.value}
            return data;
          }
        `,await A(e.dataFilter),c.value=!1,i.success("\u6570\u636E\u8FC7\u6EE4\u5668\u5DF2\u4FDD\u5B58")}catch(a){i.error(a.message)}finally{r.value=!1}},P=()=>{$.value=!0,v.value=!v.value},W=a=>{const b=a.target.parentNode.parentNode.parentNode.parentElement,S=document.querySelector(".filter-dragging-wp");S.innerHTML="",S.appendChild(b.cloneNode(!0)),a.dataTransfer.setDragImage(S,30,15)},Y=()=>{const a=document.querySelector(".filter-dragging-wp");a.innerHTML="",D(!1,e.index,y.value)},G=()=>{D(!0,e.index,y.value)};return{panelRef:y,code:f,loading:r,editing:I,collapse:v,isOpened:$,isEdited:c,isEnabled:B,usedFilters:w,errMsg:N,loading2:u(!1),switchEnabled:L,editName:g,removeFilter:E,changeCode:V,updateCode:q,cancelEdit:O,saveData:H,toggleEditor:P,dragStart:W,dragEnd:Y,dragEnter:G}}}),we={class:"panel-header"},be={class:"panel-title"},ke={class:"filter-title"},Ce={class:"filter-name"},ye=["title"],Ee={class:"action-wp --edit"},De={class:"filter-count"},Be=t("div",{class:"filter-dot"},null,-1),Ie={key:1,class:"filter-dot"},$e={key:2,class:"filter-dot --none"},Ne={class:"panel-content-wp"},Me={class:"cp-wrap"},je=t("p",{title:"function filter(data) {",class:"fake-code --start"},[t("span",{class:"--keyword"},"function"),C(" filter(data) { ")],-1),Ae=t("p",{class:"fake-code --end"},"}",-1),Le={class:"filter-actions"},Se={key:0,class:"unsaved"},Te={key:1,class:"saved"};function Ze(e,i,y,I,v,$){const c=l("IconDrag"),r=l("n-icon"),f=l("n-checkbox"),F=l("new-input"),N=l("IconEdit"),w=l("g-tooltip-popover"),_=l("n-tooltip"),M=l("IconRelease"),j=l("IconDelete"),E=l("IconClose"),A=l("IconArrowLeft"),D=l("g-monaco-editor"),B=l("n-button"),L=l("n-collapse-transition");return n(),d("div",{ref:"panelRef",class:U(["collapse-panel-wp filter-item ds-panel-filter",{"--create":e.isNew,"--spread":e.collapse||e.isNew,"--draggable":e.draggable,"--unused":e.hasFeedback&&!e.isEnabled,"--error":!!e.errMsg}]),onDragenter:i[3]||(i[3]=(...g)=>e.dragEnter&&e.dragEnter(...g))},[t("div",we,[t("div",be,[t("div",ke,[e.draggable?(n(),d(z,{key:0},[o(r,{draggable:"true",class:"drag-btn",onDragstart:e.dragStart,onDragend:e.dragEnd},{default:s(()=>[o(c)]),_:1},8,["onDragstart","onDragend"]),o(f,{checked:e.isEnabled,class:"enable-checkbox","onUpdate:checked":e.switchEnabled},null,8,["checked","onUpdate:checked"])],64)):k("",!0),t("div",Ce,[e.editing?(n(),m(F,{key:0,"model-value":e.dataFilter.name,autofocus:!0,class:"filter-name-input",onChange:e.editName},null,8,["model-value","onChange"])):(n(),d("div",{key:1,class:"filter-name-text",title:e.dataFilter.name},h(e.dataFilter.name),9,ye))]),t("div",Ee,[o(w,{content:"\u91CD\u547D\u540D"},{default:s(()=>[o(r,{class:"edit-btn",onClick:i[0]||(i[0]=g=>e.editing=!0)},{default:s(()=>[o(N)]),_:1})]),_:1})]),t("div",De,[!e.isNew&&e.usedFilters[e.dataFilter.id]?(n(),m(_,{key:0,placement:"top",delay:500,style:R({"--padding":"6px","--border-radius":"2px","--text-color":"#000102","--arrow-height":"8px","--color":"var(--datav-font-color)",maxWidth:"240px"})},{trigger:s(()=>[t("span",null,h(e.usedFilters[e.dataFilter.id].names.length)+" \u4E2A\u7EC4\u4EF6\u6B63\u5728\u8C03\u7528",1)]),default:s(()=>[C(" "+h(e.usedFilters[e.dataFilter.id].names.join(", ")),1)]),_:1},8,["style"])):k("",!0)]),t("div",{class:U(["action-wp",{"--flex":e.publish}])},[e.publish?(n(),m(w,{key:0,content:"\u521B\u5EFA\u4EE3\u7801\u7247\u6BB5"},{default:s(()=>[o(r,{class:"save-btn"},{default:s(()=>[o(M)]),_:1})]),_:1})):k("",!0),o(w,{content:"\u5220\u9664"},{default:s(()=>[o(r,{class:"del-btn",onClick:i[1]||(i[1]=g=>e.removeFilter(e.dataFilter.id))},{default:s(()=>[e.removable?(n(),m(j,{key:0})):(n(),m(E,{key:1}))]),_:1})]),_:1})],2),e.hasFeedback?(n(),d(z,{key:1},[e.errMsg?(n(),m(_,{key:0,placement:"left",style:R({"--color":"var(--datav-error-color)",maxWidth:"300px"})},{trigger:s(()=>[Be]),default:s(()=>[C(" "+h(e.errMsg),1)]),_:1},8,["style"])):(n(),d("div",Ie))],64)):(n(),d("div",$e))])]),t("div",{class:"toggle-btn",onClick:i[2]||(i[2]=(...g)=>e.toggleEditor&&e.toggleEditor(...g))},[o(r,{class:"toggle-icon"},{default:s(()=>[o(A)]),_:1})])]),e.isOpened?(n(),m(L,{key:0,collapsed:e.collapse},{default:s(()=>[t("div",Ne,[t("div",Me,[je,o(D,{language:"javascript",code:e.code,height:180,"editor-class":"filter-editor",onChange:e.changeCode,onBlur:e.updateCode},null,8,["code","onChange","onBlur"]),Ae,t("div",Le,[e.isEdited?(n(),d("div",Se,"\u672A\u4FDD\u5B58")):e.showTime?(n(),d("div",Te,"\u4E0A\u6B21\u4FDD\u5B58: "+h(e.dataFilter.updateAt),1)):k("",!0),o(B,{size:"tiny",focusable:!1,class:"bolder-btn",onClick:e.cancelEdit},{default:s(()=>[C(h(e.dataFilter.id===0?"\u53D6\u6D88":e.isEdited?"\u64A4\u9500":"\u53D6\u6D88"),1)]),_:1},8,["onClick"]),o(B,{type:"primary",size:"tiny",loading:e.loading,focusable:!1,class:"bolder-btn",onClick:e.saveData},{default:s(()=>[C(h(e.dataFilter.id===0||e.isEdited?"\u4FDD\u5B58":"\u5B8C\u6210"),1)]),_:1},8,["loading","onClick"])])])])]),_:1},8,["collapsed"])):k("",!0)],34)}var He=T(Fe,[["render",Ze]]);export{He as F};
