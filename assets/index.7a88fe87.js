import{V as e,W as t,X as a,Y as r,Z as n,_ as o,$ as s,a0 as l,a1 as c,a2 as i,a3 as u,a4 as d,a5 as p,a6 as g,a7 as v,a8 as m,a9 as h,aa as f,ab as y,ac as E,B as P,ad as j,ae as b,af as w,ag as _,ah as C,ai as D,aj as G,ak as T,al as O,am as I,an as k,d as R,ao as S,e as A,h as x,ap as J,i as N,M as L,aq as B,C as M,D as U,f as V,o as $,c as K,a as Y,n as q,ar as z,t as F,E as W,A as X,as as Z,p as H,F as Q,g as ee,K as te,l as ae,at as re,b as ne,q as oe}from"./index.354198e7.js";import{P as se,a as le}from"./project.ec6ffcb1.js";import{a as ce,r as ie}from"./dom.4b2dba2d.js";import{_ as ue}from"./publish-screen.2aaacee5.js";function de(e,t,a){switch(a.length){case 0:return e.call(t);case 1:return e.call(t,a[0]);case 2:return e.call(t,a[0],a[1]);case 3:return e.call(t,a[0],a[1],a[2])}return e.apply(t,a)}var pe=Date.now;var ge,ve,me,he=(ge=e?function(t,a){return e(t,"toString",{configurable:!0,enumerable:!1,value:(r=a,function(){return r}),writable:!0});var r}:t,ve=0,me=0,function(){var e=pe(),t=16-(e-me);if(me=e,t>0){if(++ve>=800)return arguments[0]}else ve=0;return ge.apply(void 0,arguments)}),fe=Math.max;function ye(e,t,s){if(!a(s))return!1;var l=typeof t;return!!("number"==l?r(s)&&n(t,s.length):"string"==l&&t in s)&&o(s[t],e)}var Ee=s?s.isConcatSpreadable:void 0;function Pe(e){return l(e)||c(e)||!!(Ee&&e&&e[Ee])}function je(e,t,a,r,n){var o=-1,s=e.length;for(a||(a=Pe),n||(n=[]);++o<s;){var l=e[o];t>0&&a(l)?t>1?je(l,t-1,a,r,n):i(n,l):r||(n[n.length]=l)}return n}function be(e,t){if(e!==t){var a=void 0!==e,r=null===e,n=e==e,o=d(e),s=void 0!==t,l=null===t,c=t==t,i=d(t);if(!l&&!i&&!o&&e>t||o&&s&&c&&!l&&!i||r&&s&&c||!a&&c||!n)return 1;if(!r&&!o&&!i&&e<t||i&&a&&n&&!r&&!o||l&&a&&n||!s&&n||!c)return-1}return 0}function we(e,a,n){a=a.length?p(a,(function(e){return l(e)?function(t){return g(t,1===e.length?e[0]:e)}:e})):[t];var o=-1;return a=p(a,v(m)),function(e,t){var a=e.length;for(e.sort(t);a--;)e[a]=e[a].value;return e}(function(e,t){var a=-1,n=r(e)?Array(e.length):[];return u(e,(function(e,r,o){n[++a]=t(e,r,o)})),n}(e,(function(e,t,r){return{criteria:p(a,(function(t){return t(e)})),index:++o,value:e}})),(function(e,t){return function(e,t,a){for(var r=-1,n=e.criteria,o=t.criteria,s=n.length,l=a.length;++r<s;){var c=be(n[r],o[r]);if(c)return r>=l?c:c*("desc"==a[r]?-1:1)}return e.index-t.index}(e,t,n)}))}var _e=function(e,a){return he(function(e,t,a){return t=fe(void 0===t?e.length-1:t,0),function(){for(var r=arguments,n=-1,o=fe(r.length-t,0),s=Array(o);++n<o;)s[n]=r[t+n];n=-1;for(var l=Array(t+1);++n<t;)l[n]=r[n];return l[t]=a(s),de(e,this,l)}}(e,a,t),e+"")}((function(e,t){if(null==e)return[];var a=t.length;return a>1&&ye(e,t[0],t[1])?t=[]:a>2&&ye(t[0],t[1],t[2])&&(t=[t[0]]),we(e,je(t,1),[])})),Ce=Object.defineProperty,De=Object.getOwnPropertyDescriptor,Ge=(e,t,a,r)=>{for(var n,o=r>1?void 0:r?De(t,a):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,a,o):n(o))||o);return r&&o&&Ce(t,a,o),o};k.rawError=!0;let Te=class extends E{constructor(){super(...arguments),this.allGroups=[]}get group(){const e=this.allGroups.flatMap((e=>e.children));return new se(-1,"全部应用",e)}get ungroup(){const e=this.allGroups.find((e=>e.type===le.ungroup));return e||new se(0,"未分组",[])}get groups(){return this.allGroups.filter((e=>e.type===le.group))}SET_PROJECTS(e){this.allGroups=e}DELETE_PROJECT(e){const t=this.allGroups.find((t=>t.id===e.gid));t&&(t.children=t.children.filter((t=>t.id!==e.pid)))}UPDATE_PROJECT_NAME(e){const t=this.allGroups.find((t=>t.id===e.id));t&&(t.name=e.newName)}MOVE_PROJECT(e){const{pid:t,fromId:a,toId:r}=e,n=this.allGroups.find((e=>e.id===a)),o=this.allGroups.find((e=>e.id===r));if(n&&o){const e=n.children.findIndex((e=>e.id===t)),a=n.children.splice(e,1)[0];a.groupId=r,o.children.push(a)}}COPY_PROJECT(e){const t=this.allGroups.find((t=>t.id===e.gid));if(t){const a=t.children.find((t=>t.id===e.pid)),r=P(a);r.id=Math.round(1e3*Math.random()),r.name+="_copy",t.children.push(r)}}CREATE_PROJECT_GROUP(e){const t=new se(e.id,e.name,[]);t.type=le.group,this.allGroups.unshift(t)}DELETE_PROJECT_GROUP(e){const t=this.allGroups.findIndex((t=>t.id===e)),a=this.allGroups.find((e=>e.type===le.ungroup));if(t>-1&&a){const[e]=this.allGroups.splice(t,1);e.children.forEach((e=>{e.groupId=a.id,a.children.push(e)}))}}async getProjects(){try{const e=await j();if(0!==e.data.code)throw Error(e.data.message);{const t=e.data.data||[],a=new se(0,"未分组",[]);t.forEach((e=>{e.children.forEach((t=>{e.type===le.ungroup?(t.groupId=0,a.children.push(t)):t.groupId=e.id}))})),this.SET_PROJECTS([a,...t.filter((e=>e.type===le.group))])}}catch(e){throw e}}async deleteProject(e){try{const t=await b(e.pid);if(0!==t.data.code)throw Error(t.data.message);this.DELETE_PROJECT(e)}catch(t){throw t}}async updateProjectName(e){try{const t=await w(e.id,e.newName);if(0!==t.data.code)throw Error(t.data.message)}catch(t){throw t}}async moveProject(e){try{const{pid:t,fromId:a,toId:r}=e,n=await _(t,a,r);if(0!==n.data.code)throw Error(n.data.message);this.MOVE_PROJECT(e)}catch(t){throw t}}async copyProject(e){try{const t=await C(e.pid);if(0!==t.data.code)throw Error(t.data.message);this.COPY_PROJECT(e)}catch(t){throw t}}async createProjectGroup(e){try{const{data:t}=await D({name:e});if(0!==t.code)throw Error(t.message);this.CREATE_PROJECT_GROUP({id:t.data,name:e})}catch(t){throw t}}async deleteProjectGroup(e){try{const t=await G(e);if(0!==t.data.code)throw Error(t.data.message);this.DELETE_PROJECT_GROUP(e)}catch(t){throw t}}async updateProjectGroupName(e){try{const t=await T(e.id,e.newName);if(0!==t.data.code)throw Error(t.data.message)}catch(t){throw t}}};Ge([O],Te.prototype,"SET_PROJECTS",1),Ge([O],Te.prototype,"DELETE_PROJECT",1),Ge([O],Te.prototype,"UPDATE_PROJECT_NAME",1),Ge([O],Te.prototype,"MOVE_PROJECT",1),Ge([O],Te.prototype,"COPY_PROJECT",1),Ge([O],Te.prototype,"CREATE_PROJECT_GROUP",1),Ge([O],Te.prototype,"DELETE_PROJECT_GROUP",1),Ge([I],Te.prototype,"getProjects",1),Ge([I],Te.prototype,"deleteProject",1),Ge([I],Te.prototype,"updateProjectName",1),Ge([I],Te.prototype,"moveProject",1),Ge([I],Te.prototype,"copyProject",1),Ge([I],Te.prototype,"createProjectGroup",1),Ge([I],Te.prototype,"deleteProjectGroup",1),Ge([I],Te.prototype,"updateProjectGroupName",1),Te=Ge([h({dynamic:!0,store:f,name:"project"})],Te);const Oe=y(Te);var Ie=R({name:"MyScreen",props:{screen:{type:Object,required:!0}},setup(e){const{deleteProject:t,copyProject:a,updateProjectName:r}=Oe,{id:n,name:o,groupId:s,share:l,thumbnail:c}=S(e.screen),i=A(o.value),u=A(o.value),d=x((()=>c.value?{"background-image":`url(${c.value})`}:{"background-image":`url(${J.logo})`,"background-size":"50%","background-position":"center center","background-repeat":"no-repeat",filter:"grayscale(1)",opacity:.07})),p=x((()=>{const e=!!l.value;return{published:e,text:e?"已发布":"未发布"}})),g=N("dragStart"),v=N("dragEnd"),m=N("publish"),h=new Image;h.src="//files.pengxiaotian.com/datav/drag-thumbnail.png";return{name:o,thumbnailStyle:d,publishState:p,screenName:i,oldScreenName:u,onInputBlur:async()=>{if(i.value)try{await r({id:n.value,newName:i.value}),o.value=i.value}catch(e){L.error(L.format(e))}else i.value=u.value},confirmCopyProject:()=>{a({pid:n.value,gid:s.value})},confirmDeleteProject:()=>{B.confirmAsync(`<b>${i.value}</b> 删除后无法恢复，确认删除？`,(()=>t({pid:n.value,gid:s.value})))},onDragStart:e=>{g();const t=e.dataTransfer;t&&(t.effectAllowed="move",t.setDragImage(h,30,30),t.setData("text",`${n.value},${s.value}`))},onDragEnd:()=>{v()},doPublish:()=>{m(n.value)}}}});const ke=W();M("data-v-7bc9601d");const Re={class:"my-screen"},Se={class:"screen"},Ae={class:"screen-info"},xe={class:"screen-edit"},Je={class:"screen-button"},Ne=X(" 编辑 "),Le={class:"main-button"},Be=Y("i",{class:"v-icon-move"},null,-1),Me=Y("i",{class:"v-icon-copy"},null,-1),Ue=Y("i",{class:"v-icon-delete"},null,-1),Ve=Y("i",{class:"v-icon-preview"},null,-1),$e=Y("i",{class:"v-icon-release"},null,-1),Ke={class:"screen-main"},Ye={class:"main-name"},qe={class:"screen-name-input"},ze=Y("i",{class:"v-icon-edit"},null,-1),Fe={class:"publish-info"};U();const We=ke(((e,t,a,r,n,o)=>{const s=V("el-button"),l=V("router-link"),c=V("g-tooltip-popover");return $(),K("div",Re,[Y("div",Se,[Y("div",Ae,[Y("div",{class:"screen-img",style:e.thumbnailStyle},null,4),Y("div",xe,[Y("div",Je,[Y(l,{to:{name:"ScreenEditor",params:{projectId:e.screen.id}},target:"_blank",class:"edit-wrap"},{default:ke((()=>[Y(s,{type:"primary",size:"small",class:"edit"},{default:ke((()=>[Ne])),_:1})])),_:1},8,["to"]),Y("div",Le,[Y(c,{content:"移动"},{default:ke((()=>[Y("span",{class:"button-span",draggable:"true",onDragstart:t[1]||(t[1]=(...t)=>e.onDragStart&&e.onDragStart(...t)),onDragend:t[2]||(t[2]=(...t)=>e.onDragEnd&&e.onDragEnd(...t))},[Be],32)])),_:1}),Y(c,{content:"复制"},{default:ke((()=>[Y("span",{class:"button-span",onClick:t[3]||(t[3]=(...t)=>e.confirmCopyProject&&e.confirmCopyProject(...t))},[Me])])),_:1}),Y(c,{content:"删除"},{default:ke((()=>[Y("span",{class:"button-span",onClick:t[4]||(t[4]=(...t)=>e.confirmDeleteProject&&e.confirmDeleteProject(...t))},[Ue])])),_:1})])]),Y(l,{to:{name:"Preview",params:{screenId:e.screen.id}},target:"_blank",class:"preview"},{default:ke((()=>[Y(c,{content:"预览"},{default:ke((()=>[Ve])),_:1})])),_:1},8,["to"]),Y("div",{class:"public",onClick:t[5]||(t[5]=(...t)=>e.doPublish&&e.doPublish(...t))},[Y(c,{content:"发布"},{default:ke((()=>[$e])),_:1})])])]),Y("div",Ke,[Y("div",Ye,[Y(c,{placement:"top-start","show-after":1e3,content:e.screen.name},{default:ke((()=>[Y("div",qe,[ze,q(Y("input",{"onUpdate:modelValue":t[6]||(t[6]=t=>e.screenName=t),class:"input",onBlur:t[7]||(t[7]=(...t)=>e.onInputBlur&&e.onInputBlur(...t))},null,544),[[z,e.screenName,void 0,{trim:!0}]])])])),_:1},8,["content"]),Y("div",Fe,[Y("span",{class:["dot",{published:e.publishState.published}]},null,2),Y("span",null,F(e.publishState.text),1)])])])])])}));Ie.render=We,Ie.__scopeId="data-v-7bc9601d";var Xe=R({name:"ProjectList",components:{MyScreen:Ie,PublishScreen:ue},props:{group:Object},setup(e){const t=A(""),a=A("name"),r=A({name:"按名称排序",createAt:"按创建时间排序",updateAt:"按修改时间排序"}),n=A(!1),o=A(0),s=Z(e,"group"),l=x((()=>{let e=s.value?s.value.children:[];if(t.value){const a=t.value.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(a)))}return _e(e,a.value)}));return H("publish",(e=>{n.value=!0,o.value=e})),{cdn:"//files.pengxiaotian.com",searchText:t,sort:a,sorts:r,visiblePublish:n,publishAppId:o,onSortChange:e=>{a.value=e},screens:l}}});const Ze=W();M("data-v-42910507");const He=Y("div",{class:"new-projects-title"},"选择下面的方式进行创建",-1),Qe={class:"new-projects"},et=Y("span",{class:"project-type ellipsis"},"PC端创建",-1),tt={class:"project-header"},at={class:"project-title"},rt={class:"header-manager"},nt={class:"search"},ot=Y("i",{class:"v-icon-search"},null,-1),st={class:"sort-type"},lt=Y("i",{class:"v-icon-arrow-down arrow-icon"},null,-1),ct={class:"main-screen"};U();const it=Ze(((e,t,a,r,n,o)=>{const s=V("router-link"),l=V("g-drop-list-item"),c=V("g-drop-list"),i=V("g-drop-list-popover"),u=V("my-screen"),d=V("publish-screen");return $(),K("div",null,[He,Y("div",Qe,[Y(s,{to:{name:"CreateScreen"},target:"_blank",class:"new-project"},{default:Ze((()=>[Y("img",{src:`${e.cdn}/datav/new-project.png`},null,8,["src"]),et])),_:1})]),Y("div",tt,[Y("div",at,[Y("h2",null,F(e.group?e.group.name:""),1)]),Y("div",rt,[Y("div",nt,[q(Y("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.searchText=t),class:"search-input",placeholder:"搜索"},null,512),[[z,e.searchText,void 0,{trim:!0}]])]),ot,Y(i,null,{droplist:Ze((()=>[Y(c,null,{default:Ze((()=>[($(!0),K(Q,null,ee(e.sorts,((t,a)=>($(),K(l,{key:a,onClick:t=>e.onSortChange(a)},{default:Ze((()=>[X(F(t),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),default:Ze((()=>[Y("div",st,[Y("span",{class:"sort-text",title:e.sorts[e.sort]},F(e.sorts[e.sort]),9,["title"]),lt])])),_:1})])]),Y("div",ct,[($(!0),K(Q,null,ee(e.screens,(e=>($(),K("div",{key:e.id},[Y(u,{screen:e},null,8,["screen"])])))),128))]),Y(d,{modelValue:e.visiblePublish,"onUpdate:modelValue":t[2]||(t[2]=t=>e.visiblePublish=t),"project-id":e.publishAppId},null,8,["modelValue","project-id"])])}));Xe.render=it,Xe.__scopeId="data-v-42910507";var ut=R({name:"MyProject",components:{ProjectList:Xe},setup(){const{getProjects:e,moveProject:t,createProjectGroup:a,deleteProjectGroup:r,updateProjectGroupName:n}=Oe,o=A(-1),s=A(!0),l=A(!1),c=A(!1),i=x((()=>Oe.group)),u=x((()=>Oe.ungroup)),d=x((()=>Oe.groups)),p=x((()=>-1===o.value?i.value:0===o.value?u.value:d.value.find((e=>e.id===o.value)))),g=e=>{o.value=e};H("dragStart",(()=>{c.value=!0})),H("dragEnd",(()=>{c.value=!1}));return te((()=>{e().finally((()=>{s.value=!1}))})),{loading:s,group:i,ungroup:u,groups:d,selectedGroup:p,selectedGroupId:o,adding:l,toggleProject:g,onAddInputBlur:e=>{if(!l.value)return;(e.target.value||"").trim()||(l.value=!1)},addGroup:async e=>{if(!l.value)return;const t=(e.target.value||"").trim();if(t)try{await a(t),l.value=!1}catch(r){L.error(L.format(r))}else l.value=!1},onEditInputBlur:(e,t)=>{if(!t.editing)return;const a=(e.target.value||"").trim();a&&t.name!==a||(t.editing=!1)},editGroup:async(e,t)=>{if(!t.editing)return;const a=(e.target.value||"").trim();if(a&&t.name!==a)try{await n({id:t.id,newName:a}),t.name=a,t.editing=!1}catch(r){L.error(L.format(r))}else t.editing=!1},confirmDeleteGroup:e=>{B.confirmAsync(`<b>${e.name}</b> 删除后无法恢复，该分组中的可视化应用将全部移动到未分组，确认删除？`,(()=>r(e.id)),{success:()=>{g(u.value.id)}})},draging:c,onDragEnter:e=>{ce(e.target,"drag-enter")},onDragLeave:e=>{ie(e.target,"drag-enter")},onDrop:(e,a)=>{e.preventDefault(),ie(e.target,"drag-enter");const r=e.dataTransfer.getData("text");if(r){const[e,n]=r.split(",").map((e=>parseInt(e)));n!==a.id&&t({pid:e,fromId:n,toId:a.id})}}}}});const dt=W();M("data-v-76b59ae0");const pt={class:"my-project"},gt={class:"project-main"},vt={class:"project-manage"},mt={class:"manage-title"},ht={class:"my-project project-group"},ft=Y("span",{style:{"margin-left":"2px"}},"我的分组",-1),yt={class:"project-num"},Et={key:0,class:"new-group"},Pt={class:"project-name project-ungrouped"},jt={class:"project-num"},bt={class:"project-name"},wt={class:"project-num"},_t={class:"group-btns"},Ct={class:"project-screen-list"};U();const Dt=dt(((e,t,a,r,n,o)=>{const s=V("project-list"),l=V("g-loading"),c=ae("focus");return $(),K("div",pt,[Y("div",gt,[Y("div",vt,[Y("div",mt,[Y("div",ht,[ft,Y("i",{class:"v-icon-plus btn-add-icon",onClick:t[1]||(t[1]=t=>e.adding=!0)})]),Y("div",{class:["my-project project-all",{"project-checked-color":e.selectedGroupId===e.group.id}],onClick:t[2]||(t[2]=t=>e.toggleProject(e.group.id))},[Y("span",null,F(e.group.name),1),Y("span",yt,F(e.group.children.length),1)],2),e.adding?($(),K("div",Et,[q(Y("input",{class:"edit-input",onBlur:t[3]||(t[3]=(...t)=>e.onAddInputBlur&&e.onAddInputBlur(...t)),onKeyup:t[4]||(t[4]=re(((...t)=>e.addGroup&&e.addGroup(...t)),["enter"]))},null,544),[[c]])])):ne("",!0)]),Y("div",{class:["manage-main",{draging:e.draging}]},[Y("div",{class:["main-project",{"project-checked-color":e.selectedGroupId===e.ungroup.id}],onClick:t[5]||(t[5]=t=>e.toggleProject(e.ungroup.id)),onDragover:t[6]||(t[6]=oe((()=>{}),["prevent"])),onDragenter:t[7]||(t[7]=(...t)=>e.onDragEnter&&e.onDragEnter(...t)),onDragleave:t[8]||(t[8]=(...t)=>e.onDragLeave&&e.onDragLeave(...t)),onDrop:t[9]||(t[9]=t=>e.onDrop(t,e.ungroup))},[Y("span",Pt,F(e.ungroup.name),1),Y("span",jt,F(e.ungroup.children.length),1)],34),($(!0),K(Q,null,ee(e.groups,(a=>($(),K("div",{key:a.id,class:["main-project group-project",{"project-checked-color":e.selectedGroupId===a.id}],onClick:t=>e.toggleProject(a.id),onDragover:t[10]||(t[10]=oe((()=>{}),["prevent"])),onDragenter:t[11]||(t[11]=(...t)=>e.onDragEnter&&e.onDragEnter(...t)),onDragleave:t[12]||(t[12]=(...t)=>e.onDragLeave&&e.onDragLeave(...t)),onDrop:t=>e.onDrop(t,a)},[a.editing?q(($(),K("input",{key:0,"default-value":a.name,class:"edit-input",onBlur:t=>e.onEditInputBlur(t,a),onKeyup:re((t=>e.editGroup(t,a)),["enter"])},null,40,["default-value","onBlur","onKeyup"])),[[c]]):($(),K(Q,{key:1},[Y("span",bt,F(a.name),1),Y("span",wt,F(a.children.length),1),Y("span",_t,[Y("i",{class:"v-icon-edit",onClick:e=>a.editing=!0},null,8,["onClick"]),Y("i",{class:"v-icon-delete",onClick:t=>e.confirmDeleteGroup(a)},null,8,["onClick"])])],64))],42,["onClick","onDrop"])))),128))],2)]),Y("div",Ct,[Y(l,{spinning:e.loading},{default:dt((()=>[Y(s,{group:e.selectedGroup},null,8,["group"])])),_:1},8,["spinning"])])])])}));ut.render=Dt,ut.__scopeId="data-v-76b59ae0";export default ut;
