import{a4 as r,a8 as g,ab as t,a2 as O,aF as C,ac as z,a9 as A,ae as I,bb as Y,bc as J,a7 as j,be as N,bh as D,a3 as l,ad as K,a5 as U,af as G,aY as n,b0 as m,aa as Q,b1 as T,aN as le,aO as ue}from"./vendor.577170a9.js";import{b as R,a6 as $,H as V,z as Z,C as x,_ as ee,a7 as te,a8 as ae,F as W,a9 as de,aa as se,a1 as oe,ab as ie}from"./App.7d9600e2.js";import{I as re}from"./arrow-right.3c31d15d.js";import{I as ce}from"./search.9e6a9cb8.js";import{I as pe}from"./plus.f66c3531.js";import{F as _e}from"./filter-collapse-panel.2744f764.js";import"./arrow-left.723de3f7.js";import"./edit.3ff5df3e.js";import"./delete.dfde7a3e.js";import"./release.9cf26f04.js";const fe={},ve={t:"1634405484123",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3937",width:"64",height:"64"},me=t("path",{d:"M233.088 189.141333A425.002667 425.002667 0 0 1 512 85.333333c235.648 0 426.666667 191.018667 426.666667 426.666667 0 91.136-28.586667 175.616-77.226667 244.906667L725.333333 512h128A341.333333 341.333333 0 0 0 275.626667 265.728l-42.538667-76.586667z m557.824 645.717334A425.002667 425.002667 0 0 1 512 938.666667C276.352 938.666667 85.333333 747.648 85.333333 512c0-91.136 28.586667-175.616 77.226667-244.906667L298.666667 512H170.666667a341.333333 341.333333 0 0 0 577.706666 246.272l42.538667 76.586667z","p-id":"3938"},null,-1),he=[me];function ge(e,s){return r(),g("svg",ve,he)}var ne=R(fe,[["render",ge]]);const be=O({name:"DisplayApiStatus",props:{status:{type:String,default:$.incomplete},loadingText:{type:String,default:"\u5339\u914D\u4E2D"},successText:{type:String,default:"\u5339\u914D\u6210\u529F"},failedText:{type:String,default:"\u672A\u627E\u5230\u5B57\u6BB5"},completedText:{type:String,default:"\u914D\u7F6E\u5B8C\u6210"},incompleteText:{type:String,default:"\u914D\u7F6E\u672A\u5B8C\u6210"},optional:{type:Boolean,default:!1}},setup(e){const s=C(()=>e.status===$.loading?e.loadingText:e.status===$.success?e.successText:e.status===$.completed?e.completedText:e.optional?"\u53EF\u9009":e.status===$.failed?e.failedText:e.status===$.incomplete?e.incompleteText:e.status);return{apiStatus:$,statusText:s}}}),X=e=>(Y("data-v-494a8d1a"),e=e(),J(),e),Fe=X(()=>t("i",{class:"status-icon validating"},null,-1)),Ce=X(()=>t("i",{class:"status-icon validating"},null,-1)),we=X(()=>t("i",{class:"status-icon validating"},null,-1)),De={key:2,class:"status-icon --success"},Ee={class:"status-text"};function ye(e,s,w,h,u,d){return r(),g("div",null,[e.status===e.apiStatus.loading?(r(),g(z,{key:0},[Fe,Ce,we],64)):e.status===e.apiStatus.success||e.status===e.apiStatus.completed?(r(),g("i",{key:1,class:A(["status-icon",`--${e.status}`])},null,2)):e.optional?(r(),g("i",De)):(r(),g("i",{key:3,class:A(["status-icon",`--${e.status}`])},null,2)),t("span",Ee,I(e.statusText),1)])}var $e=R(be,[["render",ye],["__scopeId","data-v-494a8d1a"]]);const Se=O({name:"FilterConfig",components:{IconPlus:pe,FilterCollapsePanel:_e},setup(){const e=j(void 0),s=j(null),w=j(null),h=j({visible:!1,top:"4px",from:0,to:0}),u=N("apiDataConfig"),d=N("refreshData"),p=C(()=>{const a=u.value.pageFilters.map(o=>o.id);return V.dataFilters.filter(o=>!a.includes(o.id)).map(o=>({value:o.id,label:o.name}))}),_=C(()=>u.value.pageFilters.reduce((a,o)=>{const c=V.dataFilters.find(q=>q.id==o.id);return c&&a.push(c),a},[])),v=C(()=>{const a=[...Z.coms,...Z.subComs],o=Object.create(null);return a.forEach(c=>{for(const q in c.apiData)c.apiData[q].pageFilters.forEach(L=>{o[L.id]?(o[L.id].ids.push(c.id),o[L.id].names.push(c.alias)):o[L.id]={ids:[c.id],names:[c.alias]}})}),o}),b=C(()=>u.value.pageFilters.reduce((a,o)=>(a[o.id]=o.enabled,a),{})),f=a=>{u.value.pageFilters.push({id:a,enabled:!0}),d()},E=(a,o)=>{u.value.pageFilters.find(c=>c.id===a).enabled=o,d()},k=(a,o)=>{const c=a.trim();c&&o.name!==c&&(o.name=c,o.id>0&&V.updateFilterName(o))},S=()=>{s.value||(s.value={id:0,name:"\u65B0\u5EFA\u8FC7\u6EE4\u5668",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})},i=a=>{a>0?(u.value.pageFilters=u.value.pageFilters.filter(o=>o.id!==a),d()):s.value=null},y=async a=>{if(a.id>0)await V.updateFilter(a),b.value[a.id]&&d();else{const o=await V.createFilter(a);u.value.pageFilters.push({id:o,enabled:!0}),s.value=null,d()}},F=()=>{const{from:a,to:o}=h.value;if(a!==o){const c=u.value.pageFilters;c.splice(o,0,...c.splice(a,1)),d()}},B=(a,o,c)=>{h.value.visible=a,h.value.top=`${c.offsetTop-6}px`,a?h.value.to=o:(h.value.from=o,F())},M=()=>{B(!0,_.value.length,w.value)};return D("usedFilters",v),D("enabledFilters",b),D("onUsedChange",E),D("editFilterName",k),D("removeFilter",i),D("saveFilter",y),D("updateIndicator",B),{filterId:e,apiDataConfig:u,dataFilters:p,selectedFilters:_,newDataFilter:s,addPanelRef:w,dragInfo:h,selectFilter:f,addFilter:S,dragEnter:M}}}),ke={class:"filter-list"},Be=t("span",{class:"datav-empty"},"\u8FC7\u6EE4\u5668\u5217\u8868\u4E3A\u7A7A\uFF0C\u8BF7\u521B\u5EFA\u540E\u4F7F\u7528",-1),Ae=t("div",{class:"filter-dragging-wp"},null,-1);function Ie(e,s,w,h,u,d){const p=l("filter-collapse-panel"),_=l("n-select"),v=l("IconPlus"),b=l("n-icon");return r(),g("div",{class:A(["filter-wp",{"--disabled":!e.apiDataConfig.config.useFilter}])},[t("div",ke,[(r(!0),g(z,null,K(e.selectedFilters,(f,E)=>(r(),U(p,{key:f.id,index:E,"data-filter":f},null,8,["index","data-filter"]))),128)),e.newDataFilter?(r(),U(p,{key:0,"data-filter":e.newDataFilter,index:e.selectedFilters.length,"is-new":!0,draggable:!1,"has-feedback":!1,removable:!0},null,8,["data-filter","index"])):G("",!0),t("div",{ref:"addPanelRef",class:"add-filter",onDragenter:s[1]||(s[1]=(...f)=>e.dragEnter&&e.dragEnter(...f))},[n(_,{value:e.filterId,options:e.dataFilters,filterable:"","fallback-option":!1,placeholder:"\u6DFB\u52A0\u8FC7\u6EE4\u5668",class:"datav-new-select filter-select",style:Q({"--border":"var(--datav-gui-new-select-border)","--color":"var(--datav-gui-new-select-bgcolor)"}),"onUpdate:value":e.selectFilter},{empty:m(()=>[Be]),_:1},8,["value","options","style","onUpdate:value"]),t("div",{class:"new-filter-btn",onClick:s[0]||(s[0]=(...f)=>e.addFilter&&e.addFilter(...f))},[n(b,{class:"icon-add"},{default:m(()=>[n(v)]),_:1})])],544)]),Ae,t("div",{class:"drag-indicator",style:Q({display:e.dragInfo.visible?"block":"none",top:e.dragInfo.top})},null,4)],2)}var Ne=R(Se,[["render",Ie]]);const je=O({name:"FieldGrid",props:{fields:{type:Object}}}),H=e=>(Y("data-v-6b5d57f6"),e=e(),J(),e),Te={key:0,class:"field-wp"},Pe=H(()=>t("div",{class:"field-info"},"\u6570\u636E\u76F8\u5E94\u7ED3\u679C\u5E94\u4E3A\u5217\u8868\uFF0C\u5217\u8868\u5143\u7D20\u5305\u542B\u5982\u4E0B\u5B57\u6BB5",-1)),Ue={class:"field-grid"},Re=H(()=>t("div",{class:"field-item field-title"},"\u5B57\u6BB5",-1)),Me=H(()=>t("div",{class:"field-item field-title"},"\u6620\u5C04",-1)),Oe=H(()=>t("div",{class:"field-item field-title"},"\u8BF4\u660E",-1)),ze={class:"field-item"},Ve={class:"field-item"},Le={class:"field-item"};function Ge(e,s,w,h,u,d){return e.fields?(r(),g("div",Te,[Pe,t("div",Ue,[Re,Me,Oe,(r(!0),g(z,null,K(e.fields,(p,_)=>(r(),g(z,{key:_},[t("div",ze,I(_),1),t("div",Ve,I(p.map||"-"),1),t("div",Le,I(p.description||"-"),1)],64))),128))])])):G("",!0)}var He=R(je,[["render",Ge],["__scopeId","data-v-6b5d57f6"]]);const qe=O({name:"SourceDrawer",components:{FilterConfig:Ne,FieldGrid:He,IconSearch:ce,IconRefresh:ne,DsStaticEditor:x(()=>ee(()=>import("./ds-static-editor.f7ea6a65.js"),["assets/ds-static-editor.f7ea6a65.js","assets/App.7d9600e2.js","assets/App.0b4877a0.css","assets/vendor.577170a9.js"])),DsApiEditor:x(()=>ee(()=>import("./ds-api-editor.6c52bbf0.js"),["assets/ds-api-editor.6c52bbf0.js","assets/ds-api-editor.7a7263ff.css","assets/App.7d9600e2.js","assets/App.0b4877a0.css","assets/vendor.577170a9.js"]))},setup(){const e=j(!1),s=j(!1),w=ae,h=Object.entries(te()).map(([i,y])=>({value:i,label:y})),u=()=>{e.value=!0},d=N("com"),p=N("apiConfig"),_=N("apiDataConfig"),v=N("apiName"),b=C(()=>{var y;const i=W.dataStatusMap[d.value.id];return i?(y=i[v])!=null?y:{}:{}}),f=C(()=>{const i=W.originMap[d.value.id];return i?i[v]:""}),E=i=>{switch(i){case ae.api:de(_.value.config);break}},k=C(()=>{const i=se.dataMap[d.value.id];return i?i[v]:""}),S=async()=>{await oe(d.value.id,v,p.value,_.value)};return D("refreshData",S),D("dataStatus",b),{visible:e,visiblePreview:s,apiType:w,datasources:h,com:d,apiConfig:p,apiDataConfig:_,dataStatus:b,dataOrign:f,resData:k,open:u,changeSource:E,refreshData:S}}}),Ye=t("p",{class:"source-drawer-title"},"\u8BBE\u7F6E\u6570\u636E\u6E90",-1),Je={class:"datasource-selector"},Ke=t("label",{class:"datasource-selector-title"},"\u6570\u636E\u6E90\u7C7B\u578B",-1),Qe={class:"datasource-select"},We={class:"datav-new-select-wp"},Xe={class:"ds-response-btn"},Ze=T(" \u9884\u89C8\u6570\u636E\u6E90\u8FD4\u56DE\u7ED3\u679C "),xe={class:"ds-preview-content"},et=t("span",{class:"use-filter-text"},"\u6570\u636E\u8FC7\u6EE4\u5668",-1),tt=t("span",{class:"tutorial-popup"},"\u6559\u7A0B",-1),at=t("span",null,"\u6570\u636E\u54CD\u5E94\u7ED3\u679C",-1),st={class:"data-response"};function ot(e,s,w,h,u,d){const p=l("n-select"),_=l("ds-static-editor"),v=l("ds-api-editor"),b=l("IconSearch"),f=l("n-icon"),E=l("g-monaco-editor"),k=l("n-popover"),S=l("n-checkbox"),i=l("filter-config"),y=l("field-grid"),F=l("IconRefresh"),B=l("n-drawer-content"),M=l("n-drawer");return r(),U(M,{show:e.visible,"onUpdate:show":s[3]||(s[3]=a=>e.visible=a),width:"500px",class:"source-drawer",to:"#edit-main-wp"},{default:m(()=>[n(B,{closable:""},{header:m(()=>[Ye]),default:m(()=>[t("div",{class:A(["step-title",{"--error":!!e.dataStatus.api}])}," \u6570\u636E\u6E90 ",2),t("div",Je,[Ke,t("div",Qe,[t("div",We,[n(p,{value:e.apiDataConfig.type,"onUpdate:value":[s[0]||(s[0]=a=>e.apiDataConfig.type=a),e.changeSource],options:e.datasources,filterable:"",class:"datav-new-select",style:Q({"--border":"var(--datav-gui-new-select-border)","--color":"var(--datav-gui-new-select-bgcolor)"})},null,8,["value","options","style","onUpdate:value"])])])]),e.apiDataConfig.type===e.apiType.static?(r(),U(_,{key:0})):e.apiDataConfig.type===e.apiType.api?(r(),U(v,{key:1})):G("",!0),n(k,{show:e.visiblePreview,"onUpdate:show":s[1]||(s[1]=a=>e.visiblePreview=a),placement:"left",width:400,class:"editor-popover"},{trigger:m(()=>[t("div",Xe,[n(f,{class:"refresh-btn"},{default:m(()=>[n(b)]),_:1}),Ze])]),default:m(()=>[t("div",xe,[n(E,{language:"json","read-only":!0,"auto-format":!0,height:180,code:e.dataOrign},null,8,["code"])])]),_:1},8,["show"]),t("div",{class:A(["step-title",{"--error":!!e.dataStatus.filter}])},[n(S,{checked:e.apiDataConfig.config.useFilter,"onUpdate:checked":s[2]||(s[2]=a=>e.apiDataConfig.config.useFilter=a),class:"use-filter-btn"},null,8,["checked"]),et,tt],2),n(i),n(y,{fields:e.apiConfig.fields},null,8,["fields"]),t("div",{class:A(["step-title",{"--error":!!e.dataStatus.api||!!e.dataStatus.filter}])},[at,n(f,{class:"refresh-btn",onClick:e.refreshData},{default:m(()=>[n(F)]),_:1},8,["onClick"])],2),t("div",st,[n(E,{language:"json","read-only":!0,"auto-format":!0,code:e.resData},null,8,["code"])])]),_:1})]),_:1},8,["show"])}var it=R(qe,[["render",ot]]);const nt=O({name:"SourcePanel",components:{DisplayApiStatus:$e,SourceDrawer:it,IconArrowRight:re,IconRefresh:ne},props:{apiName:{type:String,required:!0},activeName:String,collapse:Boolean},setup(e){const s=C(()=>e.apiName===e.activeName),w=j(null),h=te(),u=N("com"),d=C(()=>u.value.apis[e.apiName]),p=C(()=>u.value.apiData[e.apiName]);D("apiConfig",d),D("apiDataConfig",p),D("apiName",e.apiName);const _=C(()=>{const i=se.dataMap[u.value.id];return i?i[e.apiName]:""}),v=C(()=>{const i=W.fieldStatusMap[u.value.id];return i?i[e.apiName]:{}}),b=C(()=>{const i=Object.values(v.value);return i.includes(ie.loading)?$.loading:i.includes(ie.failed)?$.incomplete:$.completed}),f=N("changePanel");return{visible:s,sourceDrawerRef:w,datasources:h,com:u,apiConfig:d,apiDataConfig:p,fieldsStatus:v,totalStatus:b,datav_data:_,toggle:()=>{e.collapse&&f(e.apiName)},openSourceDrawer:()=>{var i;(i=w.value)==null||i.open()},refreshData:()=>{oe(u.value.id,e.apiName,d.value,p.value)}}}}),P=e=>(Y("data-v-11637a49"),e=e(),J(),e),lt={class:"api-editor-title"},ut={class:"api-status success"},dt={class:"attr-source-wp"},rt={class:"data-attr-table-container"},ct={class:"data-attr-table"},pt=P(()=>t("thead",{class:"table-head"},[t("tr",{class:"table-head-row"},[t("th",{class:"th-item column-item attr-name"}," \u5B57\u6BB5 "),t("th",{class:"th-item column-item attr-value"}," \u6620\u5C04 "),t("th",{class:"th-item column-item attr-status"}," \u72B6\u6001 ")])],-1)),_t={class:"table-body"},ft={class:"column-item attr-name"},vt={class:"ellipsis2"},mt={class:"column-item attr-value"},ht={class:"column-item attr-status"},gt={key:1,class:"table-body-row"},bt=P(()=>t("td",{class:"column-item attr-name"},[t("span",null,"\u4EFB\u610F")],-1)),Ft=P(()=>t("td",{class:"column-item attr-value"},null,-1)),Ct={class:"column-item attr-status"},wt={class:"data-source"},Dt=P(()=>t("div",{class:"data-result-title"}," \u6570\u636E\u54CD\u5E94\u7ED3\u679C ",-1)),Et={class:"auto-update-config"},yt=T(" \u81EA\u52A8\u66F4\u65B0\u9009\u9879 "),$t=T(" \u79D2\u4E00\u6B21 "),St={class:"data-flow-wp"},kt={class:"ds-line"},Bt={class:"ds-title"},At={class:"ds-type-text"},It=T(" \u914D\u7F6E\u6570\u636E\u6E90 "),Nt={class:"ds-line mt5"},jt=P(()=>t("span",null,"\u6570\u636E\u54CD\u5E94\u7ED3\u679C ( \u53EA\u8BFB ) ",-1)),Tt=T(" \u5237\u65B0\u6570\u636E "),Pt={class:"ds-dots"},Ut=P(()=>t("span",{class:"ds-dot"},null,-1)),Rt=P(()=>t("span",{class:"ds-dot"},null,-1)),Mt={class:"data-response"};function Ot(e,s,w,h,u,d){const p=l("IconArrowRight"),_=l("n-icon"),v=l("display-api-status"),b=l("n-tooltip"),f=l("new-input"),E=l("n-checkbox"),k=l("n-button"),S=l("IconRefresh"),i=l("g-monaco-editor"),y=l("source-drawer");return r(),g("div",{class:A(["api-editor",{"--disable-fold":!e.collapse,"--fold":e.collapse&&e.visible}])},[t("div",lt,[t("div",{class:"api-desc ellipsis2",onClick:s[0]||(s[0]=(...F)=>e.toggle&&e.toggle(...F))},[e.collapse?(r(),U(_,{key:0,class:"api-fold-icon"},{default:m(()=>[n(p)]),_:1})):G("",!0),T(" "+I(e.apiConfig.description||"\u6570\u636E\u63A5\u53E3"),1)]),t("div",ut,[n(v,{status:e.totalStatus,"success-text":"\u914D\u7F6E\u5B8C\u6210"},null,8,["status"])])]),le(t("div",dt,[t("div",rt,[t("table",ct,[pt,t("tbody",_t,[Object.keys(e.apiConfig.fields).length>0?(r(!0),g(z,{key:0},K(e.apiConfig.fields,(F,B)=>(r(),g("tr",{key:B,class:"table-body-row"},[t("td",ft,[n(b,{placement:"left"},{trigger:m(()=>[t("span",vt,I(B),1)]),default:m(()=>[T(" "+I(F.description),1)]),_:2},1024)]),t("td",mt,[n(f,{"model-value":F.map,placeholder:"\u53EF\u81EA\u5B9A\u4E49",class:"attr-input",onChange:M=>F.map=M},null,8,["model-value","onChange"])]),t("td",ht,[n(v,{status:e.fieldsStatus[B],optional:F.optional},null,8,["status","optional"])])]))),128)):(r(),g("tr",gt,[bt,Ft,t("td",Ct,[n(v,{status:"completed"})])]))])])]),t("div",wt,[Dt,t("div",Et,[n(E,{checked:e.apiConfig.useAutoUpdate,"onUpdate:checked":s[1]||(s[1]=F=>e.apiConfig.useAutoUpdate=F),class:"auto-update-checkbox"},{default:m(()=>[yt]),_:1},8,["checked"]),n(f,{"model-value":e.apiConfig.autoUpdate,type:"number",disabled:!e.apiConfig.useAutoUpdate,class:"update-interval-input",onChange:s[2]||(s[2]=F=>e.apiConfig.autoUpdate=F)},null,8,["model-value","disabled"]),$t]),t("div",St,[t("div",kt,[t("div",Bt,[t("span",At,I(e.datasources[e.apiDataConfig.type]),1)]),n(k,{size:"tiny",class:"ds-action-btn",onClick:e.openSourceDrawer},{default:m(()=>[It]),_:1},8,["onClick"])]),t("div",Nt,[jt,n(b,{placement:"left"},{trigger:m(()=>[n(_,{class:"refresh-btn",onClick:e.refreshData},{default:m(()=>[n(S)]),_:1},8,["onClick"])]),default:m(()=>[Tt]),_:1})]),t("div",Pt,[t("span",{class:A(["ds-dot",[e.totalStatus==="completed"?"active":"error"]])},null,2),Ut,Rt])]),t("div",Mt,[n(i,{language:"json","read-only":!0,"auto-format":!0,code:e.datav_data,height:250,"full-screen-title":"\u6570\u636E\u54CD\u5E94\u7ED3\u679C"},null,8,["code"])])])],512),[[ue,e.visible]]),n(y,{ref:"sourceDrawerRef"},null,512)],2)}var Xt=R(nt,[["render",Ot],["__scopeId","data-v-11637a49"]]);export{Xt as default};
