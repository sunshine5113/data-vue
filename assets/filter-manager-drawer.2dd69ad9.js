import{d as e,e as a,j as l,h as t,p as i,aR as s,av as r,aQ as n,aN as d,b6 as o,f as c,o as u,c as f,w as p,a as m,F,b,g as v,A as g}from"./index.60fabeb6.js";import{_ as h}from"./filter-collapse-panel.13712757.js";var w=e({name:"FilterManagerDrawer",components:{FilterCollapsePanel:h},setup(){const e=a(!1),c=a(null);l((()=>s.filter.show),(a=>{e.value=a}));const u=t((()=>n.dataFilters)),f=t((()=>{const e=[...d.coms,...d.subComs],a=Object.create(null);return e.forEach((e=>{for(const l in e.apiData){e.apiData[l].pageFilters.forEach((l=>{a[l.id]?(a[l.id].ids.push(e.id),a[l.id].names.push(e.alias)):a[l.id]={ids:[e.id],names:[e.alias]}}))}})),a})),p=e=>{e>0?r.confirmAsync("是否删除数据过滤器，可能导致相关组件不可用。",(()=>n.deleteFilter(e)),{success:()=>{const a=f.value[e];if(a){[...d.coms,...d.subComs].filter((e=>a.ids.includes(e.id))).forEach((a=>{for(const l in a.apiData){const t=a.apiData[l],i=t.pageFilters.find((a=>a.id===e));t.pageFilters=t.pageFilters.filter((a=>a.id!==e)),i&&i.enabled&&o(a.id,l,a.apis[l],t)}}))}}}):c.value=null};return i("usedFilters",f),i("editFilterName",((e,a)=>{const l=e.trim();l&&a.name!==l&&(a.name=l,a.id>0&&n.updateFilterName(a))})),i("removeFilter",p),i("saveFilter",(async e=>{if(e.id>0){await n.updateFilter(e);const a=f.value[e.id];if(a){[...d.coms,...d.subComs].filter((e=>a.ids.includes(e.id))).forEach((a=>{for(const l in a.apiData){const t=a.apiData[l],i=t.pageFilters.find((a=>a.id===e.id));i&&i.enabled&&o(a.id,l,a.apis[l],t)}}))}}else await n.createFilter(e),c.value=null})),{visible:e,dataFilters:u,newDataFilter:c,close:()=>{s.filter.show=!1},addFilter:()=>{c.value||(c.value={id:0,name:"新建过滤器",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})},removeFilter:p}}});const k={class:"filter-manager-title"},D=g(" 数据过滤器"),C=m("i",{class:"v-icon-document"},null,-1),y=m("span",null,"帮助文档",-1),j={key:1,class:"panel-info"},_=m("p",{class:"info-text"},"过滤器列表为空，请创建后使用",-1),x=g(" 新建 ");w.render=function(e,a,l,t,i,s){const r=c("router-link"),n=c("filter-collapse-panel"),d=c("el-button"),o=c("el-drawer");return u(),f(o,{modelValue:e.visible,"onUpdate:modelValue":a[2]||(a[2]=a=>e.visible=a),"custom-class":"filter-manager-drawer",size:"500px",direction:"ltr",onClose:e.close},{title:p((()=>[m("p",k,[D,m("span",{class:"create-filter",onClick:a[1]||(a[1]=(...a)=>e.addFilter&&e.addFilter(...a))},"新建"),m(r,{to:{name:"MyCase"},target:"_blank",rel:"noopener noreferrer",class:"filter-doc"},{default:p((()=>[C,y])),_:1})])])),default:p((()=>[e.visible?(u(),f(F,{key:0},[e.newDataFilter?(u(),f(n,{key:0,"data-filter":e.newDataFilter,"is-new":!0,draggable:!1,"has-feedback":!1,removable:!0},null,8,["data-filter"])):b("",!0),(u(!0),f(F,null,v(e.dataFilters,(e=>(u(),f(n,{key:e.id,"data-filter":e,draggable:!1,"has-feedback":!1,publish:!0,removable:!0,"show-time":!0},null,8,["data-filter"])))),128)),0!==e.dataFilters.length||e.newDataFilter?b("",!0):(u(),f("div",j,[_,m(d,{onClick:e.addFilter},{default:p((()=>[x])),_:1},8,["onClick"])]))],64)):b("",!0)])),_:1},8,["modelValue","onClose"])};export default w;
