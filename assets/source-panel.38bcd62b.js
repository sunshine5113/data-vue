var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,i=(e,i)=>{for(var n in i||(i={}))t.call(i,n)&&s(e,n,i[n]);if(a)for(var n of a(i))l.call(i,n)&&s(e,n,i[n]);return e};import{d as n,aZ as o,e as d,y as r,z as c,l as u,m as p,F as f,p as v,v as g,A as m,r as b,ae as F,M as h,k as y,aq as C,ag as w,a_ as k,t as D,aH as S,az as _,ao as N,s as x,q as j,aG as E,aI as O,a$ as T,b0 as U,b1 as V,b2 as P,b3 as A,b4 as I}from"./index.63034fdf.js";var z=n({name:"DisplayApiStatus",props:{status:{type:String,default:o.incomplete},loadingText:{type:String,default:"匹配中"},successText:{type:String,default:"匹配成功"},failedText:{type:String,default:"未找到字段"},completedText:{type:String,default:"配置完成"},incompleteText:{type:String,default:"配置未完成"},optional:{type:Boolean,default:!1}},setup(e){const a=d((()=>e.status===o.loading?e.loadingText:e.status===o.success?e.successText:e.status===o.completed?e.completedText:e.optional?"可选":e.status===o.failed?e.failedText:e.status===o.incomplete?e.incompleteText:e.status));return{apiStatus:o,statusText:a}}});const M=m();r("data-v-7213c838");const B=v("i",{class:"status-icon validating"},null,-1),q=v("i",{class:"status-icon validating"},null,-1),R=v("i",{class:"status-icon validating"},null,-1),$={key:2,class:"status-icon --success"},G={class:"status-text"};c();const L=M(((e,a,t,l,s,i)=>(u(),p("div",null,[e.status===e.apiStatus.loading?(u(),p(f,{key:0},[B,q,R],64)):e.status===e.apiStatus.success||e.status===e.apiStatus.completed?(u(),p("i",{key:1,class:["status-icon",`--${e.status}`]},null,2)):e.optional?(u(),p("i",$)):(u(),p("i",{key:3,class:["status-icon",`--${e.status}`]},null,2)),v("span",G,g(e.statusText),1)]))));z.render=L,z.__scopeId="data-v-7213c838";var H=n({name:"FilterCollapsePanel",props:{dataFilter:{type:Object,required:!0},isNew:Boolean},setup(e){const a=b(e.isNew),t=b(e.isNew),l=b(e.isNew),s=b(e.isNew),i=b(!1),n=b(e.dataFilter.origin),o=F("usedFilters"),d=F("enabledFilters"),r=F("onUsedChange"),c=F("editFilterName"),u=F("removeFilter"),p=F("saveFilter");return{code:n,loading:i,editing:a,collapse:t,isOpened:l,isEdited:s,usedFilters:o,enabledFilters:d,onUsedChange:r,removeFilter:u,editName:t=>{a.value=!1,c(t,e.dataFilter)},changeCode:a=>{a.value!=e.dataFilter.origin&&(s.value=!0)},updateCode:e=>{n.value=e.value},cancelEdit:()=>{e.isNew?u(0):(n.value=e.dataFilter.origin,s.value=!1)},saveData:async()=>{if(s.value)try{i.value=!0,e.dataFilter.origin=n.value,e.dataFilter.code=`\n    if (!data) {  return data; }\n    return filter(...arguments);\n    function filter(data) {\n      ${n.value}\n      return data;\n    }\n`,await p(e.dataFilter),t.value=!1,s.value=!1}catch(a){h.error(h.format(a))}finally{i.value=!1}else t.value=!1},toggleEditor:()=>{l.value=!0,t.value=!t.value}}}});const Z=m();r("data-v-bad042d2");const J={class:"panel-header"},K={class:"panel-title"},Q={class:"filter-title"},W=v("i",{class:"v-icon-drag drag-btn",draggable:""},null,-1),X={class:"filter-name"},Y={class:"action-wp --edit"},ee={class:"filter-count"},ae={class:"action-wp"},te=v("i",{class:"el-icon-arrow-right toggle-icon"},null,-1),le={class:"panel-content-wp"},se={class:"cp-wrap"},ie=v("p",{title:"function filter(data) {",class:"fake-code --start"},[v("span",{class:"--keyword"},"function"),D(" filter(data) { ")],-1),ne=v("p",{class:"fake-code --end"},"}",-1),oe={class:"filter-actions"},de={key:0,class:"unsaved"};c();const re=Z(((e,a,t,l,s,i)=>{const n=y("el-checkbox"),o=y("g-input"),d=y("g-tooltip-popover"),r=y("el-tooltip"),c=y("g-monaco-editor"),m=y("el-button"),b=y("el-collapse-transition");return u(),p("div",{class:["collapse-panel-wp filter-item --draggable ds-panel-filter",{"--spread":e.collapse||e.isNew,"--create":e.isNew}]},[v("div",J,[v("div",K,[v("div",Q,[e.isNew?C("",!0):(u(),p(f,{key:0},[W,v(n,{"model-value":e.enabledFilters[e.dataFilter.id],class:"enable-checkbox",onChange:a[1]||(a[1]=a=>e.onUsedChange(e.dataFilter.id,a))},null,8,["model-value"])],64)),v("div",X,[e.editing?(u(),p(o,{key:0,"model-value":e.dataFilter.name,autofocus:!0,class:"filter-name-input",onChange:e.editName},null,8,["model-value","onChange"])):(u(),p("div",{key:1,class:"filter-name-text",title:e.dataFilter.name},g(e.dataFilter.name),9,["title"]))]),v("div",Y,[v(d,{content:"重命名"},{default:Z((()=>[v("i",{class:"v-icon-edit edit-btn",onClick:a[2]||(a[2]=a=>e.editing=!0)})])),_:1})]),v("div",ee,[e.isNew?C("",!0):(u(),p(r,{key:0,content:e.usedFilters[e.dataFilter.id].join(", "),effect:"blue",enterable:!1,placement:"top","popper-class":"filter-dep-info"},{default:Z((()=>[v("span",null,g(e.usedFilters[e.dataFilter.id].length)+" 个组件正在调用",1)])),_:1},8,["content"]))]),v("div",ae,[v(d,{content:"删除"},{default:Z((()=>[v("i",{class:"v-icon-close del-btn",onClick:a[3]||(a[3]=a=>e.removeFilter(e.dataFilter.id))})])),_:1})]),v("div",{class:["filter-dot",{"--none":e.isNew}]},null,2)])]),v("div",{class:"toggle-btn",onClick:a[4]||(a[4]=(...a)=>e.toggleEditor&&e.toggleEditor(...a))},[te])]),e.isOpened?(u(),p(b,{key:0},{default:Z((()=>[w(v("div",le,[v("div",se,[ie,v(c,{language:"javascript",code:e.code,height:180,"editor-class":"filter-editor",onChange:e.changeCode,onBlur:e.updateCode},null,8,["code","onChange","onBlur"]),ne,v("div",oe,[e.isEdited?(u(),p("div",de,"未保存")):C("",!0),v(m,{size:"mini",class:"bolder-btn",onClick:e.cancelEdit},{default:Z((()=>[D(g(0===e.dataFilter.id?"取消":e.isEdited?"撤销":"取消"),1)])),_:1},8,["onClick"]),v(m,{type:"primary",size:"mini",class:"bolder-btn",loading:e.loading,onClick:e.saveData},{default:Z((()=>[D(g(0===e.dataFilter.id||e.isEdited?"保存":"完成"),1)])),_:1},8,["loading","onClick"])])])],512),[[k,e.collapse]])])),_:1})):C("",!0)],2)}));H.render=re,H.__scopeId="data-v-bad042d2";var ce=n({name:"FilterConfig",components:{FilterCollapsePanel:H},setup(){const e=b(void 0),a=b(null),t=F("apiDataConfig"),l=d((()=>{const e=t.value.config.pageFilters.map((e=>e.id));return S.dataFilters.filter((a=>!e.includes(a.id)))})),s=d((()=>t.value.config.pageFilters.reduce(((e,a)=>{const t=S.dataFilters.find((e=>e.id==a.id));return t&&e.push(t),e}),[]))),i=d((()=>{const e=[..._.coms,..._.subComs],a=Object.create(null);return e.forEach((e=>{for(const t in e.apiData){e.apiData[t].config.pageFilters.forEach((t=>{a[t.id]?a[t.id].push(e.alias):a[t.id]=[e.alias]}))}})),a})),n=d((()=>t.value.config.pageFilters.reduce(((e,a)=>(e[a.id]=a.enabled,e)),{})));return N("usedFilters",i),N("enabledFilters",n),N("onUsedChange",((e,a)=>{t.value.config.pageFilters.find((a=>a.id===e)).enabled=a})),N("editFilterName",((e,a)=>{const t=e.trim();t&&(a.name=t)})),N("removeFilter",(e=>{e>0?t.value.config.pageFilters=t.value.config.pageFilters.filter((a=>a.id!==e)):a.value=null})),N("saveFilter",(async e=>{if(e.id>0)await S.updateFilter(e);else{const l=await S.createFilter(e);t.value.config.pageFilters.push({id:l,enabled:!0}),a.value=null}})),{filterId:e,apiDataConfig:t,dataFilters:l,selectedFilters:s,newDataFilter:a,selectFilter:e=>{t.value.config.pageFilters.push({id:e,enabled:!0})},addFilter:()=>{a.value||(a.value={id:0,name:"新建过滤器",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})}}}});const ue={class:"filter-list"},pe={class:"add-filter"},fe=v("i",{class:"el-icon-plus icon-add"},null,-1),ve=v("div",{class:"filter-dragging-wp"},null,-1),ge=v("div",{class:"drag-indicator"},null,-1);ce.render=function(e,a,t,l,s,i){const n=y("filter-collapse-panel"),o=y("el-option"),d=y("el-select");return u(),p("div",{class:["filter-wp",{"--disabled":e.apiDataConfig.config.useFilter}]},[v("div",ue,[(u(!0),p(f,null,x(e.selectedFilters,(e=>(u(),p(n,{key:e.id,"data-filter":e},null,8,["data-filter"])))),128)),e.newDataFilter?(u(),p(n,{key:0,"data-filter":e.newDataFilter,"is-new":""},null,8,["data-filter"])):C("",!0),v("div",pe,[v(d,{"model-value":e.filterId,size:"mini",filterable:"",placeholder:"添加过滤器",class:"datav-new-select filter-select","popper-class":"datav-new-select-option",onChange:e.selectFilter},{default:j((()=>[(u(!0),p(f,null,x(e.dataFilters,(e=>(u(),p(o,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["model-value","onChange"]),v("div",{class:"new-filter-btn",onClick:a[1]||(a[1]=(...a)=>e.addFilter&&e.addFilter(...a))},[fe])])]),ve,ge],2)};var me=n({name:"FieldGrid",props:{fields:{type:Object}}});const be=m();r("data-v-c0253736");const Fe={key:0,class:"field-wp"},he=v("div",{class:"field-info"},"数据相应结果应为列表，列表元素包含如下字段",-1),ye={class:"field-grid"},Ce=v("div",{class:"field-item field-title"},"字段",-1),we=v("div",{class:"field-item field-title"},"映射",-1),ke=v("div",{class:"field-item field-title"},"说明",-1),De={class:"field-item"},Se={class:"field-item"},_e={class:"field-item"};c();const Ne=be(((e,a,t,l,s,i)=>e.fields?(u(),p("div",Fe,[he,v("div",ye,[Ce,we,ke,(u(!0),p(f,null,x(e.fields,((e,a)=>(u(),p(f,{key:a},[v("div",De,g(a),1),v("div",Se,g(e.map||"-"),1),v("div",_e,g(e.description||"-"),1)],64)))),128))])])):C("",!0)));me.render=Ne,me.__scopeId="data-v-c0253736";var xe=n({name:"SourceDrawer",components:{FilterConfig:ce,FieldGrid:me,DsStaticEditor:E((()=>O((()=>import("./ds-static-editor.f6723d91.js")),["/assets/ds-static-editor.f6723d91.js","/assets/index.63034fdf.js","/assets/index.c4e125b2.css"]))),DsApiEditor:E((()=>O((()=>import("./ds-api-editor.9e06216b.js")),["/assets/ds-api-editor.9e06216b.js","/assets/ds-api-editor.e4cdc83e.css","/assets/index.63034fdf.js","/assets/index.c4e125b2.css"])))},setup(){const e=b(!1),a=b(!1),t=V,l=T(),s=F("com"),n=F("apiConfig"),o=F("apiDataConfig"),r=F("apiName"),c=d((()=>U.dataStatusMap[s.value.id]||{})),u=d((()=>{const e=U.originMap[s.value.id];return e?e[r]:""})),p=d((()=>{const e=U.dataMap[s.value.id];return e?e[r]:""}));return{visible:e,visiblePreview:a,apiType:t,datasources:l,com:s,apiConfig:n,apiDataConfig:o,dataStatus:c,dataOrign:u,resData:p,open:()=>{e.value=!0},changeSource:e=>{switch(e){case V.api:void 0===o.value.config.api&&(o.value.config=i(i({},o.value.config),P()))}},refreshData:()=>{A(s.value.id,r,n.value,o.value)}}}});const je=v("p",{class:"source-drawer-title"},"设置数据源",-1),Ee={class:"datasource-selector"},Oe=v("label",{class:"datasource-selector-title"},"数据源类型",-1),Te={class:"datasource-select"},Ue={class:"datav-new-select-wp"},Ve={class:"ds-preview-content"},Pe=v("div",{class:"ds-response-btn"},[v("i",{class:"v-icon-search"}),D(" 预览数据源返回结果 ")],-1),Ae=v("span",{class:"use-filter-text"},"数据过滤器",-1),Ie=v("span",{class:"tutorial-popup"},"教程",-1),ze=v("span",null,"数据响应结果",-1),Me={class:"data-response"};xe.render=function(e,a,t,l,s,i){const n=y("el-option"),o=y("el-select"),d=y("ds-static-editor"),r=y("ds-api-editor"),c=y("g-monaco-editor"),g=y("el-popover"),m=y("el-checkbox"),b=y("filter-config"),F=y("field-grid"),h=y("el-drawer");return u(),p(h,{modelValue:e.visible,"onUpdate:modelValue":a[5]||(a[5]=a=>e.visible=a),"custom-class":"source-drawer",size:"500px"},{title:j((()=>[je])),default:j((()=>[e.visible?(u(),p(f,{key:0},[v("div",{class:["step-title",{"--error":e.dataStatus.errSource}]}," 数据源 ",2),v("div",Ee,[Oe,v("div",Te,[v("div",Ue,[v(o,{modelValue:e.apiDataConfig.type,"onUpdate:modelValue":a[1]||(a[1]=a=>e.apiDataConfig.type=a),size:"mini",filterable:"",class:"datav-new-select","popper-class":"datav-new-select-option",onChange:e.changeSource},{default:j((()=>[(u(!0),p(f,null,x(e.datasources,((e,a)=>(u(),p(n,{key:a,label:e,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])])]),e.apiDataConfig.type===e.apiType.static?(u(),p(d,{key:0})):e.apiDataConfig.type===e.apiType.api?(u(),p(r,{key:1})):C("",!0),v(g,{visible:e.visiblePreview,"onUpdate:visible":a[2]||(a[2]=a=>e.visiblePreview=a),placement:"left",width:400,"popper-class":"editor-popover"},{reference:j((()=>[Pe])),default:j((()=>[v("div",Ve,[v(c,{language:"json","read-only":!0,"auto-format":!0,height:180,code:e.dataOrign},null,8,["code"])])])),_:1},8,["visible"]),v("div",{class:["step-title",{"--error":e.dataStatus.errFilter}]},[v(m,{modelValue:e.apiDataConfig.config.useFilter,"onUpdate:modelValue":a[3]||(a[3]=a=>e.apiDataConfig.config.useFilter=a),class:"use-filter-btn"},null,8,["modelValue"]),Ae,Ie],2),v(b),v(F,{fields:e.apiConfig.fields},null,8,["fields"]),v("div",{class:["step-title",{"--error":e.dataStatus.errSource||e.dataStatus.errFilter}]},[ze,v("i",{class:"el-icon-refresh refresh-btn",onClick:a[4]||(a[4]=(...a)=>e.refreshData&&e.refreshData(...a))})],2),v("div",Me,[v(c,{language:"json","read-only":!0,"auto-format":!0,code:e.resData},null,8,["code"])])],64)):C("",!0)])),_:1},8,["modelValue"])};var Be=n({name:"SourcePanel",components:{DisplayApiStatus:z,SourceDrawer:xe},props:{apiName:{type:String,required:!0},activeName:String,collapse:Boolean},setup(e){const a=d((()=>e.apiName===e.activeName)),t=b(null),l=T(),s=F("com"),i=d((()=>s.value.apis[e.apiName])),n=d((()=>s.value.apiData[e.apiName]));N("apiConfig",i),N("apiDataConfig",n),N("apiName",e.apiName);const r=d((()=>{const a=U.dataMap[s.value.id];return a?a[e.apiName]:""})),c=d((()=>{const a=U.fieldStatusMap[s.value.id];return a?a[e.apiName]:{}})),u=d((()=>{const e=Object.values(c.value);return e.includes(I.loading)?o.loading:e.includes(I.failed)?o.incomplete:o.completed})),p=F("changePanel");return{visible:a,sourceDrawerRef:t,datasources:l,com:s,apiConfig:i,apiDataConfig:n,fieldsStatus:c,totalStatus:u,datav_data:r,toggle:()=>{e.collapse&&p(e.apiName)},openSourceDrawer:()=>{var e;null==(e=t.value)||e.open()},refreshData:()=>{A(s.value.id,e.apiName,i.value,n.value)}}}});const qe=m();r("data-v-4b60f1c2");const Re={class:"api-editor-title"},$e={key:0,class:"el-icon-arrow-right api-fold-icon"},Ge={class:"api-status success"},Le={class:"attr-source-wp"},He={class:"data-attr-table-container"},Ze={class:"data-attr-table"},Je=v("thead",{class:"table-head"},[v("tr",{class:"table-head-row"},[v("th",{class:"th-item column-item attr-name"}," 字段 "),v("th",{class:"th-item column-item attr-value"}," 映射 "),v("th",{class:"th-item column-item attr-status"}," 状态 ")])],-1),Ke={class:"table-body"},Qe={class:"column-item attr-name"},We={class:"ellipsis2"},Xe={class:"column-item attr-value"},Ye={class:"column-item attr-status"},ea={key:1,class:"table-body-row"},aa=v("td",{class:"column-item attr-name"},[v("span",null,"任意")],-1),ta=v("td",{class:"column-item attr-value"},null,-1),la={class:"column-item attr-status"},sa={class:"data-source"},ia=v("div",{class:"data-result-title"}," 数据响应结果 ",-1),na={class:"auto-update-config"},oa=D(" 自动更新选项 "),da=D(" 秒一次 "),ra={class:"data-flow-wp"},ca={class:"ds-line"},ua={class:"ds-title"},pa=v("span",{class:"ds-title-text"},"数据源",-1),fa={class:"ds-type-text"},va=D(" 配置数据源 "),ga={class:"ds-line mt5"},ma=v("span",null,"数据响应结果 ( 只读 ) ",-1),ba={class:"ds-dots"},Fa=v("span",{class:"ds-dot"},null,-1),ha=v("span",{class:"ds-dot"},null,-1),ya={class:"data-response"};c();const Ca=qe(((e,a,t,l,s,i)=>{const n=y("display-api-status"),o=y("el-tooltip"),d=y("g-input"),r=y("el-checkbox"),c=y("el-button"),m=y("g-monaco-editor"),b=y("source-drawer");return u(),p("div",{class:["api-editor",{"--disable-fold":!e.collapse,"--fold":e.collapse&&e.visible}]},[v("div",Re,[v("div",{class:"api-desc ellipsis2",onClick:a[1]||(a[1]=(...a)=>e.toggle&&e.toggle(...a))},[e.collapse?(u(),p("i",$e)):C("",!0),D(" "+g(e.apiConfig.description||"数据接口"),1)]),v("div",Ge,[v(n,{status:e.totalStatus,"success-text":"配置完成"},null,8,["status"])])]),w(v("div",Le,[v("div",He,[v("table",Ze,[Je,v("tbody",Ke,[Object.keys(e.apiConfig.fields).length>0?(u(!0),p(f,{key:0},x(e.apiConfig.fields,((a,t)=>(u(),p("tr",{key:t,class:"table-body-row"},[v("td",Qe,[v(o,{content:a.description,placement:"left",effect:"blue"},{default:qe((()=>[v("span",We,g(t),1)])),_:2},1032,["content"])]),v("td",Xe,[v(d,{"model-value":a.map,placeholder:"可自定义",class:"attr-input",onChange:e=>a.map=e},null,8,["model-value","onChange"])]),v("td",Ye,[v(n,{status:e.fieldsStatus[t],optional:a.optional},null,8,["status","optional"])])])))),128)):(u(),p("tr",ea,[aa,ta,v("td",la,[v(n,{status:"completed"})])]))])])]),v("div",sa,[ia,v("div",na,[v(r,{modelValue:e.apiConfig.useAutoUpdate,"onUpdate:modelValue":a[2]||(a[2]=a=>e.apiConfig.useAutoUpdate=a),class:"auto-update-checkbox"},{default:qe((()=>[oa])),_:1},8,["modelValue"]),v(d,{"model-value":e.apiConfig.autoUpdate,type:"number",disabled:!e.apiConfig.useAutoUpdate,class:"update-interval-input",onChange:a[3]||(a[3]=a=>e.apiConfig.autoUpdate=a)},null,8,["model-value","disabled"]),da]),v("div",ra,[v("div",ca,[v("div",ua,[pa,v("span",fa,g(e.datasources[e.apiDataConfig.type]),1)]),v(c,{size:"mini",class:"ds-action-btn",onClick:e.openSourceDrawer},{default:qe((()=>[va])),_:1},8,["onClick"])]),v("div",ga,[ma,v(o,{content:"刷新数据",placement:"left",effect:"blue"},{default:qe((()=>[v("i",{class:"el-icon-refresh refresh-btn",onClick:a[4]||(a[4]=(...a)=>e.refreshData&&e.refreshData(...a))})])),_:1})]),v("div",ba,[v("span",{class:["ds-dot",["completed"===e.totalStatus?"active":"error"]]},null,2),Fa,ha])]),v("div",ya,[v(m,{language:"json","read-only":!0,"auto-format":!0,code:e.datav_data,height:250,"full-screen-title":"数据响应结果"},null,8,["code"])])])],512),[[k,e.visible]]),v(b,{ref:"sourceDrawerRef"},null,512)],2)}));Be.render=Ca,Be.__scopeId="data-v-4b60f1c2";export default Be;
