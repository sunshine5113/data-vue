var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,i=(e,i)=>{for(var o in i||(i={}))t.call(i,o)&&l(e,o,i[o]);if(a)for(var o of a(i))s.call(i,o)&&l(e,o,i[o]);return e};import{d as o,a_ as d,a4 as n,p as c,k as r,o as u,c as p,F as f,a as v,t as m,l as g,g as b,aC as y,r as h,b as C,al as w,aD as S,a$ as D,a5 as _,b0 as k,b1 as x,b2 as j,b3 as T,w as V,e as N,aj as O,b4 as U,a8 as F,b5 as I}from"./index.54bf6e8f.js";import{l as A}from"./index.2c021a26.js";import"./editor.worker.3eb73e22.js";import"./dom.1228cadc.js";var P=o({name:"DisplayApiStatus",props:{status:{type:String,default:d.incomplete},loadingText:{type:String,default:"匹配中"},successText:{type:String,default:"匹配成功"},failedText:{type:String,default:"未找到字段"},completedText:{type:String,default:"配置完成"},incompleteText:{type:String,default:"配置未完成"},optional:{type:Boolean,default:!1}},setup(e){const a=n((()=>e.status===d.loading?e.loadingText:e.status===d.success?e.successText:e.status===d.completed?e.completedText:e.optional?"可选":e.status===d.failed?e.failedText:e.status===d.incomplete?e.incompleteText:e.status));return{apiStatus:d,statusText:a}}});const E=g();c("data-v-7213c838");const M=v("i",{class:"status-icon validating"},null,-1),z=v("i",{class:"status-icon validating"},null,-1),R=v("i",{class:"status-icon validating"},null,-1),$={key:2,class:"status-icon --success"},B={class:"status-text"};r();const G=E(((e,a,t,s,l,i)=>(u(),p("div",null,[e.status===e.apiStatus.loading?(u(),p(f,{key:0},[M,z,R],64)):e.status===e.apiStatus.success||e.status===e.apiStatus.completed?(u(),p("i",{key:1,class:["status-icon",`--${e.status}`]},null,2)):e.optional?(u(),p("i",$)):(u(),p("i",{key:3,class:["status-icon",`--${e.status}`]},null,2)),v("span",B,m(e.statusText),1)]))));P.render=G,P.__scopeId="data-v-7213c838";var L=o({name:"FilterConfig",props:{},setup(){const e=b(void 0),a=b([]);return{dataFilters:n((()=>y.dataFilters)),filterId:e,filterIds:a,selectFilter:t=>{t&&(e.value=t,a.value.push(t))}}}});const q=g();c("data-v-69f99e30");const H={class:"filter-wp"},J={class:"filter-list"},K={class:"add-filter"},Q=v("div",{class:"new-filter-btn"},[v("i",{class:"el-icon-plus icon-add"})],-1),W=v("div",{class:"drag-indicator"},null,-1);r();const X=q(((e,a,t,s,l,i)=>{const o=h("el-option"),d=h("el-select");return u(),p("div",H,[v("div",J,[v("div",K,[v(d,{modelValue:e.filterId,"onUpdate:modelValue":a[1]||(a[1]=a=>e.filterId=a),size:"mini",filterable:"",placeholder:"添加过滤器",class:"datav-new-select filter-select","popper-class":"datav-new-select-option",onChange:e.selectFilter},{default:q((()=>[(u(!0),p(f,null,C(e.dataFilters,(e=>(u(),p(o,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),Q])]),W])}));L.render=X,L.__scopeId="data-v-69f99e30";var Y=o({name:"FieldGrid",props:{fields:{type:Object}}});const Z=g();c("data-v-c0253736");const ee={key:0,class:"field-wp"},ae=v("div",{class:"field-info"},"数据相应结果应为列表，列表元素包含如下字段",-1),te={class:"field-grid"},se=v("div",{class:"field-item field-title"},"字段",-1),le=v("div",{class:"field-item field-title"},"映射",-1),ie=v("div",{class:"field-item field-title"},"说明",-1),oe={class:"field-item"},de={class:"field-item"},ne={class:"field-item"};r();const ce=Z(((e,a,t,s,l,i)=>e.fields?(u(),p("div",ee,[ae,v("div",te,[se,le,ie,(u(!0),p(f,null,C(e.fields,((e,a)=>(u(),p(f,{key:a},[v("div",oe,m(a),1),v("div",de,m(e.map||"-"),1),v("div",ne,m(e.description||"-"),1)],64)))),128))])])):w("",!0)));Y.render=ce,Y.__scopeId="data-v-c0253736";var re=o({name:"SourceDrawer",components:{FilterConfig:L,FieldGrid:Y,DsStaticEditor:A((()=>S((()=>import("./ds-static-editor.6bb71137.js")),["/assets/ds-static-editor.6bb71137.js","/assets/index.54bf6e8f.js","/assets/index.48ce7cde.css","/assets/editor.worker.3eb73e22.js"]))),DsApiEditor:A((()=>S((()=>import("./ds-api-editor.705b3b1e.js")),["/assets/ds-api-editor.705b3b1e.js","/assets/ds-api-editor.e4cdc83e.css","/assets/index.54bf6e8f.js","/assets/index.48ce7cde.css","/assets/editor.worker.3eb73e22.js"])))},setup(){const e=b(!1),a=b(!1),t=x,s=D(),l=_("com"),o=_("apiConfig"),d=_("apiDataConfig"),c=_("apiName"),r=n((()=>k.dataStatusMap[l.value.id]||{})),u=n((()=>{const e=k.originMap[l.value.id];return e?e[c]:""})),p=n((()=>{const e=k.dataMap[l.value.id];return e?e[c]:""}));return{visible:e,visiblePreview:a,apiType:t,datasources:s,com:l,apiConfig:o,apiDataConfig:d,dataStatus:r,dataOrign:u,resData:p,open:()=>{e.value=!0},changeSource:e=>{switch(e){case x.api:void 0===d.value.config.api&&(d.value.config=i(i({},d.value.config),j()))}},refreshData:()=>{T(l.value.id,c,o.value,d.value)}}}});const ue=v("p",{class:"source-drawer-title"},"设置数据源",-1),pe={class:"datasource-selector"},fe=v("label",{class:"datasource-selector-title"},"数据源类型",-1),ve={class:"datasource-select"},me={class:"datav-new-select-wp"},ge={class:"ds-preview-content"},be=v("div",{class:"ds-response-btn"},[v("i",{class:"v-icon-search"}),N(" 预览数据源返回结果 ")],-1),ye=v("span",{class:"use-filter-text"},"数据过滤器",-1),he=v("span",{class:"tutorial-popup"},"教程",-1),Ce=v("span",null,"数据响应结果",-1),we={class:"data-response"};re.render=function(e,a,t,s,l,i){const o=h("el-option"),d=h("el-select"),n=h("ds-static-editor"),c=h("ds-api-editor"),r=h("g-monaco-editor"),m=h("el-popover"),g=h("el-checkbox"),b=h("filter-config"),y=h("field-grid"),S=h("el-drawer");return u(),p(S,{modelValue:e.visible,"onUpdate:modelValue":a[5]||(a[5]=a=>e.visible=a),"custom-class":"source-drawer",size:"500px"},{title:V((()=>[ue])),default:V((()=>[e.visible?(u(),p(f,{key:0},[v("div",{class:["step-title",{"--error":e.dataStatus.errSource}]}," 数据源 ",2),v("div",pe,[fe,v("div",ve,[v("div",me,[v(d,{modelValue:e.apiDataConfig.type,"onUpdate:modelValue":a[1]||(a[1]=a=>e.apiDataConfig.type=a),size:"mini",filterable:"",class:"datav-new-select","popper-class":"datav-new-select-option",onChange:e.changeSource},{default:V((()=>[(u(!0),p(f,null,C(e.datasources,((e,a)=>(u(),p(o,{key:a,label:e,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])])]),e.apiDataConfig.type===e.apiType.static?(u(),p(n,{key:0})):e.apiDataConfig.type===e.apiType.api?(u(),p(c,{key:1})):w("",!0),v(m,{visible:e.visiblePreview,"onUpdate:visible":a[2]||(a[2]=a=>e.visiblePreview=a),placement:"left",width:400,"popper-class":"editor-popover"},{reference:V((()=>[be])),default:V((()=>[v("div",ge,[v(r,{language:"json","read-only":!0,"auto-format":!0,height:180,code:e.dataOrign},null,8,["code"])])])),_:1},8,["visible"]),v("div",{class:["step-title",{"--error":e.dataStatus.errFilter}]},[v(g,{modelValue:e.apiConfig.useAutoUpdate,"onUpdate:modelValue":a[3]||(a[3]=a=>e.apiConfig.useAutoUpdate=a),class:"use-filter-btn"},null,8,["modelValue"]),ye,he],2),v(b),v(y,{fields:e.apiConfig.fields},null,8,["fields"]),v("div",{class:["step-title",{"--error":e.dataStatus.errSource||e.dataStatus.errFilter}]},[Ce,v("i",{class:"el-icon-refresh refresh-btn",onClick:a[4]||(a[4]=(...a)=>e.refreshData&&e.refreshData(...a))})],2),v("div",we,[v(r,{language:"json","read-only":!0,"auto-format":!0,code:e.resData},null,8,["code"])])],64)):w("",!0)])),_:1},8,["modelValue"])};var Se=o({name:"SourcePanel",components:{DisplayApiStatus:P,SourceDrawer:re},props:{apiName:{type:String,required:!0},activeName:String,collapse:Boolean},setup(e){const a=n((()=>e.apiName===e.activeName)),t=b(null),s=D(),l=_("com"),i=n((()=>l.value.apis[e.apiName])),o=n((()=>l.value.apiData[e.apiName]));O("apiConfig",i),O("apiDataConfig",o),O("apiName",e.apiName);const c=n((()=>{const a=k.dataMap[l.value.id];return a?a[e.apiName]:""})),r=n((()=>{const a=k.fieldStatusMap[l.value.id];return a?a[e.apiName]:{}})),u=n((()=>{const e=Object.values(r.value);return e.includes(U.loading)?d.loading:e.includes(U.failed)?d.incomplete:d.completed})),p=_("changePanel");return{visible:a,sourceDrawerRef:t,datasources:s,com:l,apiConfig:i,apiDataConfig:o,fieldsStatus:r,totalStatus:u,datav_data:c,toggle:()=>{e.collapse&&p(e.apiName)},openSourceDrawer:()=>{var e;null==(e=t.value)||e.open()},refreshData:()=>{T(l.value.id,e.apiName,i.value,o.value)}}}});const De=g();c("data-v-4b60f1c2");const _e={class:"api-editor-title"},ke={key:0,class:"el-icon-arrow-right api-fold-icon"},xe={class:"api-status success"},je={class:"attr-source-wp"},Te={class:"data-attr-table-container"},Ve={class:"data-attr-table"},Ne=v("thead",{class:"table-head"},[v("tr",{class:"table-head-row"},[v("th",{class:"th-item column-item attr-name"}," 字段 "),v("th",{class:"th-item column-item attr-value"}," 映射 "),v("th",{class:"th-item column-item attr-status"}," 状态 ")])],-1),Oe={class:"table-body"},Ue={class:"column-item attr-name"},Fe={class:"ellipsis2"},Ie={class:"column-item attr-value"},Ae={class:"column-item attr-status"},Pe={key:1,class:"table-body-row"},Ee=v("td",{class:"column-item attr-name"},[v("span",null,"任意")],-1),Me=v("td",{class:"column-item attr-value"},null,-1),ze={class:"column-item attr-status"},Re={class:"data-source"},$e=v("div",{class:"data-result-title"}," 数据响应结果 ",-1),Be={class:"auto-update-config"},Ge=N(" 自动更新选项 "),Le=N(" 秒一次 "),qe={class:"data-flow-wp"},He={class:"ds-line"},Je={class:"ds-title"},Ke=v("span",{class:"ds-title-text"},"数据源",-1),Qe={class:"ds-type-text"},We=N(" 配置数据源 "),Xe={class:"ds-line mt5"},Ye=v("span",null,"数据响应结果 ( 只读 ) ",-1),Ze={class:"ds-dots"},ea=v("span",{class:"ds-dot"},null,-1),aa=v("span",{class:"ds-dot"},null,-1),ta={class:"data-response"};r();const sa=De(((e,a,t,s,l,i)=>{const o=h("display-api-status"),d=h("el-tooltip"),n=h("g-input"),c=h("el-checkbox"),r=h("el-button"),g=h("g-monaco-editor"),b=h("source-drawer");return u(),p("div",{class:["api-editor",{"--disable-fold":!e.collapse,"--fold":e.collapse&&e.visible}]},[v("div",_e,[v("div",{class:"api-desc ellipsis2",onClick:a[1]||(a[1]=(...a)=>e.toggle&&e.toggle(...a))},[e.collapse?(u(),p("i",ke)):w("",!0),N(" "+m(e.apiConfig.description||"数据接口"),1)]),v("div",xe,[v(o,{status:e.totalStatus,"success-text":"配置完成"},null,8,["status"])])]),F(v("div",je,[v("div",Te,[v("table",Ve,[Ne,v("tbody",Oe,[Object.keys(e.apiConfig.fields).length>0?(u(!0),p(f,{key:0},C(e.apiConfig.fields,((a,t)=>(u(),p("tr",{key:t,class:"table-body-row"},[v("td",Ue,[v(d,{content:a.description,placement:"left",effect:"blue"},{default:De((()=>[v("span",Fe,m(t),1)])),_:2},1032,["content"])]),v("td",Ie,[v(n,{"model-value":a.map,placeholder:"可自定义",class:"attr-input",onChange:e=>a.map=e},null,8,["model-value","onChange"])]),v("td",Ae,[v(o,{status:e.fieldsStatus[t],optional:a.optional},null,8,["status","optional"])])])))),128)):(u(),p("tr",Pe,[Ee,Me,v("td",ze,[v(o,{status:"completed"})])]))])])]),v("div",Re,[$e,v("div",Be,[v(c,{modelValue:e.apiConfig.useAutoUpdate,"onUpdate:modelValue":a[2]||(a[2]=a=>e.apiConfig.useAutoUpdate=a),class:"auto-update-checkbox"},{default:De((()=>[Ge])),_:1},8,["modelValue"]),v(n,{"model-value":e.apiConfig.autoUpdate,type:"number",disabled:!e.apiConfig.useAutoUpdate,class:"update-interval-input",onChange:a[3]||(a[3]=a=>e.apiConfig.autoUpdate=a)},null,8,["model-value","disabled"]),Le]),v("div",qe,[v("div",He,[v("div",Je,[Ke,v("span",Qe,m(e.datasources[e.apiDataConfig.type]),1)]),v(r,{size:"mini",class:"ds-action-btn",onClick:e.openSourceDrawer},{default:De((()=>[We])),_:1},8,["onClick"])]),v("div",Xe,[Ye,v(d,{content:"刷新数据",placement:"left",effect:"blue"},{default:De((()=>[v("i",{class:"el-icon-refresh refresh-btn",onClick:a[4]||(a[4]=(...a)=>e.refreshData&&e.refreshData(...a))})])),_:1})]),v("div",Ze,[v("span",{class:["ds-dot",["completed"===e.totalStatus?"active":"error"]]},null,2),ea,aa])]),v("div",ta,[v(g,{language:"json","read-only":!0,"auto-format":!0,code:e.datav_data,height:250,"full-screen-title":"数据响应结果"},null,8,["code"])])])],512),[[I,e.visible]]),v(b,{ref:"sourceDrawerRef"},null,512)],2)}));Se.render=sa,Se.__scopeId="data-v-4b60f1c2";export default Se;
