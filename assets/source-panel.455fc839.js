import{d as e,ba as a,h as t,C as l,D as s,o as i,c as d,F as n,a as o,t as r,E as c,e as u,i as p,p as f,aM as v,aI as m,f as g,g as b,b as h,w as y,aK as C,az as D,bb as w,bc as F,bd as S,b5 as k,aL as x,be as _,A as T,bf as N,n as V,b6 as I}from"./index.3033f95e.js";import{_ as j}from"./filter-collapse-panel.237bf2ca.js";var E=e({name:"DisplayApiStatus",props:{status:{type:String,default:a.incomplete},loadingText:{type:String,default:"匹配中"},successText:{type:String,default:"匹配成功"},failedText:{type:String,default:"未找到字段"},completedText:{type:String,default:"配置完成"},incompleteText:{type:String,default:"配置未完成"},optional:{type:Boolean,default:!1}},setup(e){const l=t((()=>e.status===a.loading?e.loadingText:e.status===a.success?e.successText:e.status===a.completed?e.completedText:e.optional?"可选":e.status===a.failed?e.failedText:e.status===a.incomplete?e.incompleteText:e.status));return{apiStatus:a,statusText:l}}});const A=c();l("data-v-44e10de6");const U=o("i",{class:"status-icon validating"},null,-1),P=o("i",{class:"status-icon validating"},null,-1),O=o("i",{class:"status-icon validating"},null,-1),M={key:2,class:"status-icon --success"},R={class:"status-text"};s();const z=A(((e,a,t,l,s,c)=>(i(),d("div",null,[e.status===e.apiStatus.loading?(i(),d(n,{key:0},[U,P,O],64)):e.status===e.apiStatus.success||e.status===e.apiStatus.completed?(i(),d("i",{key:1,class:["status-icon",`--${e.status}`]},null,2)):e.optional?(i(),d("i",M)):(i(),d("i",{key:3,class:["status-icon",`--${e.status}`]},null,2)),o("span",R,r(e.statusText),1)]))));E.render=z,E.__scopeId="data-v-44e10de6";var L=e({name:"FilterConfig",components:{FilterCollapsePanel:j},setup(){const e=u(void 0),a=u(null),l=u(null),s=u({visible:!1,top:"4px",from:0,to:0}),i=p("apiDataConfig"),d=p("refreshData"),n=t((()=>{const e=i.value.pageFilters.map((e=>e.id));return v.dataFilters.filter((a=>!e.includes(a.id)))})),o=t((()=>i.value.pageFilters.reduce(((e,a)=>{const t=v.dataFilters.find((e=>e.id==a.id));return t&&e.push(t),e}),[]))),r=t((()=>{const e=[...m.coms,...m.subComs],a=Object.create(null);return e.forEach((e=>{for(const t in e.apiData){e.apiData[t].pageFilters.forEach((t=>{a[t.id]?(a[t.id].ids.push(e.id),a[t.id].names.push(e.alias)):a[t.id]={ids:[e.id],names:[e.alias]}}))}})),a})),c=t((()=>i.value.pageFilters.reduce(((e,a)=>(e[a.id]=a.enabled,e)),{}))),g=(e,a,t)=>{s.value.visible=e,s.value.top=t.offsetTop-6+"px",e?s.value.to=a:(s.value.from=a,(()=>{const{from:e,to:a}=s.value;if(e!==a){const t=i.value.pageFilters;t.splice(a,0,...t.splice(e,1)),d()}})())};return f("usedFilters",r),f("enabledFilters",c),f("onUsedChange",((e,a)=>{i.value.pageFilters.find((a=>a.id===e)).enabled=a,d()})),f("editFilterName",((e,a)=>{const t=e.trim();t&&a.name!==t&&(a.name=t,a.id>0&&v.updateFilterName(a))})),f("removeFilter",(e=>{e>0?(i.value.pageFilters=i.value.pageFilters.filter((a=>a.id!==e)),d()):a.value=null})),f("saveFilter",(async e=>{if(e.id>0)await v.updateFilter(e),c.value[e.id]&&d();else{const t=await v.createFilter(e);i.value.pageFilters.push({id:t,enabled:!0}),a.value=null,d()}})),f("updateIndicator",g),{filterId:e,apiDataConfig:i,dataFilters:n,selectedFilters:o,newDataFilter:a,addPanelRef:l,dragInfo:s,selectFilter:e=>{i.value.pageFilters.push({id:e,enabled:!0}),d()},addFilter:()=>{a.value||(a.value={id:0,name:"新建过滤器",code:"return data;",origin:"return data;",projectId:0,createAt:"",updateAt:""})},dragEnter:()=>{g(!0,o.value.length,l.value)}}}});const B={class:"filter-list"},G=o("i",{class:"v-icon-plus icon-add"},null,-1),$=o("div",{class:"filter-dragging-wp"},null,-1);L.render=function(e,a,t,l,s,r){const c=g("filter-collapse-panel"),u=g("el-option"),p=g("el-select");return i(),d("div",{class:["filter-wp",{"--disabled":!e.apiDataConfig.config.useFilter}]},[o("div",B,[(i(!0),d(n,null,b(e.selectedFilters,((e,a)=>(i(),d(c,{key:e.id,index:a,"data-filter":e},null,8,["index","data-filter"])))),128)),e.newDataFilter?(i(),d(c,{key:0,"data-filter":e.newDataFilter,index:e.selectedFilters.length,"is-new":!0,draggable:!1,"has-feedback":!1,removable:!0},null,8,["data-filter","index"])):h("",!0),o("div",{ref:"addPanelRef",class:"add-filter",onDragenter:a[2]||(a[2]=(...a)=>e.dragEnter&&e.dragEnter(...a))},[o(p,{"model-value":e.filterId,size:"mini",filterable:"",placeholder:"添加过滤器",class:"datav-new-select filter-select","popper-class":"datav-new-select-option",onChange:e.selectFilter},{default:y((()=>[(i(!0),d(n,null,b(e.dataFilters,(e=>(i(),d(u,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["model-value","onChange"]),o("div",{class:"new-filter-btn",onClick:a[1]||(a[1]=(...a)=>e.addFilter&&e.addFilter(...a))},[G])],544)]),$,o("div",{class:"drag-indicator",style:{display:e.dragInfo.visible?"block":"none",top:e.dragInfo.top}},null,4)],2)};var q=e({name:"FieldGrid",props:{fields:{type:Object}}});const K=c();l("data-v-6b5d57f6");const H={key:0,class:"field-wp"},J=o("div",{class:"field-info"},"数据相应结果应为列表，列表元素包含如下字段",-1),Q={class:"field-grid"},W=o("div",{class:"field-item field-title"},"字段",-1),X=o("div",{class:"field-item field-title"},"映射",-1),Y=o("div",{class:"field-item field-title"},"说明",-1),Z={class:"field-item"},ee={class:"field-item"},ae={class:"field-item"};s();const te=K(((e,a,t,l,s,c)=>e.fields?(i(),d("div",H,[J,o("div",Q,[W,X,Y,(i(!0),d(n,null,b(e.fields,((e,a)=>(i(),d(n,{key:a},[o("div",Z,r(a),1),o("div",ee,r(e.map||"-"),1),o("div",ae,r(e.description||"-"),1)],64)))),128))])])):h("",!0)));q.render=te,q.__scopeId="data-v-6b5d57f6";var le=e({name:"SourceDrawer",components:{FilterConfig:L,FieldGrid:q,DsStaticEditor:C((()=>D((()=>import("./ds-static-editor.587c377e.js")),["/assets/ds-static-editor.587c377e.js","/assets/index.3033f95e.js","/assets/index.82b97920.css"]))),DsApiEditor:C((()=>D((()=>import("./ds-api-editor.0f7b57cc.js")),["/assets/ds-api-editor.0f7b57cc.js","/assets/ds-api-editor.e4cdc83e.css","/assets/index.3033f95e.js","/assets/index.82b97920.css"])))},setup(){const e=u(!1),a=u(!1),l=F,s=w(),i=p("com"),d=p("apiConfig"),n=p("apiDataConfig"),o=p("apiName"),r=t((()=>{var e;const a=x.dataStatusMap[i.value.id];return a&&null!=(e=a[o])?e:{}})),c=t((()=>{const e=x.originMap[i.value.id];return e?e[o]:""})),v=t((()=>{const e=_.dataMap[i.value.id];return e?e[o]:""})),m=async()=>{await k(i.value.id,o,d.value,n.value)};return f("refreshData",m),f("dataStatus",r),{visible:e,visiblePreview:a,apiType:l,datasources:s,com:i,apiConfig:d,apiDataConfig:n,dataStatus:r,dataOrign:c,resData:v,open:()=>{e.value=!0},changeSource:e=>{switch(e){case F.api:S(n.value.config)}},refreshData:m}}});const se=o("p",{class:"source-drawer-title"},"设置数据源",-1),ie={class:"datasource-selector"},de=o("label",{class:"datasource-selector-title"},"数据源类型",-1),ne={class:"datasource-select"},oe={class:"datav-new-select-wp"},re={class:"ds-preview-content"},ce=o("div",{class:"ds-response-btn"},[o("i",{class:"v-icon-search"}),T(" 预览数据源返回结果 ")],-1),ue=o("span",{class:"use-filter-text"},"数据过滤器",-1),pe=o("span",{class:"tutorial-popup"},"教程",-1),fe=o("span",null,"数据响应结果",-1),ve={class:"data-response"};le.render=function(e,a,t,l,s,r){const c=g("el-option"),u=g("el-select"),p=g("ds-static-editor"),f=g("ds-api-editor"),v=g("g-monaco-editor"),m=g("el-popover"),C=g("el-checkbox"),D=g("filter-config"),w=g("field-grid"),F=g("el-drawer");return i(),d(F,{modelValue:e.visible,"onUpdate:modelValue":a[5]||(a[5]=a=>e.visible=a),"custom-class":"source-drawer",size:"500px"},{title:y((()=>[se])),default:y((()=>[e.visible?(i(),d(n,{key:0},[o("div",{class:["step-title",{"--error":!!e.dataStatus.api}]}," 数据源 ",2),o("div",ie,[de,o("div",ne,[o("div",oe,[o(u,{modelValue:e.apiDataConfig.type,"onUpdate:modelValue":a[1]||(a[1]=a=>e.apiDataConfig.type=a),size:"mini",filterable:"",class:"datav-new-select","popper-class":"datav-new-select-option",onChange:e.changeSource},{default:y((()=>[(i(!0),d(n,null,b(e.datasources,((e,a)=>(i(),d(c,{key:a,label:e,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])])]),e.apiDataConfig.type===e.apiType.static?(i(),d(p,{key:0})):e.apiDataConfig.type===e.apiType.api?(i(),d(f,{key:1})):h("",!0),o(m,{visible:e.visiblePreview,"onUpdate:visible":a[2]||(a[2]=a=>e.visiblePreview=a),placement:"left",width:400,"popper-class":"editor-popover"},{reference:y((()=>[ce])),default:y((()=>[o("div",re,[o(v,{language:"json","read-only":!0,"auto-format":!0,height:180,code:e.dataOrign},null,8,["code"])])])),_:1},8,["visible"]),o("div",{class:["step-title",{"--error":!!e.dataStatus.filter}]},[o(C,{modelValue:e.apiDataConfig.config.useFilter,"onUpdate:modelValue":a[3]||(a[3]=a=>e.apiDataConfig.config.useFilter=a),class:"use-filter-btn"},null,8,["modelValue"]),ue,pe],2),o(D),o(w,{fields:e.apiConfig.fields},null,8,["fields"]),o("div",{class:["step-title",{"--error":!!e.dataStatus.api||!!e.dataStatus.filter}]},[fe,o("i",{class:"v-icon-refresh refresh-btn",onClick:a[4]||(a[4]=(...a)=>e.refreshData&&e.refreshData(...a))})],2),o("div",ve,[o(v,{language:"json","read-only":!0,"auto-format":!0,code:e.resData},null,8,["code"])])],64)):h("",!0)])),_:1},8,["modelValue"])};var me=e({name:"SourcePanel",components:{DisplayApiStatus:E,SourceDrawer:le},props:{apiName:{type:String,required:!0},activeName:String,collapse:Boolean},setup(e){const l=t((()=>e.apiName===e.activeName)),s=u(null),i=w(),d=p("com"),n=t((()=>d.value.apis[e.apiName])),o=t((()=>d.value.apiData[e.apiName]));f("apiConfig",n),f("apiDataConfig",o),f("apiName",e.apiName);const r=t((()=>{const a=_.dataMap[d.value.id];return a?a[e.apiName]:""})),c=t((()=>{const a=x.fieldStatusMap[d.value.id];return a?a[e.apiName]:{}})),v=t((()=>{const e=Object.values(c.value);return e.includes(N.loading)?a.loading:e.includes(N.failed)?a.incomplete:a.completed})),m=p("changePanel");return{visible:l,sourceDrawerRef:s,datasources:i,com:d,apiConfig:n,apiDataConfig:o,fieldsStatus:c,totalStatus:v,datav_data:r,toggle:()=>{e.collapse&&m(e.apiName)},openSourceDrawer:()=>{var e;null==(e=s.value)||e.open()},refreshData:()=>{k(d.value.id,e.apiName,n.value,o.value)}}}});const ge=c();l("data-v-026d7ff8");const be={class:"api-editor-title"},he={key:0,class:"v-icon-arrow-right api-fold-icon"},ye={class:"api-status success"},Ce={class:"attr-source-wp"},De={class:"data-attr-table-container"},we={class:"data-attr-table"},Fe=o("thead",{class:"table-head"},[o("tr",{class:"table-head-row"},[o("th",{class:"th-item column-item attr-name"}," 字段 "),o("th",{class:"th-item column-item attr-value"}," 映射 "),o("th",{class:"th-item column-item attr-status"}," 状态 ")])],-1),Se={class:"table-body"},ke={class:"column-item attr-name"},xe={class:"ellipsis2"},_e={class:"column-item attr-value"},Te={class:"column-item attr-status"},Ne={key:1,class:"table-body-row"},Ve=o("td",{class:"column-item attr-name"},[o("span",null,"任意")],-1),Ie=o("td",{class:"column-item attr-value"},null,-1),je={class:"column-item attr-status"},Ee={class:"data-source"},Ae=o("div",{class:"data-result-title"}," 数据响应结果 ",-1),Ue={class:"auto-update-config"},Pe=T(" 自动更新选项 "),Oe=T(" 秒一次 "),Me={class:"data-flow-wp"},Re={class:"ds-line"},ze={class:"ds-title"},Le={class:"ds-type-text"},Be=T(" 配置数据源 "),Ge={class:"ds-line mt5"},$e=o("span",null,"数据响应结果 ( 只读 ) ",-1),qe={class:"ds-dots"},Ke=o("span",{class:"ds-dot"},null,-1),He=o("span",{class:"ds-dot"},null,-1),Je={class:"data-response"};s();const Qe=ge(((e,a,t,l,s,c)=>{const u=g("display-api-status"),p=g("el-tooltip"),f=g("new-input"),v=g("el-checkbox"),m=g("el-button"),y=g("g-monaco-editor"),C=g("source-drawer");return i(),d("div",{class:["api-editor",{"--disable-fold":!e.collapse,"--fold":e.collapse&&e.visible}]},[o("div",be,[o("div",{class:"api-desc ellipsis2",onClick:a[1]||(a[1]=(...a)=>e.toggle&&e.toggle(...a))},[e.collapse?(i(),d("i",he)):h("",!0),T(" "+r(e.apiConfig.description||"数据接口"),1)]),o("div",ye,[o(u,{status:e.totalStatus,"success-text":"配置完成"},null,8,["status"])])]),V(o("div",Ce,[o("div",De,[o("table",we,[Fe,o("tbody",Se,[Object.keys(e.apiConfig.fields).length>0?(i(!0),d(n,{key:0},b(e.apiConfig.fields,((a,t)=>(i(),d("tr",{key:t,class:"table-body-row"},[o("td",ke,[o(p,{content:a.description,placement:"left",effect:"blue"},{default:ge((()=>[o("span",xe,r(t),1)])),_:2},1032,["content"])]),o("td",_e,[o(f,{"model-value":a.map,placeholder:"可自定义",class:"attr-input",onChange:e=>a.map=e},null,8,["model-value","onChange"])]),o("td",Te,[o(u,{status:e.fieldsStatus[t],optional:a.optional},null,8,["status","optional"])])])))),128)):(i(),d("tr",Ne,[Ve,Ie,o("td",je,[o(u,{status:"completed"})])]))])])]),o("div",Ee,[Ae,o("div",Ue,[o(v,{modelValue:e.apiConfig.useAutoUpdate,"onUpdate:modelValue":a[2]||(a[2]=a=>e.apiConfig.useAutoUpdate=a),class:"auto-update-checkbox"},{default:ge((()=>[Pe])),_:1},8,["modelValue"]),o(f,{"model-value":e.apiConfig.autoUpdate,type:"number",disabled:!e.apiConfig.useAutoUpdate,class:"update-interval-input",onChange:a[3]||(a[3]=a=>e.apiConfig.autoUpdate=a)},null,8,["model-value","disabled"]),Oe]),o("div",Me,[o("div",Re,[o("div",ze,[o("span",Le,r(e.datasources[e.apiDataConfig.type]),1)]),o(m,{size:"mini",class:"ds-action-btn",onClick:e.openSourceDrawer},{default:ge((()=>[Be])),_:1},8,["onClick"])]),o("div",Ge,[$e,o(p,{content:"刷新数据",placement:"left",effect:"blue"},{default:ge((()=>[o("i",{class:"v-icon-refresh refresh-btn",onClick:a[4]||(a[4]=(...a)=>e.refreshData&&e.refreshData(...a))})])),_:1})]),o("div",qe,[o("span",{class:["ds-dot",["completed"===e.totalStatus?"active":"error"]]},null,2),Ke,He])]),o("div",Je,[o(y,{language:"json","read-only":!0,"auto-format":!0,code:e.datav_data,height:250,"full-screen-title":"数据响应结果"},null,8,["code"])])])],512),[[I,e.visible]]),o(C,{ref:"sourceDrawerRef"},null,512)],2)}));me.render=Qe,me.__scopeId="data-v-026d7ff8";export default me;
