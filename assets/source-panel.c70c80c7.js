var a=Object.defineProperty,e=Object.defineProperties,t=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(e,t,s)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;import{H as c,_ as d,I as n,J as r,K as u,L as p,N as f,O as m}from"./index.1ace366a.js";import{m as v,p as g,y as b,B as y,u as h,v as S,F as C,D as w,x as D,G as _,E as x,N as k,r as j,L as O,C as T,J as N,X as V,O as U,U as P,aH as A}from"./editor.worker.0b81cf4b.js";import{l as E}from"./index.3b13c853.js";import"./dom.1228cadc.js";import"./images.a8ceee1d.js";var I=v({name:"DisplayApiStatus",props:{status:{type:String,default:c.incomplete},loadingText:{type:String,default:"匹配中"},successText:{type:String,default:"匹配成功"},failedText:{type:String,default:"未找到字段"},completedText:{type:String,default:"配置完成"},incompleteText:{type:String,default:"配置未完成"},optional:{type:Boolean,default:!1}},setup(a){const e=g((()=>a.status===c.loading?a.loadingText:a.status===c.success?a.successText:a.status===c.completed?a.completedText:a.optional?"可选":a.status===c.failed?a.failedText:a.status===c.incomplete?a.incompleteText:a.status));return{apiStatus:c,statusText:e}}});const M=_();b("data-v-1785705c");const F=w("i",{class:"status-icon validating"},null,-1),B=w("i",{class:"status-icon validating"},null,-1),G=w("i",{class:"status-icon validating"},null,-1),L={key:2,class:"status-icon --success"},R={class:"status-text"};y();const z=M(((a,e,t,s,l,i)=>(h(),S("div",null,[a.status===a.apiStatus.loading?(h(),S(C,{key:0},[F,B,G],64)):a.status===a.apiStatus.success||a.status===a.apiStatus.completed?(h(),S("i",{key:1,class:["status-icon",`--${a.status}`]},null,2)):a.optional?(h(),S("i",L)):(h(),S("i",{key:3,class:["status-icon",`--${a.status}`]},null,2)),w("span",R,D(a.statusText),1)]))));I.render=z,I.__scopeId="data-v-1785705c";var H=v({name:"FieldGrid",props:{fields:{type:Object}}});const J=_();b("data-v-c0253736");const $={key:0,class:"field-wp"},q=w("div",{class:"field-info"},"数据相应结果应为列表，列表元素包含如下字段",-1),K={class:"field-grid"},X=w("div",{class:"field-item field-title"},"字段",-1),Q=w("div",{class:"field-item field-title"},"映射",-1),W=w("div",{class:"field-item field-title"},"说明",-1),Y={class:"field-item"},Z={class:"field-item"},aa={class:"field-item"};y();const ea=J(((a,e,t,s,l,i)=>a.fields?(h(),S("div",$,[q,w("div",K,[X,Q,W,(h(!0),S(C,null,x(a.fields,((a,e)=>(h(),S(C,{key:e},[w("div",Y,D(e),1),w("div",Z,D(a.map||"-"),1),w("div",aa,D(a.description||"-"),1)],64)))),128))])])):k("",!0)));H.render=ea,H.__scopeId="data-v-c0253736";var ta=v({name:"SourceDrawer",components:{FieldGrid:H,DsStaticEditor:E((()=>d((()=>import("./ds-static-editor.148467d1.js")),["/assets/ds-static-editor.148467d1.js","/assets/editor.worker.0b81cf4b.js","/assets/editor.worker.f4e18b1a.css"]))),DsApiEditor:E((()=>d((()=>import("./ds-api-editor.848748d5.js")),["/assets/ds-api-editor.848748d5.js","/assets/ds-api-editor.e4cdc83e.css","/assets/index.1ace366a.js","/assets/index.709831ea.css","/assets/editor.worker.0b81cf4b.js","/assets/editor.worker.f4e18b1a.css"])))},setup(){const a=j(!1),c=j(!1),d=u,m=n(),v=O("com"),b=O("apiConfig"),y=O("apiDataConfig"),h=O("apiName"),S=g((()=>r.dataStatusMap[v.value.id]||{})),C=g((()=>{const a=r.originMap[v.value.id];return a?a[h]:""})),w=g((()=>{const a=r.dataMap[v.value.id];return a?a[h]:""}));return{visible:a,visiblePreview:c,apiType:d,datasources:m,com:v,apiConfig:b,apiDataConfig:y,dataStatus:S,dataOrign:C,resData:w,open:()=>{a.value=!0},changeSource:a=>{switch(a){case u.api:void 0===y.value.config.api&&(y.value.config=(c=((a,e)=>{for(var t in e||(e={}))l.call(e,t)&&o(a,t,e[t]);if(s)for(var t of s(e))i.call(e,t)&&o(a,t,e[t]);return a})({},y.value.config),d={api:"",apiMethod:p.GET,apiHeaders:"{}",apiBody:"{}"},e(c,t(d))))}var c,d},refreshData:()=>{f(v.value.id,h,b.value,y.value)}}}});const sa=w("p",{class:"source-drawer-title"},"设置数据源",-1),la={class:"datasource-selector"},ia=w("label",{class:"datasource-selector-title"},"数据源类型",-1),oa={class:"datasource-select"},ca={class:"datav-new-select-wp"},da={class:"ds-preview-content"},na=w("div",{class:"ds-response-btn"},[w("i",{class:"v-icon-search"}),V(" 预览数据源返回结果 ")],-1),ra=w("span",{class:"use-filter-text"},"数据过滤器",-1),ua=w("span",{class:"tutorial-popup"},"教程",-1),pa=w("span",null,"数据响应结果",-1),fa={class:"data-response"};ta.render=function(a,e,t,s,l,i){const o=T("el-option"),c=T("el-select"),d=T("ds-static-editor"),n=T("ds-api-editor"),r=T("g-monaco-editor"),u=T("el-popover"),p=T("el-checkbox"),f=T("field-grid"),m=T("el-drawer");return h(),S(m,{modelValue:a.visible,"onUpdate:modelValue":e[5]||(e[5]=e=>a.visible=e),"custom-class":"source-drawer",size:"500px"},{title:N((()=>[sa])),default:N((()=>[a.visible?(h(),S(C,{key:0},[w("div",{class:["step-title",{"--error":a.dataStatus.errSource}]}," 数据源 ",2),w("div",la,[ia,w("div",oa,[w("div",ca,[w(c,{modelValue:a.apiDataConfig.type,"onUpdate:modelValue":e[1]||(e[1]=e=>a.apiDataConfig.type=e),size:"mini",class:"datav-new-select","popper-class":"datav-new-select-option",onChange:a.changeSource},{default:N((()=>[(h(!0),S(C,null,x(a.datasources,((a,e)=>(h(),S(o,{key:e,label:a,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])])]),a.apiDataConfig.type===a.apiType.static?(h(),S(d,{key:0})):a.apiDataConfig.type===a.apiType.api?(h(),S(n,{key:1})):k("",!0),w(u,{visible:a.visiblePreview,"onUpdate:visible":e[2]||(e[2]=e=>a.visiblePreview=e),placement:"left",width:400,"popper-class":"editor-popover"},{reference:N((()=>[na])),default:N((()=>[w("div",da,[w(r,{language:"json","read-only":!0,"auto-format":!0,height:180,code:a.dataOrign},null,8,["code"])])])),_:1},8,["visible"]),w("div",{class:["step-title",{"--error":a.dataStatus.errFilter}]},[w(p,{modelValue:a.apiConfig.useAutoUpdate,"onUpdate:modelValue":e[3]||(e[3]=e=>a.apiConfig.useAutoUpdate=e),class:"use-filter-btn"},null,8,["modelValue"]),ra,ua],2),w(f,{fields:a.apiConfig.fields},null,8,["fields"]),w("div",{class:["step-title",{"--error":a.dataStatus.errSource||a.dataStatus.errFilter}]},[pa,w("i",{class:"el-icon-refresh refresh-btn",onClick:e[4]||(e[4]=(...e)=>a.refreshData&&a.refreshData(...e))})],2),w("div",fa,[w(r,{language:"json","read-only":!0,"auto-format":!0,code:a.resData},null,8,["code"])])],64)):k("",!0)])),_:1},8,["modelValue"])};var ma=v({name:"SourcePanel",components:{DisplayApiStatus:I,SourceDrawer:ta},props:{apiName:{type:String,required:!0},activeName:String,collapse:Boolean},setup(a){const e=g((()=>a.apiName===a.activeName)),t=j(null),s=n(),l=O("com"),i=g((()=>l.value.apis[a.apiName])),o=g((()=>l.value.apiData[a.apiName]));U("apiConfig",i),U("apiDataConfig",o),U("apiName",a.apiName);const d=g((()=>{const e=r.dataMap[l.value.id];return e?e[a.apiName]:""})),u=g((()=>{const e=r.fieldStatusMap[l.value.id];return e?e[a.apiName]:{}})),p=g((()=>{const a=Object.values(u.value);return a.includes(m.loading)?c.loading:a.includes(m.failed)?c.incomplete:c.completed})),v=O("changePanel");return{visible:e,sourceDrawerRef:t,datasources:s,com:l,apiConfig:i,apiDataConfig:o,fieldsStatus:u,totalStatus:p,datav_data:d,toggle:()=>{a.collapse&&v(a.apiName)},openSourceDrawer:()=>{var a;null==(a=t.value)||a.open()},refreshData:()=>{f(l.value.id,a.apiName,i.value,o.value)}}}});const va=_();b("data-v-4bf4f9a4");const ga={class:"api-editor-title"},ba={key:0,class:"el-icon-arrow-right api-fold-icon"},ya={class:"api-status success"},ha={class:"attr-source-wp"},Sa={class:"data-attr-table-container"},Ca={class:"data-attr-table"},wa=w("thead",{class:"table-head"},[w("tr",{class:"table-head-row"},[w("th",{class:"th-item column-item attr-name"}," 字段 "),w("th",{class:"th-item column-item attr-value"}," 映射 "),w("th",{class:"th-item column-item attr-status"}," 状态 ")])],-1),Da={class:"table-body"},_a={class:"column-item attr-name"},xa={class:"ellipsis2"},ka={class:"column-item attr-value"},ja={class:"column-item attr-status"},Oa={key:1,class:"table-body-row"},Ta=w("td",{class:"column-item attr-name"},[w("span",null,"任意")],-1),Na=w("td",{class:"column-item attr-value"},null,-1),Va={class:"column-item attr-status"},Ua={class:"data-source"},Pa=w("div",{class:"data-result-title"}," 数据响应结果 ",-1),Aa={class:"auto-update-config"},Ea=V(" 自动更新选项 "),Ia=V(" 秒一次 "),Ma={class:"data-flow-wp"},Fa={class:"ds-line"},Ba={class:"ds-title"},Ga=w("span",{class:"ds-title-text"},"数据源",-1),La={class:"ds-type-text"},Ra=V(" 配置数据源 "),za={class:"ds-line mt5"},Ha=w("span",null,"数据响应结果 ( 只读 ) ",-1),Ja={class:"ds-dots"},$a=w("span",{class:"ds-dot"},null,-1),qa=w("span",{class:"ds-dot"},null,-1),Ka={class:"data-response"};y();const Xa=va(((a,e,t,s,l,i)=>{const o=T("display-api-status"),c=T("el-tooltip"),d=T("g-input"),n=T("el-checkbox"),r=T("el-button"),u=T("g-monaco-editor"),p=T("source-drawer");return h(),S("div",{class:["api-editor",{"--disable-fold":!a.collapse,"--fold":a.collapse&&a.visible}]},[w("div",ga,[w("div",{class:"api-desc ellipsis2",onClick:e[1]||(e[1]=(...e)=>a.toggle&&a.toggle(...e))},[a.collapse?(h(),S("i",ba)):k("",!0),V(" "+D(a.apiConfig.description||"数据接口"),1)]),w("div",ya,[w(o,{status:a.totalStatus,"success-text":"配置完成"},null,8,["status"])])]),P(w("div",ha,[w("div",Sa,[w("table",Ca,[wa,w("tbody",Da,[Object.keys(a.apiConfig.fields).length>0?(h(!0),S(C,{key:0},x(a.apiConfig.fields,((e,t)=>(h(),S("tr",{key:t,class:"table-body-row"},[w("td",_a,[w(c,{content:e.description,placement:"left",effect:"blue"},{default:va((()=>[w("span",xa,D(t),1)])),_:2},1032,["content"])]),w("td",ka,[w(d,{"model-value":e.map,placeholder:"可自定义",class:"attr-input",onChange:a=>e.map=a},null,8,["model-value","onChange"])]),w("td",ja,[w(o,{status:a.fieldsStatus[t],optional:e.optional},null,8,["status","optional"])])])))),128)):(h(),S("tr",Oa,[Ta,Na,w("td",Va,[w(o,{status:"completed"})])]))])])]),w("div",Ua,[Pa,w("div",Aa,[w(n,{modelValue:a.apiConfig.useAutoUpdate,"onUpdate:modelValue":e[2]||(e[2]=e=>a.apiConfig.useAutoUpdate=e),class:"auto-update-checkbox"},{default:va((()=>[Ea])),_:1},8,["modelValue"]),w(d,{"model-value":a.apiConfig.autoUpdate,type:"number",disabled:!a.apiConfig.useAutoUpdate,class:"update-interval-input",onChange:e[3]||(e[3]=e=>a.apiConfig.autoUpdate=e)},null,8,["model-value","disabled"]),Ia]),w("div",Ma,[w("div",Fa,[w("div",Ba,[Ga,w("span",La,D(a.datasources[a.apiDataConfig.type]),1)]),w(r,{size:"mini",class:"ds-action-btn",onClick:a.openSourceDrawer},{default:va((()=>[Ra])),_:1},8,["onClick"])]),w("div",za,[Ha,w(c,{content:"刷新数据",placement:"left",effect:"blue"},{default:va((()=>[w("i",{class:"el-icon-refresh refresh-btn",onClick:e[4]||(e[4]=(...e)=>a.refreshData&&a.refreshData(...e))})])),_:1})]),w("div",Ja,[w("span",{class:["ds-dot",["completed"===a.totalStatus?"active":"error"]]},null,2),$a,qa])]),w("div",Ka,[w(u,{language:"json","read-only":!0,"auto-format":!0,code:a.datav_data,height:250,"full-screen-title":"数据响应结果"},null,8,["code"])])])],512),[[A,a.visible]]),w(p,{ref:"sourceDrawerRef"},null,512)],2)}));ma.render=Xa,ma.__scopeId="data-v-4bf4f9a4";export default ma;
